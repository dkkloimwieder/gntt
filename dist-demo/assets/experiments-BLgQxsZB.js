import{a as Ft,c as U,b as S,q as jt,m as W,t as N,i as R,v as Nt,G as Kt,k as m,I as Zt,C as Jt,R as Qt,D as te,h as F,B as ee,w as oe,u as ht,e as bt,z as ne,n as re,d as se,o as ae,l as ie,A as ce}from"./calendar-PDbbVejm.js";import{G as le}from"./GanttContainer-CxIJ5yVC.js";var xt=N("<div style=position:absolute;border-radius:3px;color:#fff;font-size:11px;padding-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box><div style=position:absolute;left:0;top:0;width:6px;height:100%;cursor:ew-resize></div><div style=position:absolute;right:0;top:0;width:6px;height:100%;cursor:ew-resize>"),de=N("<div style=position:absolute;opacity:0.5;border-radius:3px;color:#fff;font-size:11px;line-height:28px;padding-left:4px;overflow:hidden>"),ue=N('<div style=height:100vh;display:flex;flex-direction:column;padding:10px;font-family:system-ui;background:#1a1a1a;color:#fff><div style=margin-bottom:10px;display:flex;gap:15px;align-items:center><h2 style=margin:0;font-size:16px>Experiments (<!> days Ã— <!> rows = <!> tasks)</h2><select style="padding:6px 10px;border-radius:4px;border:1px solid #444;background:#2d2d44;color:#fff;font-size:12px"><option value=baseline>baseline (single memo)</option><option value=noMemos>noMemos (direct access)</option><option value=splitMemo>splitMemo (static+dynamic)</option><option value=minimal>minimal (no handlers)</option></select><select style="padding:6px 10px;border-radius:4px;border:1px solid #444;background:#2d4444;color:#fff;font-size:12px"><option value=combined>combined (single memo)</option><option value=xySplit>xySplit (X/Y separate)</option><option value=smartCache>smartCache (skip unchanged)</option><option value=splitEquals>splitEquals (custom equality)</option><option value=untracked>untracked (no subscriptions)</option><option value=plainLookup>plainLookup (initialTasks)</option><option value=xBucket>xBucket (spatial index)</option><option value=xBucketStart>xBucketStart (no dedup)</option><option value=2D>2D (row+bucket)</option></select><span style=font-size:11px;color:#888>Visible: </span></div><div style="flex:1;border:1px solid #333;border-radius:8px;overflow:hidden;background:#1a1a1a;--g-header-bg-color:#1a1a1a;--g-header-text-color:#ccc;--g-header-text-color-secondary:#888;--g-grid-line-color:#333;--g-resource-bg:#1a1a1a;--g-text-color:#aaa;--g-row-color:#1a1a1a;--g-grid-bg-color:#1a1a1a">'),ge=N('<button style="padding:6px 12px;background:#ef4444;color:#fff;border:none;border-radius:4px;cursor:pointer">Stop (<!>)'),pe=N('<div style=display:flex;gap:6px><button style="padding:6px 10px;background:#8b5cf6;color:#fff;border:none;border-radius:4px;cursor:pointer">V-Scroll</button><button style="padding:6px 10px;background:#3b82f6;color:#fff;border:none;border-radius:4px;cursor:pointer">H-Scroll</button><button style="padding:6px 10px;background:#059669;color:#fff;border:none;border-radius:4px;cursor:pointer">Both'),fe=N("<div style=position:absolute;top:0;left:0;pointer-events:auto>");const H=28,G=4,he=50,Ct=2,Mt=200,Rt=6,j=144;function Dt(t){const[i,c]=t.split(" "),[r,l,k]=i.split("-").map(Number),[b,a]=(c||"00:00").split(":").map(Number);return new Date(Date.UTC(r,l-1,k,b,a))}const dt=ne.tasks.map(t=>({...t,_start:Dt(t.start),_end:Dt(t.end)})),be=Math.min(...dt.map(t=>t._start.getTime())),xe=Math.max(...dt.map(t=>t._end.getTime())),gt=new Date(be),pt=new Date(xe),vt=new Date(Date.UTC(gt.getUTCFullYear(),gt.getUTCMonth(),gt.getUTCDate())),ve=new Date(Date.UTC(pt.getUTCFullYear(),pt.getUTCMonth(),pt.getUTCDate()+1)),mt=[...new Set(dt.map(t=>t.resource))].sort(),K={};mt.forEach((t,i)=>{K[t]=i});const lt=mt.length,kt=Math.round((ve-vt)/(1440*60*1e3)),ct=kt*j,ft=lt*(H+G),Ht=[];for(let t=0;t<kt;t++){const i=new Date(vt.getTime()+t*24*60*60*1e3);Ht.push({x:t*j,width:j,upperText:t===0?se.format(i,"MMM YYYY"):i.getUTCDay()===1?`W${Math.ceil((t+1)/7)}`:"",lowerText:i.getUTCDate().toString(),isThickLine:i.getUTCDay()===1})}const me=mt.map((t,i)=>({id:t,name:t,type:"resource",displayIndex:i})),ke={displayResources:()=>me},we={barHeight:()=>H,padding:()=>G},Y=(()=>{const t={},i=vt.getTime();return dt.forEach((c,r)=>{const l=K[c.resource]??0,k=(c._start.getTime()-i)/(1e3*60*60),b=(c._end.getTime()-i)/(1e3*60*60),a=k*Rt,o=(b-k)*Rt;t[c.id]={...c,locked:r%7===0,progress:c.progress||0,_bar:{x:a,y:l*(H+G),width:Math.max(o,6),height:H}}}),t})(),X=(()=>{const t={};for(let i=0;i<lt;i++)t[i]=[];return Object.entries(Y).forEach(([i,c])=>{const r=K[c.resource]??0;t[r].push(i)}),t})(),C=j,$e=(()=>{const t={};return Object.entries(Y).forEach(([i,c])=>{const r=c._bar,l=Math.floor(r.x/C),k=Math.floor((r.x+r.width)/C);for(let b=l;b<=k;b++)(t[b]=t[b]||[]).push(i)}),t})(),Te=Object.fromEntries(Object.entries(Y).map(([t,i])=>[t,K[i.resource]??0])),ye=(()=>{const t={};return Object.entries(Y).forEach(([i,c])=>{const r=c._bar,l=Math.floor(r.x/C),k=Math.floor((r.x+r.width)/C),b=K[c.resource]??0;(t[l]=t[l]||[]).push({id:i,endBucket:k,row:b})}),t})(),Se=Math.ceil(Math.max(...Object.values(Y).map(t=>t._bar.width))/C)+1,_e=(()=>{const t={};return Object.entries(Y).forEach(([i,c])=>{const r=K[c.resource]??0,l=c._bar,k=Math.floor(l.x/C),b=Math.floor((l.x+l.width)/C);t[r]||(t[r]={});for(let a=k;a<=b;a++)(t[r][a]=t[r][a]||[]).push(i)}),t})();function It(t){const i=ht(),c=()=>typeof t.task=="function"?t.task():t.task,r=S(()=>{const a=c(),o=a?._bar,$=a?.progress??0,d=o?.width??40;return{colorBg:a?.color_bg??"rgba(59,130,246,0.15)",colorFill:a?.color_fill??"rgba(59,130,246,0.3)",locked:a?.locked??!1,name:a?.name??"",id:a?.id??"",x:o?.x??0,y:o?.y??0,width:d,height:o?.height??H,pw:d*$/100}}),l=()=>{const a=r(),o=a.pw;return`linear-gradient(to right, ${a.colorFill} 0px, ${a.colorFill} ${o}px, ${a.colorBg} ${o}px, ${a.colorBg} 100%)${a.locked?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:k,startDrag:b}=bt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var a=xt(),o=a.firstChild,$=o.nextSibling;return a.$$mousedown=d=>b(d,"dragging_bar",{taskId:r().id}),a.$$click=d=>i.onTaskClick?.(r().id,d),a.addEventListener("mouseleave",()=>i.onHoverEnd?.()),a.addEventListener("mouseenter",d=>i.onHover?.(r().id,d.clientX,d.clientY)),R(a,()=>r().name,o),o.$$mousedown=d=>{d.stopPropagation(),b(d,"dragging_left",{taskId:r().id})},$.$$mousedown=d=>{d.stopPropagation(),b(d,"dragging_right",{taskId:r().id})},F(d=>{var u=`translate(${r().x}px, ${r().y}px)`,I=`${r().width}px`,O=`${r().height}px`,A=k()?"grabbing":"grab",q=l(),D=`${r().height}px`;return u!==d.e&&m(a,"transform",d.e=u),I!==d.t&&m(a,"width",d.t=I),O!==d.a&&m(a,"height",d.a=O),A!==d.o&&m(a,"cursor",d.o=A),q!==d.i&&m(a,"background",d.i=q),D!==d.n&&m(a,"line-height",d.n=D),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a})()}function Ee(t){const i=ht(),c=()=>typeof t.task=="function"?t.task():t.task,r=()=>c()?.color_bg??"rgba(59,130,246,0.15)",l=()=>c()?.color_fill??"rgba(59,130,246,0.3)",k=()=>c()?.name??"",b=()=>c()?.id??"",a=()=>c()?.progress??0,o=()=>c()?.locked??!1,$=()=>c()?._bar?.x??0,d=()=>c()?._bar?.y??0,u=()=>c()?._bar?.width??40,I=()=>c()?._bar?.height??H,O=()=>u()*a()/100,A=()=>{const w=r(),T=l(),E=O();return`linear-gradient(to right, ${T} 0px, ${T} ${E}px, ${w} ${E}px, ${w} 100%)${o()?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:q,startDrag:D}=bt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var w=xt(),T=w.firstChild,E=T.nextSibling;return w.$$mousedown=x=>D(x,"dragging_bar",{taskId:b()}),w.$$click=x=>i.onTaskClick?.(b(),x),w.addEventListener("mouseleave",()=>i.onHoverEnd?.()),w.addEventListener("mouseenter",x=>i.onHover?.(b(),x.clientX,x.clientY)),R(w,k,T),T.$$mousedown=x=>{x.stopPropagation(),D(x,"dragging_left",{taskId:b()})},E.$$mousedown=x=>{x.stopPropagation(),D(x,"dragging_right",{taskId:b()})},F(x=>{var et=`translate(${$()}px, ${d()}px)`,ot=`${u()}px`,nt=`${I()}px`,V=q()?"grabbing":"grab",z=A(),Z=`${I()}px`;return et!==x.e&&m(w,"transform",x.e=et),ot!==x.t&&m(w,"width",x.t=ot),nt!==x.a&&m(w,"height",x.a=nt),V!==x.o&&m(w,"cursor",x.o=V),z!==x.i&&m(w,"background",x.i=z),Z!==x.n&&m(w,"line-height",x.n=Z),x},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),w})()}function Ce(t){const i=ht(),c=()=>typeof t.task=="function"?t.task():t.task,r=S(()=>{const o=c();return{colorBg:o?.color_bg??"rgba(59,130,246,0.15)",colorFill:o?.color_fill??"rgba(59,130,246,0.3)",name:o?.name??"",id:o?.id??"",locked:o?.locked??!1}}),l=S(()=>{const o=c(),$=o?._bar,d=o?.progress??0,u=$?.width??40;return{x:$?.x??0,y:$?.y??0,width:u,height:$?.height??H,pw:u*d/100}}),k=()=>{const o=r(),$=l();return`linear-gradient(to right, ${o.colorFill} 0px, ${o.colorFill} ${$.pw}px, ${o.colorBg} ${$.pw}px, ${o.colorBg} 100%)${o.locked?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:b,startDrag:a}=bt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var o=xt(),$=o.firstChild,d=$.nextSibling;return o.$$mousedown=u=>a(u,"dragging_bar",{taskId:r().id}),o.$$click=u=>i.onTaskClick?.(r().id,u),o.addEventListener("mouseleave",()=>i.onHoverEnd?.()),o.addEventListener("mouseenter",u=>i.onHover?.(r().id,u.clientX,u.clientY)),R(o,()=>r().name,$),$.$$mousedown=u=>{u.stopPropagation(),a(u,"dragging_left",{taskId:r().id})},d.$$mousedown=u=>{u.stopPropagation(),a(u,"dragging_right",{taskId:r().id})},F(u=>{var I=`translate(${l().x}px, ${l().y}px)`,O=`${l().width}px`,A=`${l().height}px`,q=b()?"grabbing":"grab",D=k(),w=`${l().height}px`;return I!==u.e&&m(o,"transform",u.e=I),O!==u.t&&m(o,"width",u.t=O),A!==u.a&&m(o,"height",u.a=A),q!==u.o&&m(o,"cursor",u.o=q),D!==u.i&&m(o,"background",u.i=D),w!==u.n&&m(o,"line-height",u.n=w),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()}function Me(t){const i=()=>typeof t.task=="function"?t.task():t.task,c=()=>i()?._bar;return(()=>{var r=de();return R(r,()=>i()?.name??""),F(l=>{var k=`translate(${c()?.x??0}px, ${c()?.y??0}px)`,b=`${c()?.width??40}px`,a=`${c()?.height??H}px`,o=i()?.color??"#3b82f6";return k!==l.e&&m(r,"transform",l.e=k),b!==l.t&&m(r,"width",l.t=b),a!==l.a&&m(r,"height",l.a=a),o!==l.o&&m(r,"background",l.o=o),l},{e:void 0,t:void 0,a:void 0,o:void 0}),r})()}const Re={baseline:It,noMemos:Ee,splitMemo:Ce,minimal:Me};function De(){const[t]=Ft(Y),i=Object.keys(t),c=new URLSearchParams(window.location.search),r=c.get("variant")||"baseline",l=c.get("test"),k=c.get("virt")||"combined",[b,a]=U(r),[o,$]=U(k),[d,u]=U(1200),[I,O]=U(800),[A,q]=U(0),[D,w]=U(0),T=S(()=>{const e=D(),n=Math.floor(e/(H+G)),s=Math.ceil((e+I())/(H+G))+Ct;return{start:Math.max(0,n-Ct),end:Math.min(s,lt)}}),E=S(()=>{const e=A();return{start:Math.max(0,e-Mt),end:e+d()+Mt}});let x=[];const et=S(()=>{if(o()!=="combined")return x;const e=T(),n=E(),s=[];for(let g=e.start;g<e.end;g++){const f=X[g]||[];for(const h of f){const p=t[h],v=p?._bar;if(!v)continue;v.x+v.width>=n.start&&v.x<=n.end&&s.push(p)}}return s}),ot=S(()=>{if(o()!=="xySplit")return[];const e=T(),n=[];for(let s=e.start;s<e.end;s++){const g=X[s]||[];for(const f of g)n.push(t[f])}return n}),nt=S(()=>{if(o()!=="xySplit")return[];const e=E(),n=ot(),s=[];for(const g of n){const f=g?._bar;if(!f)continue;f.x+f.width>=e.start&&f.x<=e.end&&s.push(g)}return s});let V=[],z=[],Z=-1,wt=-1,$t=-1,Tt=-1;const Lt=S(()=>{if(o()!=="smartCache")return[];const e=T(),n=E(),s=e.start!==Z||e.end!==wt,g=n.start!==$t||n.end!==Tt;if(s){V=[];for(let f=e.start;f<e.end;f++)for(const h of X[f]||[])V.push(t[h]);Z=e.start,wt=e.end}if(s||g){z=[];for(const f of V){const h=f?._bar;h&&h.x+h.width>=n.start&&h.x<=n.end&&z.push(f)}$t=n.start,Tt=n.end}return z}),yt=(e,n)=>e.length===n.length&&e.every((s,g)=>s===n[g]),Ot=S(()=>{if(o()!=="splitEquals")return[];const e=T(),n=[];for(let s=e.start;s<e.end;s++)for(const g of X[s]||[])n.push(g);return n},{equals:yt}),At=S(()=>{if(o()!=="splitEquals")return[];const e=Ot(),n=E(),s=[];for(const g of e){const h=t[g]?._bar;h&&h.x+h.width>=n.start&&h.x<=n.end&&s.push(g)}return s},{equals:yt}),qt=S(()=>o()!=="splitEquals"?[]:At().map(n=>t[n])),Ut=S(()=>{if(o()!=="untracked")return[];const e=T(),n=E();return re(()=>{const s=[];for(let g=e.start;g<e.end;g++){const f=X[g]||[];for(const h of f){const p=t[h],v=p?._bar;if(!v)continue;v.x+v.width>=n.start&&v.x<=n.end&&s.push(p)}}return s})}),Wt=S(()=>{if(o()!=="plainLookup")return[];const e=T(),n=E(),s=[];for(let g=e.start;g<e.end;g++){const f=X[g]||[];for(const h of f){const p=Y[h]._bar;p.x+p.width>=n.start&&p.x<=n.end&&s.push(t[h])}}return s}),Yt=S(()=>{if(o()!=="xBucket")return[];const e=E(),n=T(),s=Math.floor(e.start/C),g=Math.floor(e.end/C),f={},h=[];for(let p=s;p<=g;p++)for(const v of $e[p]||[]){if(f[v])continue;f[v]=1;const _=Te[v];_>=n.start&&_<n.end&&h.push(t[v])}return h}),Pt=S(()=>{if(o()!=="xBucketStart")return[];const e=E(),n=T(),s=Math.floor(e.start/C),g=Math.floor(e.end/C),f=Math.max(0,s-Se),h=[];for(let p=f;p<=g;p++)for(const{id:v,endBucket:_,row:y}of ye[p]||[])_>=s&&y>=n.start&&y<n.end&&h.push(t[v]);return h}),Vt=S(()=>{if(o()!=="2D")return[];const e=E(),n=T(),s=Math.floor(e.start/C),g=Math.floor(e.end/C),f=[];for(let h=n.start;h<n.end;h++){const p=_e[h];if(!p)continue;const v={};for(let _=s;_<=g;_++)for(const y of p[_]||[])v[y]||(v[y]=1,f.push(t[y]))}return f}),St=()=>{const e=o();return e==="xySplit"?nt():e==="smartCache"?Lt():e==="splitEquals"?qt():e==="untracked"?Ut():e==="plainLookup"?Wt():e==="xBucket"?Yt():e==="xBucketStart"?Pt():e==="2D"?Vt():et()};let P,J=null;const[_t,rt]=U(!1),[zt,st]=U(null),at=e=>{if(_t()){J&&(J.abort=!0),rt(!1),st(null);return}rt(!0),st(e);const n={abort:!1};J=n;let s=1,g=1;const f=1e4,h=performance.now(),p=P?.querySelector(".gantt-scroll-area"),v=p?p.scrollHeight-p.clientHeight:0,_=p?p.scrollWidth-p.clientWidth:0;let y=p?p.scrollTop:0,L=p?p.scrollLeft:0;const Q=()=>{if(n.abort||performance.now()-h>f){rt(!1),st(null);return}p&&((e==="vertical"||e==="both")&&(y+=s*100,y>=v?(s=-1,y=v):y<=0&&(s=1,y=0),p.scrollTop=y),(e==="horizontal"||e==="both")&&(L+=g*150,L>=_?(g=-1,L=_):L<=0&&(g=1,L=0),p.scrollLeft=L)),requestAnimationFrame(Q)};requestAnimationFrame(Q)};jt(()=>{const e=()=>{if(P){const s=P.querySelector(".gantt-scroll-area");s&&(u(s.clientWidth),O(s.clientHeight))}};setTimeout(e,100);const n=new ResizeObserver(e);P&&n.observe(P),ae(()=>n.disconnect()),l&&["vertical","horizontal","both"].includes(l)&&setTimeout(()=>at(l),500)});const Xt=()=>Re[b()]||It;return W(oe,{get children(){var e=ue(),n=e.firstChild,s=n.firstChild,g=s.firstChild,f=g.nextSibling,h=f.nextSibling,p=h.nextSibling,v=p.nextSibling,_=v.nextSibling;_.nextSibling;var y=s.nextSibling,L=y.nextSibling,Q=L.nextSibling;Q.firstChild;var ut=n.nextSibling;R(s,kt,f),R(s,lt,p),R(s,()=>i.length,_),y.addEventListener("change",M=>a(M.target.value)),L.addEventListener("change",M=>$(M.target.value)),R(Q,()=>St().length,null),R(n,(()=>{var M=Nt(()=>!!_t());return()=>M()?(()=>{var B=ge(),it=B.firstChild,tt=it.nextSibling;return tt.nextSibling,B.$$click=()=>{J&&(J.abort=!0),rt(!1),st(null)},R(B,zt,tt),B})():(()=>{var B=pe(),it=B.firstChild,tt=it.nextSibling,Gt=tt.nextSibling;return it.$$click=()=>at("vertical"),tt.$$click=()=>at("horizontal"),Gt.$$click=()=>at("both"),B})()})(),null);var Et=P;return typeof Et=="function"?ee(Et,ut):P=ut,R(ut,W(le,{svgWidth:ct,svgHeight:ft,resourceColumnWidth:60,headerHeight:he,onScroll:(M,B)=>{q(M),w(B)},get header(){return W(te,{dateInfos:Ht,columnWidth:j,gridWidth:ct,upperHeaderHeight:25,lowerHeaderHeight:25})},get resourceColumn(){return W(Qt,{resourceStore:ke,ganttConfig:we,width:60,get startRow(){return T().start},get endRow(){return T().end}})},get barsLayer(){return(()=>{var M=fe();return m(M,"width",`${ct}px`),m(M,"height",`${ft}px`),R(M,W(Zt,{get each(){return St()},children:B=>W(Jt,{get component(){return Xt()},task:B})})),M})()},get children(){return W(Kt,{width:ct,height:ft,barHeight:H,padding:G,taskCount:0,columnWidth:j,lines:"vertical",backgroundColor:"#1a1a1a",lineColor:"#333",thickLineColor:"#444"})}})),F(()=>y.value=b()),F(()=>L.value=o()),e}})}ie(["click","mousedown"]);const Bt=document.getElementById("app");Bt&&ce(()=>W(De,{}),Bt);
