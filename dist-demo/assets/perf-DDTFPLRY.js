import{c as I,o as de,a as jn,r as De,p as He,d as O,b as B,u as Un,e as We,f as Re,g as Ct,t as Dt,i as ct,h as xt,j as ue,s as it,k as q,l as pe,m as ht,S as Gn,F as Ye,n as Mt,I as ge,q as fe,G as Nn,v as he,D as On,R as Jn,w as Kn,x as Qn,y as tt,z as Zn,A as to}from"./calendar-PDbbVejm.js";import{d as eo,b as no,r as Pe,c as oo,a as so,T as ro,e as ao}from"./TaskDataModal-BGdFIdw_.js";import{G as io}from"./GanttContainer-CxIJ5yVC.js";function lo(t){const[e,o]=I(!1);let n=0;const s=d=>{n=requestAnimationFrame(s),t(d)},r=()=>{e()||(o(!0),n=requestAnimationFrame(s))},h=()=>{o(!1),cancelAnimationFrame(n)};return de(h),[e,r,h]}function co(){const[t,e]=jn({}),[o,n]=I(new Set),[s,r]=I(null);return{tasks:t,getTask:a=>t[a],getBarPosition:a=>{const i=t[a];return!i||!i._bar?null:{x:i._bar.x,y:i._bar.y,width:i._bar.width,height:i._bar.height,index:i._index}},getAllTasks:()=>Object.values(t).filter(a=>a!==void 0),taskCount:()=>Object.keys(t).length,updateTask:(a,i)=>{e(a,i)},updateBarPosition:(a,i)=>{t[a]&&e(He(H=>{const A=H[a];A&&A._bar&&(H[a]={...A,_bar:{...A._bar,...i}})}))},updateTasks:a=>{const i={};a.forEach(H=>{i[H.id]=H}),e(De(i))},batchMovePositions:(a,i)=>{e(He(H=>{for(const[A,{originalX:z}]of a){const J=H[A];J?._bar&&(H[A]={...J,_bar:{...J._bar,x:z+i}})}}))},removeTask:a=>{e(a,void 0)},clear:()=>{e(De({}))},collapsedTasks:o,toggleTaskCollapse:a=>{n(i=>{const H=new Set(i);return H.has(a)?H.delete(a):H.add(a),H})},isTaskCollapsed:a=>o().has(a),expandTask:a=>{n(i=>{if(!i.has(a))return i;const H=new Set(i);return H.delete(a),H})},collapseTask:a=>{n(i=>{if(i.has(a))return i;const H=new Set(i);return H.add(a),H})},expandAllTasks:()=>{n(new Set)},collapseAllTasks:()=>{const a=[];for(const i of Object.values(t))i&&(i.type==="summary"||i._children&&i._children.length>0)&&a.push(i.id);n(new Set(a))},draggingTaskId:s,setDraggingTaskId:r}}function uo(t={}){const[e,o]=I(t.ganttStart||new Date),[n,s]=I(t.ganttEnd||new Date),[r,h]=I(t.unit||"day"),[d,m]=I(t.step||1),[M,f]=I(t.columnWidth||t.column_width||45),[c,R]=I(t.barHeight||t.bar_height||30),[E,P]=I(t.headerHeight||75),[S,x]=I(t.padding||18),[l,b]=I(t.barCornerRadius||t.bar_corner_radius||3),[y,T]=I(t.readonly||!1),[X,a]=I(t.readonlyDates||!1),[i,H]=I(t.readonlyProgress||!1),[A,z]=I(t.showExpectedProgress||!1),[J,st]=I(t.autoMoveLabel||!1),[at,v]=I(t.ignoredDates||[]),[k,D]=I(t.ignoredFunction||null),[w,F]=I([]),[$,j]=I(t.subtaskHeightRatio||.5),[et,U]=I(t.renderMode||"simple"),[K,G]=I(new Set(t.expandedTasks||[]));return{ganttStart:e,ganttEnd:n,unit:r,step:d,columnWidth:M,barHeight:c,headerHeight:E,padding:S,barCornerRadius:l,readonly:y,readonlyDates:X,readonlyProgress:i,showExpectedProgress:A,autoMoveLabel:J,ignoredDates:at,ignoredFunction:k,ignoredPositions:w,subtaskHeightRatio:$,renderMode:et,expandedTasks:K,setGanttStart:o,setGanttEnd:s,setUnit:h,setStep:m,setColumnWidth:f,setBarHeight:R,setHeaderHeight:P,setPadding:x,setBarCornerRadius:b,setReadonly:T,setReadonlyDates:a,setReadonlyProgress:H,setShowExpectedProgress:z,setAutoMoveLabel:st,setIgnoredDates:v,setIgnoredFunction:D,setIgnoredPositions:F,setSubtaskHeightRatio:j,setRenderMode:U,setExpandedTasks:G,isTaskExpanded:p=>K().has(p),toggleTaskExpansion:p=>{G(ot=>{const nt=new Set(ot);return nt.has(p)?nt.delete(p):nt.add(p),nt})},expandTask:p=>{G(ot=>{if(ot.has(p))return ot;const nt=new Set(ot);return nt.add(p),nt})},collapseTask:p=>{G(ot=>{if(!ot.has(p))return ot;const nt=new Set(ot);return nt.delete(p),nt})},expandAllTasks:p=>{G(new Set(p))},collapseAllTasks:()=>{G(new Set)},updateOptions:p=>{if(p.ganttStart!==void 0&&o(p.ganttStart),p.ganttEnd!==void 0&&s(p.ganttEnd),p.unit!==void 0&&h(p.unit),p.step!==void 0&&m(p.step),p.columnWidth!==void 0&&f(p.columnWidth),p.barHeight!==void 0&&R(p.barHeight),p.headerHeight!==void 0&&P(p.headerHeight),p.padding!==void 0&&x(p.padding),p.barCornerRadius!==void 0&&b(p.barCornerRadius),p.readonly!==void 0&&T(p.readonly),p.readonlyDates!==void 0&&a(p.readonlyDates),p.readonlyProgress!==void 0&&H(p.readonlyProgress),p.showExpectedProgress!==void 0&&z(p.showExpectedProgress),p.autoMoveLabel!==void 0&&st(p.autoMoveLabel),p.ignoredDates!==void 0&&v(p.ignoredDates),p.ignoredFunction!==void 0){const ot=p.ignoredFunction;D(()=>ot)}p.ignoredPositions!==void 0&&F(p.ignoredPositions),p.subtaskHeightRatio!==void 0&&j(p.subtaskHeightRatio),p.renderMode!==void 0&&U(p.renderMode),p.expandedTasks!==void 0&&G(new Set(p.expandedTasks))},getConfig:()=>({ganttStart:e(),ganttEnd:n(),unit:r(),step:d(),columnWidth:M(),barHeight:c(),headerHeight:E(),padding:S(),barCornerRadius:l(),readonly:y(),readonlyDates:X(),readonlyProgress:i(),showExpectedProgress:A(),autoMoveLabel:J(),ignoredDates:at(),ignoredFunction:k(),ignoredPositions:w(),subtaskHeightRatio:$(),renderMode:et(),expandedTasks:Array.from(K())})}}function ce(t){const e=t.getFullYear();return e-e%10+""}function go(t,e,o){const n=O.add(t,6,"day"),s=n.getMonth()!==t.getMonth()?"D MMM":"D",r=!e||t.getMonth()!==e.getMonth()?"D MMM":"D";return`${O.format(t,r,o)} - ${O.format(n,s,o)}`}const Qt=[{name:"Minute",padding:"1h",step:"1min",column_width:20,date_format:"YYYY-MM-DD HH:mm",lower_text:"mm",upper_text:(t,e,o)=>!e||t.getHours()!==e.getHours()?O.format(t,"D MMM HH:00",o):"",upper_text_frequency:60},{name:"Quarter Hour",padding:"6h",step:"15min",column_width:30,date_format:"YYYY-MM-DD HH:mm",lower_text:"mm",upper_text:(t,e,o)=>!e||t.getHours()!==e.getHours()?O.format(t,"D MMM HH:00",o):"",upper_text_frequency:4},{name:"Hour",padding:"7d",step:"1h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,o)=>!e||t.getDate()!==e.getDate()?O.format(t,"D MMMM",o):"",upper_text_frequency:24},{name:"Quarter Day",padding:"7d",step:"6h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,o)=>!e||t.getDate()!==e.getDate()?O.format(t,"D MMM",o):"",upper_text_frequency:4},{name:"Half Day",padding:"14d",step:"12h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,o)=>!e||t.getDate()!==e.getDate()?t.getMonth()!==e?.getMonth()?O.format(t,"D MMM",o):O.format(t,"D",o):"",upper_text_frequency:2},{name:"Day",padding:"7d",date_format:"YYYY-MM-DD",step:"1d",lower_text:(t,e,o)=>!e||t.getDate()!==e.getDate()?O.format(t,"D",o):"",upper_text:(t,e,o)=>!e||t.getMonth()!==e.getMonth()?O.format(t,"MMMM",o):"",thick_line:t=>t.getDay()===1},{name:"Week",padding:"1m",step:"7d",date_format:"YYYY-MM-DD",column_width:140,lower_text:go,upper_text:(t,e,o)=>!e||t.getMonth()!==e.getMonth()?O.format(t,"MMMM",o):"",thick_line:t=>t.getDate()>=1&&t.getDate()<=7,upper_text_frequency:4},{name:"Month",padding:"2m",step:"1m",column_width:120,date_format:"YYYY-MM",lower_text:"MMMM",upper_text:(t,e,o)=>!e||t.getFullYear()!==e.getFullYear()?O.format(t,"YYYY",o):"",thick_line:t=>t.getMonth()%3===0,snap_at:"7d"},{name:"Year",padding:"2y",step:"1y",column_width:120,date_format:"YYYY",upper_text:(t,e,o)=>!e||ce(t)!==ce(e)?ce(t):"",lower_text:"YYYY",snap_at:"30d"}];function fo(t={}){const[e,o]=I(t.ganttStart||new Date),[n,s]=I(t.ganttEnd||new Date),[r,h]=I([]),d=Qt.find(v=>v.name==="Day")||Qt[3],m=t.viewMode||t.view_mode,M=m&&Qt.find(v=>v.name===m)||d,[f,c]=I(M),[R]=I(t.viewModes||Qt),[E,P]=I(t.language||"en"),S=B(()=>r().length),x=B(()=>{const v=f();return O.parse_duration(v.step)}),l=B(()=>x()?.scale||"day"),b=B(()=>x()?.duration||1),[y]=I(t.columnWidth||t.column_width||null),T=B(()=>y()||f().column_width||45),X=B(()=>S()*T()),a=(v,k=!1)=>{if(!v||v.length===0){const W=O.today(),lt=f(),ut=O.parse_duration(lt.padding||"7d"),yt=ut?.duration||7,pt=ut?.scale||"day",_t=O.add(W,-yt,pt),_=O.add(W,yt,pt);o(O.start_of(_t,l())),s(_),i();return}let D=null,w=null;for(const W of v){const lt=W._start||O.parse(W.start||""),ut=W._end||O.parse(W.end||"");(!D||lt<D)&&(D=lt),(!w||ut>w)&&(w=ut)}const F=f(),$=O.parse_duration(F.padding||"7d"),j=$?.duration||7,et=$?.scale||"day";let U=O.add(D,-j,et),K=O.add(w,j,et);k&&(U=O.add(U,-30,l()),K=O.add(K,30,l())),U=O.start_of(U,l());const G=l();G!=="hour"&&G!=="minute"&&U.setHours(0,0,0,0),o(U),s(K),i()},i=()=>{const v=e(),k=n(),D=b(),w=l(),F=[];let $=new Date(v);for(;$<k;)F.push(new Date($)),$=O.add($,D,w);h(F)},H=(v,k=10)=>{const D=b(),w=l();if(v==="left"){const F=O.add(e(),-k*D,w);o(F)}else{const F=O.add(n(),k*D,w);s(F)}i()},A=v=>{if(typeof v=="string"){const k=R().find(D=>D.name===v);k&&(c(k),i())}else v&&v.name&&(c(v),i())},z=(v,k,D=null)=>{const w=f(),F=E(),$=T(),j=k*$;let et="";typeof w.lower_text=="function"?et=w.lower_text(v,D,F):typeof w.lower_text=="string"&&(et=O.format(v,w.lower_text,F));let U="";typeof w.upper_text=="function"?U=w.upper_text(v,D,F):typeof w.upper_text=="string"&&(U=O.format(v,w.upper_text,F));const K=w.thick_line?w.thick_line(v):!1;return{date:v,x:j,width:$,lowerText:et,upperText:U,isThickLine:K}},J=B(()=>{const v=r(),k=[];let D=null;for(let w=0;w<v.length;w++){const F=v[w];if(F){const $=z(F,w,D);k.push($),D=F}}return k});return{ganttStart:e,ganttEnd:n,dates:r,viewMode:f,viewModes:R,language:E,setGanttStart:o,setGanttEnd:s,setViewMode:A,setLanguage:P,dateCount:S,unit:l,step:b,columnWidth:T,gridWidth:X,getAllDateInfos:J,setupDates:a,generateDates:i,extendTimeline:H,changeViewMode:A,getDateInfo:z,dateToX:v=>{const k=e(),D=b(),w=l(),F=T();return O.diff(v,k,w)/D*F},xToDate:v=>{const k=e(),D=b(),w=l(),F=T(),$=v/F*D;return O.add(k,$,w)}}}function Ie(t){return!t||t.length===0?[]:t.map(e=>typeof e=="object"&&e!==null?{...e,id:e.id||e.name||String(e),type:e.type||"resource",group:e.group||void 0}:{id:String(e),type:"resource",group:void 0})}function ho(t,e){const o=[];for(const n of t){if(n.type==="group"){o.push({...n,displayIndex:o.length,isCollapsed:e.has(n.id)});continue}n.group&&e.has(n.group)||o.push({...n,displayIndex:o.length})}return o}function mo(t){if(!t||t.length===0)return[];const e=new Set,o=[];for(const n of t){const s=n.resource||"Unassigned";e.has(s)||(e.add(s),o.push({id:s,type:"resource",group:void 0}))}return o}function vo(t=[]){const[e,o]=I(Ie(t)),[n,s]=I(new Set),r=B(()=>ho(e(),n())),h=B(()=>{const x=new Map,l=r();for(let b=0;b<l.length;b++){const y=l[b];y&&x.set(y.id,b)}return x}),d=B(()=>r().length),m=x=>{s(l=>{const b=new Set(l);return b.has(x)?b.delete(x):b.add(x),b})},M=x=>{s(l=>{const b=new Set(l);return b.delete(x),b})},f=x=>{s(l=>{const b=new Set(l);return b.add(x),b})},c=x=>n().has(x),R=x=>{o(Ie(x))},E=B(()=>e().filter(x=>x.type==="group"));return{resources:e,collapsedGroups:n,displayResources:r,resourceIndexMap:h,displayCount:d,getGroups:E,updateResources:R,toggleGroup:m,expandGroup:M,collapseGroup:f,isGroupCollapsed:c,expandAll:()=>{s(new Set)},collapseAll:()=>{const x=E();s(new Set(x.map(l=>l.id)))}}}function po(t,e,o,n,s){return O.diff(t,e,o)/n*s}function bo(t,e,o){const n=e+o;return t*n+o/2}function yo(t,e,o,n,s){return O.diff(e,t,o)/n*s}function Fe(t,e,o,n=[],s=45){const r=t+e,h=new Set(n.map(E=>Math.floor(E/s))),m=n.reduce((E,P)=>E+(P>=t&&P<r?1:0),0)*s;let M=(e-m)*o/100;const f=t+M,c=n.reduce((E,P)=>E+(P>=t&&P<f?1:0),0);M+=c*s;let R=t+M;for(;R<r;){const E=Math.floor(R/s);if(h.has(E))M+=s,R=t+M;else break}return Math.min(M,e)}function ko(t,e,o,n){const s=O.today(),r=O.diff(e,t,"hour")/n,h=O.diff(s,t,"hour")/n,d=Math.min(h,r);return r>0?d*100/r:0}function xo(t,e,o){return e.some(n=>t>=n&&t<n+o)}function me(t,e,o=[]){let n=Math.round(t/e)*e;for(;xo(n,o,e);)n+=e;return n}function ze(t,e,o,n=7){return o.length*n+10<e?{x:t+e/2,position:"inside"}:{x:t+e+5,position:"outside"}}function wo(t,e){return t instanceof Map?t.get(e):t[e]}function So(t,e,o=20){if(!t._children||t._children.length===0)return null;const n=[],s=m=>{for(const M of m){const f=wo(e,M);f?._bar&&(n.push(f._bar),f._children&&f._children.length>0&&s(f._children))}};if(s(t._children),n.length===0)return null;const r=Math.min(...n.map(m=>m.x)),h=Math.max(...n.map(m=>m.x+m.width)),d=Math.max(h-r,o);return{x:r,width:d}}function _o(t){let e=0;for(const o of t.values())o._depth!==void 0&&o._depth>e&&(e=o._depth);for(let o=e;o>=0;o--)for(const n of t.values())if(n._depth===o&&n.type==="summary"){const s=So(n,t);s&&n._bar&&(n._bar.x=s.x,n._bar.width=s.width)}}function To(t,e){return`task-${t.name||""}-${e}-${Date.now()}`.replace(/\s+/g,"-")}function Co(t){return t?Array.isArray(t)?t.filter(e=>e!=null&&typeof e=="object"&&typeof e.id=="string").map(e=>({id:e.id,type:e.type||"FS",lag:e.lag||0,max:e.max})):(console.warn("parseDependencies: dependencies must be an array, got:",typeof t,t),[]):[]}function Mo(t,e){const o=t.id||To(t,e),n=O.parse(t.start);let s;if(t.end)s=O.parse(t.end);else if(t.duration){const R=O.parse_duration(t.duration);if(R){const{duration:E,scale:P}=R;s=O.add(n,E,P)}else s=new Date(n)}else s=new Date(n);if(O.diff(s,n,"year")>10)return console.error(`Task "${t.name}" has duration > 10 years`),null;let h=n,d=s;s<n&&(console.warn(`Task "${t.name}" has end before start, swapping`),[h,d]=[s,n]);const m=Co(t.dependencies),M=typeof t.progress=="number"?t.progress:0,f=Math.max(0,Math.min(100,M)),c={locked:!1,...t.constraints};return{id:o,name:t.name||"",start:t.start,_start:h,_end:d,_index:e,progress:f,constraints:c,dependencies:m,_children:[],_depth:0,end:t.end,duration:t.duration,resource:t.resource,parentId:t.parentId,type:t.type,color:t.color,color_progress:t.color_progress,color_bg:t.color_bg,color_fill:t.color_fill,subtaskLayout:t.subtaskLayout,order:t.order}}function Do(t,e,o=null){const n=[],s=[];for(let f=0;f<t.length;f++){const c=t[f];if(!c)continue;const R=Mo(c,f);R&&n.push(R)}const r=new Set,h=[];for(const f of n){const c=f.resource||"Unassigned";r.has(c)||(r.add(c),h.push(c))}let d;o?d=o:(d=new Map,h.forEach((f,c)=>d.set(f,c)));const m=[];for(const f of n){const c=f.resource||"Unassigned",R=d.get(c),E=R!==void 0?R:-1,P=E<0,S=po(f._start,e.ganttStart,e.unit,e.step,e.columnWidth),x=P?-1e3:bo(E,e.barHeight,e.padding),l=yo(f._start,f._end,e.unit,e.step,e.columnWidth),b={...f,_bar:{x:S,y:x,width:l,height:e.barHeight},_resourceIndex:E,_isHidden:P};m.push(b);for(const y of f.dependencies)n.find(X=>X.id===y.id)&&s.push({from:y.id,to:f.id,type:y.type||"FS",lag:y.lag||0,elastic:!0})}const M=eo(s);return M.hasCycle&&console.warn(`Circular dependency detected: ${M.cycle.join(" â†’ ")}`,`
This may cause unexpected behavior during task dragging.`),{tasks:m,relationships:s,resources:h}}function Ho(t){let e=null,o=null;for(const n of t){const s=n._start,r=n._end;(!e||s<e)&&(e=s),(!o||r>o)&&(o=r)}return{minDate:e||new Date,maxDate:o||new Date}}function Ro(t){return t?t instanceof Map?Array.from(t.entries()):Object.entries(t).filter(e=>e[1]!==void 0):[]}function Xe(t,e){return t?t instanceof Map?t.get(e)??null:t[e]??null:null}function Po(t,e,o,n){const{barHeight:s=30,padding:r=18,subtaskHeightRatio:h=.5}=e,d=s+r,m=new Map;let M=0;const f=new Map;for(const[c,R]of Ro(n))R.resource&&(f.has(R.resource)||f.set(R.resource,[]),f.get(R.resource).push(R));for(const c of t){const R=[],E=f.get(c.id)||[];for(const a of E)a.parentId||a.type!=="project"&&o?.has(a.id)&&a._children&&a._children.length>0&&R.push(a);if(R.length>0){let a=0;for(const i of R)a+=Ee(i,e,n);E.filter(i=>!i.parentId&&i.type!=="project"&&!o?.has(i.id)).length}const P=new Map,S=M+r/2,x=[...E].filter(a=>!a.parentId).sort((a,i)=>{if(a.type==="project"&&i.type!=="project")return-1;if(i.type==="project"&&a.type!=="project")return 1;const H=a._start instanceof Date?a._start.getTime():a._start??0,A=i._start instanceof Date?i._start.getTime():i._start??0;return H-A}),l=[],b=(a,i)=>{const H=a._start??a._bar?.x??0,A=a._end??(a._bar?.x??0)+(a._bar?.width??1);for(const z of i.occupiedRanges)if(!(A<=z.start||H>=z.end))return!0;return!1},y=(a,i)=>{const H=a._start??a._bar?.x??0,A=a._end??(a._bar?.x??0)+(a._bar?.width??1);for(const st of l)if(!b(a,st))return st.occupiedRanges.push({start:H,end:A}),st.height=Math.max(st.height,i),st.y;const z=l[l.length-1],J=l.length===0?S:z.y+z.height;return l.push({y:J,height:i,occupiedRanges:[{start:H,end:A}]}),J};for(const a of x){const i=o?.has(a.id)&&a._children&&a._children.length>0;let H,A;if(i){H=Ee(a,e,n);const z=a.subtaskLayout||"sequential",J=z==="sequential"?s:H;A=y(a,z==="sequential"?d:H),P.set(a.id,{y:A,height:J,x:a._bar?.x,width:a._bar?.width,isExpanded:!0});const at=s*h,v=r*.4;if(a._children){const k=z==="mixed"||z==="parallel"?Ve(a._children,n):null,D=(s-at)/2;a._children.forEach((w,F)=>{if(!Xe(n,w))return;let j;if(z==="sequential")j=A+D;else{const et=k?.get(w)??F;j=A+D+et*(at+v)}P.set(w,{y:j,height:at,isSubtask:!0})})}}else a.type==="project"?(H=s*.6,A=y(a,H),P.set(a.id,{y:A,height:H,isExpanded:!1})):(H=d,A=y(a,H),P.set(a.id,{y:A,height:s,isExpanded:!1}))}let T=S;for(const a of l)T=Math.max(T,a.y+a.height);const X=Math.max(d,T-M);m.set(c.id,{y:M,height:X,contentY:M+r/2,contentHeight:X-r,type:c.type,expandedTasks:R.map(a=>a.id),taskPositions:P}),M+=X}return m.set("__total__",{y:0,height:M}),m}function Ee(t,e,o){const{barHeight:n=30,padding:s=18,subtaskHeightRatio:r=.5}=e,h=n*r,d=s*.4,m=t._children||[];if(m.length===0)return n+s;const M=t.subtaskLayout||"sequential";if(M==="sequential")return n+s;if(M==="parallel"){const f=(n-h)/2,c=m.length;return f*2+c*h+(c-1)*d}return M==="mixed"?Io(t,e,o):n+s}function Ve(t,e){const o=new Map;if(!t?.length||!e)return o;const n=t.map(r=>Xe(e,r)).filter(r=>r!=null).sort((r,h)=>{if(r.order!==void 0&&h.order!==void 0)return r.order-h.order;const d=r._start instanceof Date?r._start.getTime():r._start??0,m=h._start instanceof Date?h._start.getTime():h._start??0;return d-m}),s=[];for(const r of n){const h=r._start,d=h instanceof Date?h.getTime():h??r._bar?.x??0,m=r._end,M=m instanceof Date?m.getTime():m??(r._bar?.x??0)+(r._bar?.width??1);let f=-1;for(let c=0;c<s.length;c++)if(!s[c].some(E=>!(M<=E.start||d>=E.end))){f=c,s[c].push({start:d,end:M});break}f===-1&&(f=s.length,s.push([{start:d,end:M}])),o.set(r.id,f)}return o}function Io(t,e,o){const{barHeight:n=30,padding:s=18,subtaskHeightRatio:r=.5}=e,h=n*r,d=s*.4,m=t._children||[];if(m.length===0)return n+s;const M=Ve(m,o),c=Math.max(0,...M.values())+1;return(n-h)/2*2+c*h+(c-1)*d}function $e(t,e){if(t.length===0)return-1;if(e<0)return 0;let o=0,n=t.length-1;for(;o<=n;){const s=Math.floor((o+n)/2),r=t[s];if(e>=r.y&&e<r.y+r.height)return s;e<r.y?n=s-1:o=s+1}return Math.min(o,t.length-1)}function Fo(t){const e=[];for(const[o,n]of t)o!=="__total__"&&e.push({id:o,...n});return e.sort((o,n)=>o.y-n.y),e}function Eo(t,e){const{barHeight:o=30,padding:n=18}=e,s=o+n,r=new Map;for(let h=0;h<t.length;h++){const d=t[h],m=h*s;r.set(d.id,{y:m,height:s,contentY:m+n/2,contentHeight:o,type:d.type})}return r.set("__total__",{y:0,height:t.length*s}),r}const Zt=(t,e)=>t?.start===e?.start&&t?.end===e?.end;function $o(t){const{scrollX:e,scrollY:o,viewportWidth:n,viewportHeight:s,columnWidth:r,rowHeight:h,totalRows:d,sortedRowLayouts:m,overscanCols:M=5,overscanRows:f=20,overscanX:c=2500}=t,R=B(()=>{const l=r(),b=e(),y=n();return l<=0||y<=0?{start:0,end:100}:{start:Math.max(0,Math.floor(b/l)-M),end:Math.ceil((b+y)/l)+M}},{start:0,end:100},{equals:Zt}),E=B(()=>{const l=o(),b=s(),y=d();if(b<=0)return{start:0,end:Math.min(y,30)};const T=m?.();if(T&&T.length>0){const a=Math.max(0,$e(T,l)-f),i=Math.min(y,$e(T,l+b)+1+f);return{start:a,end:i}}const X=h();return X<=0?{start:0,end:Math.min(y,30)}:{start:Math.max(0,Math.floor(l/X)-f),end:Math.min(y,Math.ceil((l+b)/X)+f)}},{start:0,end:30},{equals:Zt}),P=100,S=B(()=>{const l=e(),b=n();return{start:Math.max(0,Math.floor((l-c)/P)*P),end:Math.ceil((l+b+c)/P)*P}},{start:0,end:5e3},{equals:Zt}),x=B(()=>{const l=o(),b=s(),y=h?.()||48,T=f*y;return{start:Math.max(0,l-T),end:l+b+T}},{start:0,end:2e3},{equals:Zt});return{colRange:R,rowRange:E,xRange:S,yRange:x}}function qe(t,e){return t instanceof Map?t.get(e):t[e]}function Ao(t){const e=new Map;for(const s of t)s._children=[],s._depth=0,e.set(s.id,s);for(const s of t)if(s.parentId){const r=e.get(s.parentId);r&&(r._children.push(s.id),r.type||(r.type="summary"))}const o=t.filter(s=>!s.parentId),n=o.map(s=>({task:s,depth:0}));for(;n.length>0;){const s=n.shift();if(!s)break;const{task:r,depth:h}=s;r._depth=h;for(const d of r._children||[]){const m=e.get(d);m&&n.push({task:m,depth:h+1})}}for(const s of t)s.parentId&&s._depth===0&&!o.includes(s)&&(console.warn(`Circular or orphaned parent reference detected for task ${s.id}`),s._depth=0);return e}function Lo(t,e){const o=new Set,n=[t],s=r=>qe(e,r);for(;n.length>0;){const r=n.shift();if(!r)continue;const h=s(r);for(const d of h?._children||[])o.has(d)||(o.add(d),n.push(d))}return o}function Bo(t,e,o){const n=r=>qe(e,r);let s=n(t);for(;s?.parentId;){if(o.has(s.parentId))return!0;s=n(s.parentId)}return!1}var Wo=Dt('<div style=position:absolute><div class=bar style=position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box></div><div class=bar-expected-progress style=position:absolute;top:0;left:0;height:100%></div><div class=bar-progress style=position:absolute;top:0;left:0;height:100%;opacity:0.3></div><div style=position:absolute;top:50%;white-space:nowrap;pointer-events:none;font-size:12px></div><div style=position:absolute;top:2px;right:4px;font-size:10px;pointer-events:none>ðŸ”’</div><div class="handle handle-left"style="position:absolute;left:-2px;top:25%;width:4px;height:50%;border-radius:1px;background-color:var(--g-handle-color, #ddd);cursor:ew-resize;opacity:0"></div><div class="handle handle-right"style="position:absolute;right:-2px;top:25%;width:4px;height:50%;border-radius:1px;background-color:var(--g-handle-color, #ddd);cursor:ew-resize;opacity:0"></div><div class="handle handle-progress"style="position:absolute;top:50%;transform:translateY(-50%);width:10px;height:10px;border-radius:50%;background-color:var(--g-progress-handle-color, #fff);cursor:ew-resize;opacity:0;box-sizing:border-box">');function Yo(t){const e=Un(),o=()=>{const _=t.task;return typeof _=="function"?_():_},n=()=>o()?._bar??{x:t.x??0,y:t.y??0,width:t.width??100,height:t.height??30},s=B(()=>t.ganttConfig?.barCornerRadius?.()??t.cornerRadius??3),r=B(()=>t.ganttConfig?.readonly?.()??t.readonly??!1),h=B(()=>t.ganttConfig?.readonlyDates?.()??t.readonlyDates??!1),d=B(()=>t.ganttConfig?.readonlyProgress?.()??t.readonlyProgress??!1),m=B(()=>t.ganttConfig?.showExpectedProgress?.()??t.showExpectedProgress??!1),M=B(()=>t.ganttConfig?.columnWidth?.()??t.columnWidth??45),f=B(()=>t.ganttConfig?.ignoredPositions?.()??t.ignoredPositions??[]),c=B(()=>{const _=o();return _?{id:_.id??"",name:_.name??"",color:_.color??"#b8c2cc",colorProgress:_.color_progress??"#a3a3ff",progress:_.progress??0,locked:_.constraints?.locked??!1,invalid:_.invalid??!1,customClass:_.custom_class??"",hasChildren:(_._children?.length??0)>0,start:_._start??null,end:_._end??null}:{id:"",name:"",color:"#b8c2cc",colorProgress:"#a3a3ff",progress:0,locked:!1,invalid:!1,customClass:"",hasChildren:!1,start:null,end:null}}),R=B(()=>n()),E=()=>R()?.x??0,P=()=>(typeof t.taskPosition=="function"?t.taskPosition():t.taskPosition)?.y??R()?.y??0,S=()=>R()?.width??100,x=()=>R()?.height??30,l=()=>M();let b=!1;const{dragState:y,isDragging:T,startDrag:X}=We({onDragStart:(_,N)=>{if(b=!1,_.originalX=E(),_.originalY=P(),_.originalWidth=S(),_.originalProgress=c().progress,t.taskStore?.setDraggingTaskId?.(c().id),N==="dragging_bar"){const p=new Set;if(t.onCollectDependents){const nt=t.onCollectDependents(c().id);for(const rt of nt)p.add(rt)}if(t.onCollectDescendants){const nt=t.onCollectDescendants(c().id);for(const rt of nt)p.add(rt)}const ot=new Map;for(const nt of p){const rt=t.taskStore?.getBarPosition(nt);rt&&ot.set(nt,{originalX:rt.x})}_.dependentOriginals=ot}},onDragMove:(_,N,p)=>{if(!t.taskStore||!c().id)return;b=!0;const ot=M(),nt=f();if(p==="dragging_bar"){const rt=N.originalX;let gt=me(rt+_.deltaX,ot,nt),mt=gt-rt;const L=N.dependentOriginals;if(L&&L.size>0&&t.taskStore.batchMovePositions)t.onClampBatchDelta&&mt<0&&(mt=t.onClampBatchDelta(L,mt)),t.taskStore.batchMovePositions(L,mt);else{if(t.onConstrainPosition){const C=t.onConstrainPosition(c().id,gt,P());if(C===null)return;gt=C.x??gt}t.taskStore.updateBarPosition(c().id,{x:gt})}}else if(p==="dragging_left"){const rt=N.originalX,gt=N.originalWidth,mt=_.deltaX,L=Math.round(mt/ot)*ot;let C=rt+L,kt=gt-L;if(kt<l()&&(kt=l(),C=rt+gt-l()),C=me(C,ot,nt),t.onConstrainPosition){const V=t.onConstrainPosition(c().id,C,P());if(V===null)return;V.x!==void 0&&V.x>C&&(kt=kt-(V.x-C),C=V.x)}t.taskStore.updateBarPosition(c().id,{x:C,width:kt})}else if(p==="dragging_right"){const rt=N.originalWidth,gt=_.deltaX,mt=Math.round(gt/ot)*ot;let L=rt+mt;L=Math.max(l(),L),t.taskStore.updateBarPosition(c().id,{width:L})}else if(p==="dragging_progress"){const rt=E(),gt=S(),mt=f(),L=M(),C=N.startSvgX;let kt=Re(C+_.deltaX,rt,rt+gt);const V=mt.reduce((Z,Q)=>Z+(Q>=rt&&Q<rt+gt?1:0),0),ft=gt-V*L,bt=kt-rt,dt=mt.reduce((Z,Q)=>Z+(Q>=rt&&Q<kt?1:0),0),u=bt-dt*L,Y=ft>0?Re(Math.round(u/ft*100),0,100):0;if(t.taskStore){const Z=t.taskStore.getTask(c().id);Z&&t.taskStore.updateTask(c().id,{...Z,progress:Y})}}},onDragEnd:(_,N,p)=>{t.taskStore?.setDraggingTaskId?.(null);const ot=t.onDateChange??e.onDateChange,nt=t.onResizeEnd??e.onResizeEnd,rt=t.onProgressChange??e.onProgressChange;if(p==="dragging_bar"||p==="dragging_left"||p==="dragging_right"){const gt=t.taskStore?.getBarPosition(c().id);ot?.(c().id,{x:gt?.x??E(),width:gt?.width??S()}),(p==="dragging_left"||p==="dragging_right")&&nt?.(c().id)}else p==="dragging_progress"&&rt?.(c().id,c().progress)}}),a=_=>{if(r()||h()||W())return;const N=_.target;N.classList&&N.classList.contains("handle")||(b=!1,X(_,"dragging_bar",{taskId:c().id}))},i=_=>{const N=t.onHover??e.onHover;N&&!T()&&N(c().id,_.clientX,_.clientY)},H=()=>{const _=t.onHoverEnd??e.onHoverEnd;_&&_()},A=_=>{const N=t.onTaskClick??e.onTaskClick;!b&&N&&(_.stopPropagation(),N(c().id,_))},z=_=>{r()||h()||W()||(_.stopPropagation(),X(_,"dragging_left",{taskId:c().id}))},J=_=>{r()||h()||W()||(_.stopPropagation(),X(_,"dragging_right",{taskId:c().id}))},st=_=>{r()||d()||W()||(_.stopPropagation(),X(_,"dragging_progress",{taskId:c().id}))},at=B(()=>Fe(E(),S(),c().progress,f(),M())),v=B(()=>{if(!m())return 0;const _=c().start,N=c().end;if(!_||!N)return 0;const p=ko(_ instanceof Date?_:new Date(_),N instanceof Date?N:new Date(N),t.ganttConfig?.unit?.()??"day",t.ganttConfig?.step?.()??1);return Fe(E(),S(),p,f(),M())}),k=B(()=>ze(E(),S(),c().name)),D=()=>c().color,w=()=>c().colorProgress,F=()=>"var(--g-expected-progress-color, rgba(0,0,0,0.2))",$=()=>c().hasChildren,j=()=>c().invalid,et=()=>c().customClass,U=()=>!r(),K=()=>U()&&!h(),G=()=>U()&&!d(),W=()=>!!c().locked,lt=()=>T()?`dragging ${y()}`:"",ut=()=>W()?"#7f8c8d":T()?"#2c3e50":D(),yt=()=>W()||T()?1:$()?0:.1;Ct(()=>{const _=c().id,N=ut(),p=yt();_==="task-0"&&console.log("[Bar task-0]",{bg:N,op:p,locked:W(),dragging:T(),hasSubtasks:$()})});const pt=()=>t.visible??!0,_t=()=>`translate(${E()}px, ${P()}px)`;return(()=>{var _=Wo(),N=_.firstChild,p=N.nextSibling,ot=p.nextSibling,nt=ot.nextSibling,rt=nt.nextSibling,gt=rt.nextSibling,mt=gt.nextSibling,L=mt.nextSibling;return _.$$click=A,_.addEventListener("mouseleave",H),_.addEventListener("mouseenter",i),_.$$mousedown=a,ct(nt,()=>c().name),gt.$$mousedown=z,mt.$$mousedown=J,L.$$mousedown=st,xt(C=>{var kt=`bar-wrapper ${et()} ${j()?"invalid":""} ${W()?"locked":""} ${lt()}`,V=c().id,ft=_t(),bt=`${S()}px`,dt=`${x()}px`,u=W()?"not-allowed":r()?"default":"move",Y=pt()?"visible":"hidden",Z=`${s()}px`,Q=W()?"#7f8c8d":T()?"#2c3e50":D(),vt=W()||T()?1:$()?0:.1,wt=`${W()?"2px":"1.5px"} solid ${W()?"#c0392b":D()}`,Ht=W()?"dashed":"solid",Ft=T()?"none":"background-color 0.1s ease",Rt=`${v()}px`,Pt=`${s()}px`,Tt=F(),It=m()&&v()>0?"block":"none",Et=`${at()}px`,Wt=`${s()}px`,$t=w(),Ut=`bar-label ${k().position}`,At=k().position==="inside"?"50%":`${S()+5}px`,Yt=k().position==="inside"?"translate(-50%, -50%)":"translateY(-50%)",Lt=k().position==="inside"?"#fff":"#333",Gt=W()?"block":"none",Bt=U()&&!W()&&K()?"block":"none",zt=U()&&!W()&&K()?"block":"none",Xt=`${at()-5}px`,Vt=`2px solid ${w()}`,qt=U()&&!W()&&G()&&at()>0?"block":"none";return kt!==C.e&&ue(_,C.e=kt),V!==C.t&&it(_,"data-id",C.t=V),ft!==C.a&&q(_,"transform",C.a=ft),bt!==C.o&&q(_,"width",C.o=bt),dt!==C.i&&q(_,"height",C.i=dt),u!==C.n&&q(_,"cursor",C.n=u),Y!==C.s&&q(_,"visibility",C.s=Y),Z!==C.h&&q(N,"border-radius",C.h=Z),Q!==C.r&&q(N,"background-color",C.r=Q),vt!==C.d&&q(N,"opacity",C.d=vt),wt!==C.l&&q(N,"border",C.l=wt),Ht!==C.u&&q(N,"border-style",C.u=Ht),Ft!==C.c&&q(N,"transition",C.c=Ft),Rt!==C.w&&q(p,"width",C.w=Rt),Pt!==C.m&&q(p,"border-radius",C.m=Pt),Tt!==C.f&&q(p,"background-color",C.f=Tt),It!==C.y&&q(p,"display",C.y=It),Et!==C.g&&q(ot,"width",C.g=Et),Wt!==C.p&&q(ot,"border-radius",C.p=Wt),$t!==C.b&&q(ot,"background-color",C.b=$t),Ut!==C.T&&ue(nt,C.T=Ut),At!==C.A&&q(nt,"left",C.A=At),Yt!==C.O&&q(nt,"transform",C.O=Yt),Lt!==C.I&&q(nt,"color",C.I=Lt),Gt!==C.S&&q(rt,"display",C.S=Gt),Bt!==C.W&&q(gt,"display",C.W=Bt),zt!==C.C&&q(mt,"display",C.C=zt),Xt!==C.B&&q(L,"left",C.B=Xt),Vt!==C.v&&q(L,"border",C.v=Vt),qt!==C.k&&q(L,"display",C.k=qt),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0,T:void 0,A:void 0,O:void 0,I:void 0,S:void 0,W:void 0,C:void 0,B:void 0,v:void 0,k:void 0}),_})()}pe(["mousedown","click"]);var zo=Dt("<div data-type=summary style=position:absolute;will-change:transform;pointer-events:auto><div class=bar style=position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box></div><div class=bar-progress style=position:absolute;top:0;left:0;height:100%;pointer-events:none></div><div class=bar-label style=position:absolute;top:50%;font-size:12px;font-weight:500;pointer-events:none;user-select:none;white-space:nowrap></div><div style=position:absolute;top:50%;transform:translateY(-50%);font-size:10px;color:#888;pointer-events:none;white-space:nowrap>(<!>)");function Xo(t){const e=()=>{const i=t.taskId;return typeof i=="function"?i():i},o=()=>{const i=e();if(t.taskStore&&i){const H=t.taskStore.tasks[i];if(H?._bar)return H._bar}return{x:0,y:0,width:100,height:30}},n=()=>{const i=e();if(t.taskStore&&i)return t.taskStore.tasks[i]},s=B(()=>o()),r=()=>s()?.x??0,h=()=>(typeof t.taskPosition=="function"?t.taskPosition():t.taskPosition)?.y??s()?.y??0,d=()=>s()?.width??100,m=()=>s()?.height??30,M=B(()=>t.ganttConfig?.columnWidth?.()??45),f=B(()=>t.ganttConfig?.readonly?.()??!1),c=B(()=>t.ganttConfig?.barCornerRadius?.()??3),R=()=>n()?.color??"var(--g-bar-color, #b8c2cc)",E=()=>n()?.color_progress??"var(--g-bar-progress-color, #a3a3ff)",P=()=>n()?.progress??0,S=()=>d()*P()/100,x=B(()=>{const i=n()?.name??"";return ze(r(),d(),i,7)}),{dragState:l,isDragging:b,startDrag:y}=We({onDragStart:(i,H)=>{if(i.originalX=r(),i.originalY=h(),H==="dragging_bar"&&t.onCollectDescendants){const A=t.onCollectDescendants(e());A.add(e());const z=new Map;for(const J of A){const st=t.taskStore?.getBarPosition(J);st&&z.set(J,{originalX:st.x})}i.batchOriginals=z}},onDragMove:(i,H,A)=>{if(!t.taskStore||!e()||A!=="dragging_bar")return;const z=M(),J=H.originalX;let at=me(J+i.deltaX,z,[])-J;const v=H.batchOriginals;v&&v.size>0&&t.taskStore.batchMovePositions&&(t.onClampBatchDelta&&at<0&&(at=t.onClampBatchDelta(v,at)),t.taskStore.batchMovePositions(v,at))},onDragEnd:(i,H,A)=>{A==="dragging_bar"&&t.onDragEnd?.(e())}}),T=()=>{const i=l();return i==="idle"?"":`dragging ${i}`},X=i=>{f()||(i.preventDefault(),i.stopPropagation(),y(i,"dragging_bar"))},a=()=>`translate(${r()}px, ${h()}px)`;return(()=>{var i=zo(),H=i.firstChild,A=H.nextSibling,z=A.nextSibling,J=z.nextSibling,st=J.firstChild,at=st.nextSibling;return at.nextSibling,i.$$mousedown=X,ct(z,()=>n()?.name??""),ct(J,()=>n()?._children?.length??0,at),xt(v=>{var k=`summary-bar-wrapper bar-wrapper ${T()}`,D=e(),w=a(),F=`${d()}px`,$=`${m()}px`,j=f()?"default":"grab",et=`${c()}px`,U=b()?"#2c3e50":R(),K=b()?"none":"background-color 0.1s ease",G=`${S()}px`,W=`${c()}px`,lt=E(),ut=P()>0?"block":"none",yt=x().position==="inside"?"50%":`${d()+8}px`,pt=x().position==="inside"?"translate(-50%, -50%)":"translateY(-50%)",_t=x().position==="inside"?"#fff":"#333",_=`${d()+8+(n()?.name?.length??0)*7}px`,N=(n()?._children?.length??0)>0?"block":"none";return k!==v.e&&ue(i,v.e=k),D!==v.t&&it(i,"data-id",v.t=D),w!==v.a&&q(i,"transform",v.a=w),F!==v.o&&q(i,"width",v.o=F),$!==v.i&&q(i,"height",v.i=$),j!==v.n&&q(i,"cursor",v.n=j),et!==v.s&&q(H,"border-radius",v.s=et),U!==v.h&&q(H,"background-color",v.h=U),K!==v.r&&q(H,"transition",v.r=K),G!==v.d&&q(A,"width",v.d=G),W!==v.l&&q(A,"border-radius",v.l=W),lt!==v.u&&q(A,"background-color",v.u=lt),ut!==v.c&&q(A,"display",v.c=ut),yt!==v.w&&q(z,"left",v.w=yt),pt!==v.m&&q(z,"transform",v.m=pt),_t!==v.f&&q(z,"color",v.f=_t),_!==v.y&&q(J,"left",v.y=_),N!==v.g&&q(J,"display",v.g=N),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0}),i})()}pe(["mousedown"]);var Vo=Dt("<svg><rect class=subtask-bar-progress fill-opacity=0.3 style=pointer-events:none></svg>",!1,!0,!1),qo=Dt("<svg><g class=subtask-bar><rect class=subtask-bar-bg fill-opacity=0.1 stroke-width=1.5></rect><text class=subtask-label font-size=10 fill=#333 text-anchor=middle dominant-baseline=middle style=pointer-events:none;user-select:none></svg>",!1,!0,!1);function jo(t){const e=()=>t.task,o=()=>e()?._bar||{x:0,y:0,width:100,height:30},n=()=>o().x,s=()=>o().width,r=()=>t.y??0,h=()=>t.config||{},d=()=>h().barHeight??30,m=()=>h().subtaskHeightRatio??.5,M=()=>(h().cornerRadius??3)*.7,f=()=>d()*m(),c=()=>e()?.color??h().parentColor??"var(--g-bar-color, #b8c2cc)",R=()=>e()?.color_progress??c(),E=()=>e()?.progress??0,P=()=>{const x=s(),l=E();return Math.max(0,x*l/100)},S=()=>n()+s()/2;return(()=>{var x=qo(),l=x.firstChild,b=l.nextSibling;return ct(x,ht(Gn,{get when(){return E()>0},get children(){var y=Vo();return xt(T=>{var X=n(),a=r(),i=P(),H=f(),A=M(),z=M(),J=R();return X!==T.e&&it(y,"x",T.e=X),a!==T.t&&it(y,"y",T.t=a),i!==T.a&&it(y,"width",T.a=i),H!==T.o&&it(y,"height",T.o=H),A!==T.i&&it(y,"rx",T.i=A),z!==T.n&&it(y,"ry",T.n=z),J!==T.s&&it(y,"fill",T.s=J),T},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),y}}),b),ct(b,()=>e()?.name??""),xt(y=>{var T=e()?.id,X=t.index,a=n(),i=r(),H=s(),A=f(),z=M(),J=M(),st=c(),at=c(),v=S(),k=r()+f()/2;return T!==y.e&&it(x,"data-id",y.e=T),X!==y.t&&it(x,"data-index",y.t=X),a!==y.a&&it(l,"x",y.a=a),i!==y.o&&it(l,"y",y.o=i),H!==y.i&&it(l,"width",y.i=H),A!==y.n&&it(l,"height",y.n=A),z!==y.s&&it(l,"rx",y.s=z),J!==y.h&&it(l,"ry",y.h=J),st!==y.r&&it(l,"fill",y.r=st),at!==y.d&&it(l,"stroke",y.d=at),v!==y.l&&it(b,"x",y.l=v),k!==y.u&&it(b,"y",y.u=k),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0}),x})()}var Uo=Dt("<svg><g class=expanded-task-container><rect class=parent-container fill=none stroke-width=2 stroke-opacity=0.6 stroke-dasharray=6,3></rect><g class=subtasks></svg>",!1,!0,!1);function Go(t){const e=()=>t.taskStore?.tasks[t.taskId],o=()=>{const P=e();if(!P?._children?.length)return[];const S=t.taskStore?.tasks;return S?P._children.map(x=>S[x]).filter(x=>x!=null):[]},n=()=>e()?.subtaskLayout||"sequential",s=()=>t.ganttConfig?.barHeight?.()??30,r=()=>t.ganttConfig?.padding?.()??18,h=()=>t.ganttConfig?.subtaskHeightRatio?.()??.5,d=()=>t.ganttConfig?.barCornerRadius?.()??3,m=()=>e()?._bar||{x:0,y:0,width:100,height:30},M=()=>{const P=t.rowLayout,S=P?.taskPositions?.get(t.taskId);return S?.y!==void 0?S.y:P?P.y:m().y-r()/2},f=()=>{const S=t.rowLayout?.taskPositions?.get(t.taskId);if(S?.height!==void 0)return S.height;if(n()==="sequential")return s();const x=s()*h(),l=r()*.4,b=o().length;return(s()-x)/2*2+b*x+(b-1)*l},c=()=>e()?.color??"var(--g-bar-color, #b8c2cc)",R=()=>({barHeight:s(),padding:r(),subtaskHeightRatio:h(),cornerRadius:d(),parentColor:c()}),E=(P,S)=>{const l=t.rowLayout?.taskPositions?.get(S?.id);if(l?.y!==void 0)return l.y;const b=s()*h(),y=r()*.4,T=(s()-b)/2;return n()==="sequential"?M()+T:M()+T+P*(b+y)};return(()=>{var P=Uo(),S=P.firstChild,x=S.nextSibling;return ct(x,ht(Ye,{get each(){return o()},children:(l,b)=>ht(jo,{task:l,get index(){return b()},get y(){return E(b(),l)},get layout(){return n()},get config(){return R()},get ganttConfig(){return t.ganttConfig}})})),xt(l=>{var b=t.taskId,y=n(),T=m().x,X=M(),a=m().width,i=f(),H=c(),A=d(),z=d();return b!==l.e&&it(P,"data-id",l.e=b),y!==l.t&&it(P,"data-layout",l.t=y),T!==l.a&&it(S,"x",l.a=T),X!==l.o&&it(S,"y",l.o=X),a!==l.i&&it(S,"width",l.i=a),i!==l.n&&it(S,"height",l.n=i),H!==l.s&&it(S,"stroke",l.s=H),A!==l.h&&it(S,"rx",l.h=A),z!==l.r&&it(S,"ry",l.r=z),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),P})()}var No=Dt('<div class=task-layer style="contain:layout style;position:relative;width:100%;height:100%"><div class=summary-layer style="contain:layout style"></div><div class=expanded-layer style="contain:layout style"></div><div class=task-bars-layer style="contain:layout style">'),Oo=Dt("<div>"),Jo=Dt("<div style=pointer-events:auto>");const Ae=5;function Ko(t){const e=()=>t.relationships||[],o=B(()=>no(e())),n=(k,D,w)=>{if(!t.taskStore)return{x:D,y:w};const F=t.ganttConfig?.columnWidth?.()??45,j=t.taskStore.getBarPosition?.(k)?.width??100,et={getBarPosition:t.taskStore.getBarPosition?.bind(t.taskStore),getTask:t.taskStore.getTask?.bind(t.taskStore),relationships:e(),relationshipIndex:o(),pixelsPerHour:F,ganttStartDate:new Date},U=Pe(k,D,j,et);if(U.blocked)return null;if(U.cascadeUpdates&&U.cascadeUpdates.size>0)for(const[K,G]of U.cascadeUpdates)t.taskStore.updateBarPosition(K,G);return{x:U.constrainedX,y:w}},s=(k,D)=>{t.onDateChange?.(k,D)},r=(k,D)=>{t.onProgressChange?.(k,D)},h=k=>{if(t.taskStore){const D=t.ganttConfig?.columnWidth?.()??45,w=t.taskStore.getBarPosition?.(k);if(w){const F={getBarPosition:t.taskStore.getBarPosition?.bind(t.taskStore),getTask:t.taskStore.getTask?.bind(t.taskStore),relationships:e(),relationshipIndex:o(),pixelsPerHour:D,ganttStartDate:new Date},$=Pe(k,w.x,w.width,F);if($.cascadeUpdates)for(const[j,et]of $.cascadeUpdates)t.taskStore.updateBarPosition(j,et)}}t.onResizeEnd?.(k)},d=(k,D,w)=>{t.onHover?.(k,D,w)},m=()=>{t.onHoverEnd?.()},M=(k,D)=>{t.onTaskClick?.(k,D)},f=k=>{const D=t.taskStore?.getTask?.bind(t.taskStore)??(()=>{});return so(k,e(),D)},c=(k,D)=>{const w=t.taskStore?.getTask?.bind(t.taskStore)??(()=>{}),F=t.ganttConfig?.columnWidth?.()??45;return oo(k,D,e(),w,{pixelsPerTimeUnit:F})},R=k=>t.taskStore?Lo(k,t.taskStore.tasks):new Set,E=()=>t.resourceStore?.displayResources()||[],P=()=>t.startRow??0,S=()=>t.endRow??E().length,x=()=>t.startX??0,l=()=>t.endX??1/0;let b=null,y=-1;const T=()=>{const k=t.taskStore?.tasks;if(!k)return new Map;const D=Mt(()=>Object.keys(k));if(D.length===y&&b)return b;y=D.length;const w=new Map;return Mt(()=>{for(const F of D){const $=k[F];if(!$||$._isHidden)continue;const j=$.resource||"Unassigned";w.has(j)||w.set(j,[]),w.get(j).push($)}}),b=w,w},X=B(()=>{const k=[],D=E(),w=T(),F=P(),$=S(),j=x(),et=l();for(let U=F;U<$&&U<D.length;U++){const K=D[U];if(!K||K.type==="group")continue;const G=w.get(K.id);G&&Mt(()=>{if(et===1/0)for(let W=0;W<G.length;W++){const lt=G[W];lt&&k.push(lt.id)}else for(let W=0;W<G.length;W++){const lt=G[W];if(!lt)continue;const ut=lt._bar;(!ut||ut.x+ut.width>=j-200&&ut.x<=et+200)&&k.push(lt.id)}})}return k}),a=k=>t.ganttConfig?.isTaskExpanded?.(k)??!1,i=()=>t.ganttConfig?.renderMode?.()==="simple",H=B(()=>{const k=i(),D=X();return Mt(()=>{const w=[],F=[],$=[],j=t.taskStore?.tasks??{},et=new Map,U=K=>(et.has(K)||et.set(K,a(K)),et.get(K));for(const K of D){const G=j[K];if(!G)continue;const W=G.parentId,lt=G.type,ut=G._children;if(k){if(W)continue;lt==="summary"||lt==="project"?F.push(K):w.push(K);continue}const yt=ut&&ut.length>0,pt=U(K);yt&&pt?$.push(K):lt==="summary"||lt==="project"?F.push(K):(!W||!U(W))&&w.push(K)}return{regularIds:w,summaryIds:F,expandedIds:$}})});let A=0,z=0;const J=B(()=>{const k=H().regularIds;A=Math.max(A,k.length);const D=A+Ae,w=new Array(D);for(let F=0;F<k.length;F++)w[F]=k[F];return w}),st=B(()=>{const k=J(),D=t.taskStore?.tasks??{};return Mt(()=>k.map(w=>w?D[w]:void 0))}),at=B(()=>{const k=H().summaryIds;z=Math.max(z,k.length);const D=z+Ae,w=new Array(D);for(let F=0;F<k.length;F++)w[F]=k[F];return w}),v=k=>{const D=t.rowLayouts;if(!D)return null;const w=t.taskStore?.getTask?.(k);if(!w)return null;const F=w.resource,$=D.get(F||"");if(!$)return null;if(i())return{...$,y:$.contentY??$.y??0,height:$.contentHeight??$.height??30,isExpanded:!1};const j=$.taskPositions?.get(k);return j?{...$,y:j.y,height:j.height,isExpanded:j.isExpanded}:$};return(()=>{var k=No(),D=k.firstChild,w=D.nextSibling,F=w.nextSibling;return ct(D,ht(ge,{get each(){return at()},children:$=>(()=>{var j=Oo();return ct(j,ht(Xo,{taskId:$,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},onCollectDescendants:R,onClampBatchDelta:c,onDragEnd:h})),xt(et=>q(j,"display",$()?"block":"none")),j})()})),ct(w,ht(Ye,{get each(){return H().expandedIds},children:$=>ht(Go,{taskId:$,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},get rowLayout(){return v($)??void 0}})})),ct(F,ht(ge,{get each(){return st()},children:$=>(()=>{var j=Jo();return ct(j,ht(Yo,{task:$,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},onConstrainPosition:n,onCollectDependents:f,onCollectDescendants:R,onClampBatchDelta:c,onDateChange:s,onProgressChange:r,onResizeEnd:h,onHover:d,onHoverEnd:m,onTaskClick:M})),xt(et=>q(j,"display",$()?"block":"none")),j})()})),k})()}var Qo=Dt("<div style=position:absolute><div style=position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.15;border-radius:3px></div><div style=position:absolute;top:0;left:0;height:100%;background-color:#a3a3ff;opacity:0.3;border-radius:3px></div><div style=position:absolute;top:50%;left:8px;transform:translateY(-50%);color:#fff;font-size:12px;white-space:nowrap></div><div style=position:absolute;bottom:2px;right:4px;font-size:9px;color:#888>");function Zo(t){const e=()=>typeof t.task=="function"?t.task():t.task,o=B(()=>{const n=e(),s=n?.progress??0,r=n?._bar?.width??100;return{color:n?.color??"#3b82f6",progress:s,name:n?.name??"",pw:r*s/100,id:n?.id??"",x:n?._bar?.x??0,y:n?._bar?.y??0,width:r,height:n?._bar?.height??30}});return(()=>{var n=Qo(),s=n.firstChild,r=s.nextSibling,h=r.nextSibling,d=h.nextSibling;return ct(h,()=>o().name),ct(d,()=>o().id),xt(m=>{var M=`translate(${o().x}px, ${o().y}px)`,f=`${o().width}px`,c=`${o().height}px`,R=o().color,E=`${o().pw}px`;return M!==m.e&&q(n,"transform",m.e=M),f!==m.t&&q(n,"width",m.t=f),c!==m.a&&q(n,"height",m.a=c),R!==m.o&&q(s,"background-color",m.o=R),E!==m.i&&q(r,"width",m.i=E),m},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),n})()}var ts=Dt('<div class=task-layer-minimal style="contain:layout style;position:relative;width:100%;height:100%">');function es(t){const e=()=>t.resourceStore?.displayResources()||[],o=()=>t.startRow??0,n=()=>t.endRow??50,s=()=>t.startX??0,r=()=>t.endX??1/0;let h=null,d=-1;const m=()=>{const f=t.taskStore?.tasks;if(!f)return new Map;const c=Mt(()=>Object.keys(f));if(c.length===d&&h)return h;d=c.length;const R=new Map;return Mt(()=>{for(const E of c){const P=f[E];if(!P||P._isHidden)continue;const S=P.resource||"Unassigned";R.has(S)||R.set(S,[]),R.get(S).push(P)}}),h=R,R},M=B(()=>{const f=[],c=e(),R=m(),E=o(),P=n(),S=s(),x=r();for(let l=E;l<P&&l<c.length;l++){const b=c[l];if(!b||b.type==="group")continue;const y=R.get(b.id);y&&Mt(()=>{if(x===1/0)for(let T=0;T<y.length;T++){const X=y[T];X&&f.push(X)}else for(let T=0;T<y.length;T++){const X=y[T];if(!X)continue;const a=X._bar;(!a||a.x+a.width>=S-200&&a.x<=x+200)&&f.push(X)}})}return f});return(()=>{var f=ts();return ct(f,ht(ge,{get each(){return M()},children:c=>ht(Zo,{task:c})})),f})()}function ns(t){const e=co(),o=uo(t.options||{}),n=fo(t.options||{}),s=vo(t.resources||[]);typeof window<"u"&&(window.__ganttTaskStore=e,window.__ganttConfig=o,window.__ganttDateStore=n);const[r,h]=I(null),[d,m]=I(0),[M,f]=I(0),[c,R]=I(0),[E,P]=I(0),[S,x]=I(!1);let l=null;const[b,y]=I([]),[T,X]=I([]),[a,i]=I(null),[H,A]=I({x:0,y:0}),[z,J]=I(!1),[st,at]=I(null),[v,k]=I(!1),D=B(()=>{const u=a();return u?e.getTask(u):null}),w=B(()=>{const u=a();return u?e.getBarPosition(u):null}),F=B(()=>{const u=st();return u?e.getTask(u):null}),$=B(()=>{const u=st();return u?e.getBarPosition(u):null}),j=B(()=>{const u=st();return u?b().filter(Y=>Y.from===u||Y.to===u):[]}),et=(u,Y=!0)=>{if(!u||u.length===0){e.clear(),y([]),n.setupDates([]);return}Ho(u.map(Tt=>({_start:new Date(Tt.start),_end:new Date(Tt.end||Tt.start)}))),n.setupDates(u),o.setGanttStart(n.ganttStart()),o.setGanttEnd(n.ganttEnd()),o.setUnit(n.unit()),o.setStep(n.step()),o.setColumnWidth(n.columnWidth());const Z={ganttStart:n.ganttStart(),ganttEnd:n.ganttEnd(),unit:n.unit(),step:n.step(),columnWidth:n.columnWidth(),headerHeight:o.headerHeight(),barHeight:o.barHeight(),padding:o.padding()};let Q=null;const vt=s.resources().length>0;if(vt&&Y)Q=s.resourceIndexMap();else if(!vt){const Tt=mo(u);s.updateResources(Tt),Q=s.resourceIndexMap()}const{tasks:wt,relationships:Ht,resources:Ft}=Do(u,Z,Q),Rt=Ao(wt);_o(Rt);const Pt=e.collapsedTasks();for(const Tt of Rt.values()){const It=Tt;Bo(It.id,Rt,Pt)&&(It._isHidden=!0)}e.updateTasks(Array.from(Rt.values())),y(Ht),X(Ft)};fe(()=>{et(t.tasks)}),Ct(()=>{const u=t.tasks;s.collapsedGroups(),e.collapsedTasks(),u&&u.length>0&&Mt(()=>et(u))}),Ct(()=>{const u=t.options;u&&o.updateOptions(u)});const[U,K]=I(t.options?.view_mode);Ct(()=>{const u=t.options?.view_mode,Y=U();u&&u!==Y&&(K(u),n.changeViewMode(u),t.tasks&&t.tasks.length>0&&Mt(()=>et(t.tasks)))});const G=B(()=>{const u=e.tasks;return u?Object.keys(u).length:0}),W=B(()=>{const u=s.displayCount();return u>0?u:T().length}),lt=B(()=>n.gridWidth()),ut=B(()=>n.getAllDateInfos()),yt=B(()=>o.barHeight()+o.padding()),pt=B(()=>{const u=s.displayResources(),Y=o.renderMode();if(!u||u.length===0)return new Map;const Z=u.map((wt,Ht)=>({id:wt.id,type:wt.type||"resource",displayIndex:Ht,taskId:wt.taskId})),Q={barHeight:o.barHeight(),padding:o.padding(),subtaskHeightRatio:o.subtaskHeightRatio()};if(Y==="simple")return Eo(Z,Q);const vt=o.expandedTasks();return Po(Z,Q,vt,e.tasks)}),_t=B(()=>Fo(pt()));Ct(()=>{const u=pt();!u||u.size===0||Mt(()=>{for(const[Y,Z]of u)if(Y!=="__total__"&&Z.taskPositions)for(const[Q,vt]of Z.taskPositions){const wt=e.tasks[Q];wt&&wt._bar&&wt._bar.y!==vt.y&&e.updateBarPosition(Q,{y:vt.y})}})});const _=B(()=>{const Y=pt().get("__total__");return Y?Y.height:(W()||G())*yt()}),N=B(()=>{const u=_();if(u>0)return u;const Y=o.barHeight(),Z=o.padding();return(W()||G())*(Y+Z)}),p=$o({scrollX:d,scrollY:M,viewportWidth:c,viewportHeight:E,columnWidth:()=>n.columnWidth(),rowHeight:yt,totalRows:()=>W()||G(),sortedRowLayouts:_t,overscanCols:t.overscanCols??5,overscanRows:t.overscanRows??5,overscanX:t.overscanX??600}),ot=(u,Y)=>{Y.x!==void 0&&Y.width!==void 0&&t.onDateChange?.(u,{x:Y.x,width:Y.width})},nt=(u,Y)=>{t.onProgressChange?.(u,Y)},rt=u=>{t.onResizeEnd?.(u)},gt=(u,Y)=>{at(u),k(!0),t.onTaskClick?.(u,Y)},mt=(u,Y,Z)=>{i(u),A({x:Y,y:Z}),J(!0)},L=()=>{J(!1),i(null)},C=()=>{k(!1),at(null)},kt=u=>{h(u),R(u.getContainerWidth()),P(u.getContainerHeight()),u.scrollLeftSignal&&u.scrollTopSignal?Ct(()=>{const Q=u.scrollLeftSignal(),vt=u.scrollTopSignal();Qn(()=>{m(Q),f(vt)})}):(u.scrollLeftSignal&&Ct(()=>m(u.scrollLeftSignal())),u.scrollTopSignal&&Ct(()=>f(u.scrollTopSignal())));let Y=M(),Z=d();if(Ct(()=>{const Q=d(),vt=M();(Q!==Z||vt!==Y)&&(Z=Q,Y=vt,x(!0),l&&clearTimeout(l),l=setTimeout(()=>{x(!1)},150))}),u.containerWidthSignal&&Ct(()=>R(u.containerWidthSignal())),u.containerHeightSignal&&Ct(()=>P(u.containerHeightSignal())),t.options?.scroll_to==="today"){const Q=n.dateToX(new Date);u.scrollTo(Q-u.getContainerWidth()/4,!1)}};let V=!1;Ct(()=>{const u=e.tasks,Y=r(),Z=Object.keys(u);if(!V&&Y&&t.options?.scroll_to==="start"&&u&&Z.length>0){const Q=Z[0],vt=Q?u[Q]:void 0;vt?._bar?.x&&(Y.scrollTo(Math.max(0,vt._bar.x-50),!1),V=!0)}});const ft=()=>t.options?.upper_header_height||45,bt=()=>t.options?.lower_header_height||30,dt=()=>t.options?.resource_column_width||120;return B(()=>({stroke:t.options?.arrow_color||"#666",curveRadius:t.options?.arrow_curve||5,headShape:t.options?.arrow_head_shape||"chevron",headSize:t.options?.arrow_head_size||5,...t.arrowConfig})),ht(Kn,{onDateChange:ot,onProgressChange:nt,onResizeEnd:rt,onTaskClick:gt,onHover:mt,onHoverEnd:L,get children(){return[ht(io,{ganttConfig:o,get svgWidth(){return lt()},get svgHeight(){return N()},get headerHeight(){return o.headerHeight()},get resourceColumnWidth(){return dt()},resourceHeaderLabel:"Resource",onContainerReady:kt,get resourceColumn(){return ht(Jn,{resourceStore:s,ganttConfig:o,get width(){return dt()},get startRow(){return p.rowRange().start},get endRow(){return p.rowRange().end},get rowLayouts(){return pt()}})},get header(){return ht(On,{get dateInfos(){return ut()},get columnWidth(){return n.columnWidth()},get gridWidth(){return lt()},get upperHeaderHeight(){return ft()},get lowerHeaderHeight(){return bt()},get startCol(){return p.colRange().start},get endCol(){return p.colRange().end}})},get barsLayer(){return he(()=>t.taskLayerMode==="minimal")()?ht(es,{taskStore:e,resourceStore:s,get startRow(){return p.rowRange().start},get endRow(){return p.rowRange().end},get startX(){return p.xRange().start},get endX(){return p.xRange().end}}):ht(Ko,{taskStore:e,ganttConfig:o,get relationships(){return b()},resourceStore:s,onDateChange:ot,onProgressChange:nt,onResizeEnd:rt,onTaskClick:gt,onHover:mt,onHoverEnd:L,get startRow(){return p.rowRange().start},get endRow(){return p.rowRange().end},get startX(){return p.xRange().start},get endX(){return p.xRange().end},get rowLayouts(){return pt()}})},get children(){return ht(Nn,{get width(){return lt()},get height(){return N()},get barHeight(){return o.barHeight()},get padding(){return o.padding()},get taskCount(){return W()||G()},get columnWidth(){return n.columnWidth()},get dateInfos(){return ut()},get lines(){return t.options?.lines||"both"},get startRow(){return p.rowRange().start},get endRow(){return p.rowRange().end},resourceStore:s,get rowLayouts(){return pt()}})}}),ht(ro,{visible:z,position:H,task:D,barPosition:w}),ht(ao,{visible:v,task:F,barPosition:$,relationships:j,onClose:C})]}})}function os(){let t=[],e=!1,o=null,n=null,s=0,r=!1;const h=typeof PerformanceObserver<"u"&&PerformanceObserver.supportedEntryTypes?.includes("long-animation-frame");function d(){o=new PerformanceObserver(S=>{for(const x of S.getEntries())t.push({timestamp:x.startTime,duration:x.duration,blockingDuration:x.blockingDuration||0,scripts:x.scripts?.map(l=>l.sourceURL||l.name)||[],source:"laf",renderStart:x.renderStart,styleAndLayoutStart:x.styleAndLayoutStart,firstUIEventTimestamp:x.firstUIEventTimestamp})}),o.observe({type:"long-animation-frame",buffered:!0}),r=!0}function m(){s=performance.now();function S(){if(!e)return;const x=performance.now(),l=x-s;l>4&&t.push({timestamp:s,duration:l,blockingDuration:l>16.67?l-16.67:0,scripts:[],source:"raf"}),s=x,n=requestAnimationFrame(S)}n=requestAnimationFrame(S),r=!1}function M(S={}){e||(t=[],e=!0,h&&!S.preferRAF?d():m())}function f(){e=!1,o&&(o.disconnect(),o=null),n&&(cancelAnimationFrame(n),n=null)}function c(){return[...t]}function R(){t=[]}function E(){if(t.length===0)return{frameCount:0,totalDuration:0,avgFrameTime:0,avgFPS:0,minFrameTime:0,maxFrameTime:0,worstFrame:null,droppedFrames:0,percentile95:0,percentile99:0,blockingTime:0,source:r?"laf":"raf"};const S=t.map(a=>a.duration).sort((a,i)=>a-i),x=S.reduce((a,i)=>a+i,0),l=t.reduce((a,i)=>a+i.blockingDuration,0),b=t.reduce((a,i)=>i.duration>a.duration?i:a,t[0]),y=t.filter(a=>a.duration>16.67).length,T=Math.floor(S.length*.95),X=Math.floor(S.length*.99);return{frameCount:t.length,totalDuration:x,avgFrameTime:x/t.length,avgFPS:1e3/(x/t.length),minFrameTime:S[0],maxFrameTime:S[S.length-1],worstFrame:{timestamp:b.timestamp,duration:b.duration,blockingDuration:b.blockingDuration,scripts:b.scripts},droppedFrames:y,droppedFramePercent:y/t.length*100,percentile95:S[T]||S[S.length-1],percentile99:S[X]||S[S.length-1],blockingTime:l,source:r?"laf":"raf"}}function P(S=100){if(t.length===0)return[];const x=[];let l=t[0].timestamp,b=[];for(const y of t){if(y.timestamp-l>=S){if(b.length>0){const X=b.reduce((a,i)=>a+i.duration,0)/b.length;x.push({time:l,fps:1e3/X,frameCount:b.length})}l=y.timestamp,b=[]}b.push(y)}if(b.length>0){const T=b.reduce((X,a)=>X+a.duration,0)/b.length;x.push({time:l,fps:1e3/T,frameCount:b.length})}return x}return{startTracking:M,stopTracking:f,getFrames:c,clear:R,analyze:E,getFPSTimeline:P,get isTracking(){return e},get hasLAF(){return h}}}const je=new Map;let be=[],ve=!1;function ss(){ve=!0,be=[];function t(){ve&&(performance.now(),requestAnimationFrame(t))}requestAnimationFrame(t)}function rs(){ve=!1}function as(){je.clear(),be=[]}function is(){return Array.from(je.values()).map(t=>({...t,minTime:t.minTime===1/0?0:t.minTime}))}function ls(){const t=new Map;for(const o of be)t.has(o.frameId)||t.set(o.frameId,[]),t.get(o.frameId).push(o);const e=[];for(const[o,n]of t)if(n.length>1){const s=new Set(n.map(h=>h.name)),r=n.reduce((h,d)=>h+d.duration,0);e.push({frameId:o,memoCount:s.size,invocationCount:n.length,totalTime:r,memos:Array.from(s),invocations:n.sort((h,d)=>h.timestamp-d.timestamp)})}return e.sort((o,n)=>n.totalTime-o.totalTime)}function cs(){const t=is(),e=ls(),o=[],n=.1,s=1,r=100,h=5;for(const d of t){const m={name:d.name,status:"KEEP_MEMO",reason:"",metrics:{callCount:d.callCount,avgTime:d.avgTime.toFixed(3),totalTime:d.totalTime.toFixed(3)}};if(d.avgTime<n&&d.callCount<r)m.status="CONSIDER_PLAIN_FUNCTION",m.reason=`Avg time ${d.avgTime.toFixed(3)}ms is under ${n}ms threshold. Memo overhead may exceed computation cost.`;else if(d.avgTime>s&&d.callCount>r)m.status="OPTIMIZE_COMPUTATION",m.reason=`Called ${d.callCount} times with avg ${d.avgTime.toFixed(3)}ms. Total ${d.totalTime.toFixed(1)}ms spent in this memo.`;else{const M=e.filter(f=>f.memos.includes(d.name)).length;M>h&&(m.status="CHECK_REACTIVE_CASCADE",m.reason=`Involved in ${M} cascade events. May be triggering unnecessary reactive updates.`)}o.push(m)}return o.sort((d,m)=>{const M=parseFloat(d.metrics.totalTime);return parseFloat(m.metrics.totalTime)-M}),{summary:{memoCount:t.length,totalInvocations:t.reduce((d,m)=>d+m.callCount,0),totalTime:t.reduce((d,m)=>d+m.totalTime,0),cascadeEvents:e.length},recommendations:o,cascades:e.slice(0,10)}}function ds(t){const{frameAnalysis:e={},memoAnalysis:o={},config:n={},timeline:s=[]}=t;return{metadata:{version:"1.0.0",timestamp:new Date().toISOString(),browser:hs(),userAgent:navigator?.userAgent||"unknown"},configuration:{taskCount:n.taskCount??0,arrowCount:n.arrowCount??0,viewMode:n.viewMode??"Day",viewportWidth:n.viewportWidth??window?.innerWidth??0,viewportHeight:n.viewportHeight??window?.innerHeight??0,arrowRenderer:n.arrowRenderer??"individual",testDuration:n.testDuration??0,testType:n.testType??"manual"},frameMetrics:{frameCount:e.frameCount??0,totalDuration:St(e.totalDuration),avgFrameTime:St(e.avgFrameTime),avgFPS:St(e.avgFPS),minFrameTime:St(e.minFrameTime),maxFrameTime:St(e.maxFrameTime),percentile95:St(e.percentile95),percentile99:St(e.percentile99),droppedFrames:e.droppedFrames??0,droppedFramePercent:St(e.droppedFramePercent),blockingTime:St(e.blockingTime),source:e.source??"unknown",worstFrame:e.worstFrame?{timestamp:St(e.worstFrame.timestamp),duration:St(e.worstFrame.duration),blockingDuration:St(e.worstFrame.blockingDuration),scripts:e.worstFrame.scripts||[]}:null},memoAnalysis:{summary:o.summary??{},recommendations:(o.recommendations||[]).slice(0,20),cascades:(o.cascades||[]).slice(0,10)},memory:ms(),timeline:s.map(r=>({time:St(r.time),fps:St(r.fps),frameCount:r.frameCount}))}}function us(t,e={}){const{pretty:o=!0}=e;return JSON.stringify(t,null,o?2:0)}function gs(t,e){const o=us(t),n=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(n),r=new Date().toISOString().replace(/[:.]/g,"-"),h=e||`gantt-benchmark-${r}.json`,d=document.createElement("a");d.href=s,d.download=h,d.click(),URL.revokeObjectURL(s)}function fs(t){const e=[];if(e.push("=== Gantt Chart Performance Benchmark ==="),e.push(`Timestamp: ${t.metadata.timestamp}`),e.push(`Browser: ${t.metadata.browser}`),e.push(""),e.push("Configuration:"),e.push(`  Tasks: ${t.configuration.taskCount}`),e.push(`  Arrows: ${t.configuration.arrowCount}`),e.push(`  Arrow Renderer: ${t.configuration.arrowRenderer}`),e.push(`  Viewport: ${t.configuration.viewportWidth}x${t.configuration.viewportHeight}`),e.push(""),e.push("Frame Metrics:"),e.push(`  Average FPS: ${t.frameMetrics.avgFPS}`),e.push(`  Average Frame: ${t.frameMetrics.avgFrameTime}ms`),e.push(`  Worst Frame: ${t.frameMetrics.maxFrameTime}ms`),e.push(`  95th Percentile: ${t.frameMetrics.percentile95}ms`),e.push(`  Dropped Frames: ${t.frameMetrics.droppedFrames} (${t.frameMetrics.droppedFramePercent}%)`),e.push(`  Measurement Source: ${t.frameMetrics.source}`),e.push(""),t.memoAnalysis?.summary?.memoCount&&(e.push("Memo Analysis:"),e.push(`  Tracked Memos: ${t.memoAnalysis.summary.memoCount}`),e.push(`  Total Invocations: ${t.memoAnalysis.summary.totalInvocations}`),e.push(`  Total Time: ${St(t.memoAnalysis.summary.totalTime)}ms`),e.push(`  Cascade Events: ${t.memoAnalysis.summary.cascadeEvents}`),t.memoAnalysis.recommendations?.length>0)){e.push(""),e.push("Top Recommendations:");for(const o of t.memoAnalysis.recommendations.slice(0,5))e.push(`  [${o.status}] ${o.name}`),o.reason&&e.push(`    ${o.reason}`)}return t.memory?.jsHeapSizeLimit&&(e.push(""),e.push("Memory:"),e.push(`  Used Heap: ${Le(t.memory.usedJSHeapSize)}`),e.push(`  Total Heap: ${Le(t.memory.totalJSHeapSize)}`)),e.join(`
`)}function St(t,e=2){return typeof t!="number"||isNaN(t)?0:Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function hs(){if(typeof navigator>"u")return"unknown";const t=navigator.userAgent;return t.includes("Chrome")?`Chrome ${t.match(/Chrome\/(\d+)/)?.[1]||""}`:t.includes("Firefox")?`Firefox ${t.match(/Firefox\/(\d+)/)?.[1]||""}`:t.includes("Safari")&&!t.includes("Chrome")?`Safari ${t.match(/Version\/(\d+)/)?.[1]||""}`:"unknown"}function ms(){return typeof performance>"u"||!performance.memory?null:{jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}}function Le(t){if(t===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+o[n]}var vs=Dt('<div><div><h1 style=margin:0;font-size:20px>Performance Test</h1><div><div><span>Tasks:</span><span></span></div><div><span>Arrows:</span><span></span></div><div><span>Render:</span><span></span></div><div><span>FPS:</span><span></span></div><div><span>Worst:</span><span>ms</span></div><div><span>Avg:</span><span>ms</span></div><div><span>Scroll/s:</span><span></span></div><div><span>Heap:</span><span></span></div></div><div><label style=font-size:13px>View:<select style=width:100px;margin-left:5px><option value=Hour>Hour</option><option value=Day>Day</option><option value=Week>Week</option><option value=Month>Month</option></select></label><button>Reload</button><button></button><button></button><span style="color:#9ca3af;margin:0 5px">|</span><button></button><button>Export JSON</button><label style=font-size:13px>Arrows:<select style=width:100px;margin-left:5px><option value=individual>Individual</option><option value=batched>Batched</option></select></label><label style=font-size:13px>Mode:<select style=width:100px;margin-left:5px><option value=simple>Simple</option><option value=detailed>Detailed</option></select></label><label style=font-size:13px>TaskLayer:<select style=width:100px;margin-left:5px><option value=full>Full</option><option value=minimal>Minimal (V7j)</option></select></label></div><div style=display:flex;gap:15px;align-items:center;font-size:12px;color:#6b7280><span style=font-weight:bold>Buffers:</span><label style=display:flex;align-items:center;gap:4px>Rows:<input type=range min=1 max=30 style=width:60px><span style=min-width:20px></span></label><label style=display:flex;align-items:center;gap:4px>X:<input type=range min=200 max=3000 step=100 style=width:60px><span style=min-width:45px>px</span></label><label style=display:flex;align-items:center;gap:4px>Cols:<input type=range min=1 max=30 style=width:60px><span style=min-width:20px></span></label></div></div><div>');function ps(){const[t,e]=I([]),[o,n]=I(null),[s,r]=I({tasks:0,arrows:0}),[h,d]=I("Hour"),[m,M]=I(0),[f,c]=I(0),[R,E]=I(0),[P,S]=I(!1),[x,l]=I(!1),[b,y]=I(0),[T,X]=I(5),[a,i]=I(600),[H,A]=I(5),[z,J]=I(null),[st,at]=I(!1),[v,k]=I(null),[D,w]=I("batched"),[F,$]=I("simple"),[j,et]=I("full");let U=null,K=performance.now(),G=[],W=0,lt=performance.now(),ut=0,yt=performance.now();const[,pt]=lo(V=>{ut++;const ft=V-K;K=V,G.push(ft),G.length>60&&G.shift();const bt=V-yt;if(bt>=1e3){if(M(Math.round(ut*1e3/bt)),ut=0,yt=V,G.length>0){const u=Math.max(...G),Y=G.reduce((Z,Q)=>Z+Q,0)/G.length;c(u.toFixed(1)),E(Y.toFixed(1))}const dt=V-lt;dt>=1e3&&(y(Math.round(W*1e3/dt)),W=0,lt=V),performance.memory&&J((performance.memory.usedJSHeapSize/1048576).toFixed(1))}});let _t=null;const _=()=>{if(P()){_t&&(_t.abort=!0),S(!1);return}const V=document.querySelector(".gantt-scroll-area");if(!V)return;S(!0),G=[],c(0);const ft={abort:!1};_t=ft;const bt=3e4,dt=performance.now();let u=1,Y=V.scrollLeft;const Z=()=>{if(ft.abort||performance.now()-dt>bt){S(!1),console.log("H-Scroll test complete:",{worst:f(),avg:R()});return}const Q=u*200;Y+=Q,Y>V.scrollWidth-V.clientWidth-500?u=-1:Y<500&&(u=1),V.scrollLeft=Y,requestAnimationFrame(Z)};requestAnimationFrame(Z)};let N=null;const p=()=>{if(x()){N&&(N.abort=!0),l(!1);return}const V=document.querySelector(".gantt-scroll-area");if(!V)return;l(!0),G=[],c(0);const ft={abort:!1};N=ft;const bt=3e4,dt=performance.now();let u=1,Y=V.scrollTop;const Z=()=>{if(ft.abort||performance.now()-dt>bt){l(!1),console.log("V-Scroll test complete:",{worst:f(),avg:R()});return}const Q=u*100;Y+=Q,Y>V.scrollHeight-V.clientHeight-200?u=-1:Y<200&&(u=1),V.scrollTop=Y,requestAnimationFrame(Z)};requestAnimationFrame(Z)},ot=()=>{if(st()){nt();return}U=os(),as(),ss(),U.startTracking(),at(!0),G=[],console.log("Benchmark started - scroll or interact, then click Stop")},nt=()=>{if(!st())return;U?.stopTracking(),rs(),at(!1);const V=U?.analyze()||{},ft=cs(),bt=U?.getFPSTimeline(100)||[],dt=ds({frameAnalysis:V,memoAnalysis:ft,timeline:bt,config:{taskCount:s().tasks,arrowCount:s().arrows,viewMode:h(),arrowRenderer:D(),viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,testType:"manual"}});k(dt),console.log("Benchmark complete:",fs(dt))},rt=()=>{const V=v();V?gs(V):console.warn("No benchmark results to export. Run a benchmark first.")};fe(()=>{const V=document.querySelector(".gantt-scroll-area");if(V){const dt=()=>W++;V.addEventListener("scroll",dt,{passive:!0}),de(()=>V.removeEventListener("scroll",dt))}let ft=0;const bt=setInterval(()=>{if(P()||x()){const dt=performance.now();dt-ft>2e3&&(ft=dt,console.log("[PERF]",{fps:m(),avgFrame:R()+"ms",worstFrame:f()+"ms",scrollEvents:b()+"/sec",heap:z()+"MB"}))}},500);de(()=>clearInterval(bt))});const gt=B(()=>({view_mode:h(),renderMode:F(),bar_height:20,padding:8,column_width:h()==="Hour"?25:30,upper_header_height:35,lower_header_height:25,headerHeight:60,lines:"both",scroll_to:"start"})),mt=()=>{const V=performance.now();e(Zn.tasks),requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{n((performance.now()-V).toFixed(1)),r({tasks:document.querySelectorAll(".bar-wrapper").length,arrows:document.querySelectorAll(".arrow-layer > g").length})},0)})})};fe(()=>{mt(),pt()});const L={container:{"max-width":"100%",height:"100vh",margin:0,padding:"10px",display:"flex","flex-direction":"column","box-sizing":"border-box",overflow:"hidden","font-family":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},header:{"margin-bottom":"10px",display:"flex","align-items":"center",gap:"20px","flex-wrap":"wrap"},stats:{display:"flex",gap:"15px",padding:"10px 15px","background-color":"#1f2937",color:"#fff","border-radius":"6px","font-size":"13px","font-family":"monospace"},statItem:{display:"flex",gap:"5px"},statLabel:{color:"#9ca3af"},statValue:{color:"#10b981","font-weight":"bold"},controls:{display:"flex",gap:"10px","align-items":"center"},select:{padding:"6px 10px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"13px",cursor:"pointer"},button:{padding:"6px 12px","background-color":"#3b82f6",color:"#fff",border:"none","border-radius":"4px",cursor:"pointer","font-size":"13px"},ganttWrapper:{border:"1px solid #e0e0e0","border-radius":"8px",overflow:"hidden","background-color":"#fff",flex:1,"min-height":0}},C=()=>m()>=55?"#10b981":m()>=30?"#f59e0b":"#ef4444",kt=V=>V<=16.67?"#10b981":V<=33?"#f59e0b":"#ef4444";return(()=>{var V=vs(),ft=V.firstChild,bt=ft.firstChild,dt=bt.nextSibling,u=dt.firstChild,Y=u.firstChild,Z=Y.nextSibling,Q=u.nextSibling,vt=Q.firstChild,wt=vt.nextSibling,Ht=Q.nextSibling,Ft=Ht.firstChild,Rt=Ft.nextSibling,Pt=Ht.nextSibling,Tt=Pt.firstChild,It=Tt.nextSibling,Et=Pt.nextSibling,Wt=Et.firstChild,$t=Wt.nextSibling,Ut=$t.firstChild,At=Et.nextSibling,Yt=At.firstChild,Lt=Yt.nextSibling,Gt=Lt.firstChild,Bt=At.nextSibling,zt=Bt.firstChild,Xt=zt.nextSibling,Vt=Bt.nextSibling,qt=Vt.firstChild,ye=qt.nextSibling,te=dt.nextSibling,ke=te.firstChild,Ue=ke.firstChild,ee=Ue.nextSibling,ne=ke.nextSibling,Nt=ne.nextSibling,Ot=Nt.nextSibling,Ge=Ot.nextSibling,Jt=Ge.nextSibling,Kt=Jt.nextSibling,xe=Kt.nextSibling,Ne=xe.firstChild,oe=Ne.nextSibling,we=xe.nextSibling,Oe=we.firstChild,se=Oe.nextSibling,Je=we.nextSibling,Ke=Je.firstChild,re=Ke.nextSibling,Qe=te.nextSibling,Ze=Qe.firstChild,Se=Ze.nextSibling,tn=Se.firstChild,ae=tn.nextSibling,en=ae.nextSibling,_e=Se.nextSibling,nn=_e.firstChild,ie=nn.nextSibling,Te=ie.nextSibling,on=Te.firstChild,sn=_e.nextSibling,rn=sn.firstChild,le=rn.nextSibling,an=le.nextSibling,Ce=ft.nextSibling;return ct(Z,()=>s().tasks),ct(wt,()=>s().arrows),ct(Rt,(()=>{var g=he(()=>!!o());return()=>g()?`${o()}ms`:"..."})()),ct(It,m),ct($t,f,Ut),ct(Lt,R,Gt),ct(Xt,b),ct(ye,(()=>{var g=he(()=>!!z());return()=>g()?`${z()}MB`:"N/A"})()),ee.addEventListener("change",g=>d(g.target.value)),ne.$$click=mt,Nt.$$click=_,ct(Nt,()=>P()?"Stop":"H-Scroll"),Ot.$$click=p,ct(Ot,()=>x()?"Stop":"V-Scroll"),Jt.$$click=ot,ct(Jt,()=>st()?"Stop Bench":"Benchmark"),Kt.$$click=rt,oe.addEventListener("change",g=>w(g.target.value)),se.addEventListener("change",g=>$(g.target.value)),re.addEventListener("change",g=>et(g.target.value)),ae.$$input=g=>X(+g.target.value),ct(en,T),ie.$$input=g=>i(+g.target.value),ct(Te,a,on),le.$$input=g=>A(+g.target.value),ct(an,H),ct(Ce,ht(ns,{get tasks(){return t()},get options(){return gt()},get overscanRows(){return T()},get overscanX(){return a()},get overscanCols(){return H()},get arrowRenderer(){return D()},get taskLayerMode(){return j()},onDateChange:(g,jt)=>console.log("Date changed:",g,jt),onProgressChange:(g,jt)=>console.log("Progress changed:",g,jt),onTaskClick:g=>console.log("Task clicked:",g)})),xt(g=>{var jt=L.container,ln=L.header,cn=L.stats,dn=L.statItem,un=L.statLabel,gn=L.statValue,fn=L.statItem,hn=L.statLabel,mn=L.statValue,vn=L.statItem,pn=L.statLabel,bn=L.statValue,yn=L.statItem,kn=L.statLabel,xn={...L.statValue,color:C()},wn=L.statItem,Sn=L.statLabel,_n={...L.statValue,color:kt(f())},Tn=L.statItem,Cn=L.statLabel,Mn={...L.statValue,color:kt(R())},Dn=L.statItem,Hn=L.statLabel,Rn=L.statValue,Pn=L.statItem,In=L.statLabel,Fn=L.statValue,En=L.controls,$n={...L.select},An=L.button,Ln={...L.button,"background-color":P()?"#ef4444":"#8b5cf6"},Bn={...L.button,"background-color":x()?"#ef4444":"#8b5cf6"},Wn={...L.button,"background-color":st()?"#ef4444":"#059669"},Yn={...L.button,"background-color":v()?"#0891b2":"#6b7280"},Me=!v(),zn={...L.select},Xn={...L.select},Vn={...L.select},qn=L.ganttWrapper;return g.e=tt(V,jt,g.e),g.t=tt(ft,ln,g.t),g.a=tt(dt,cn,g.a),g.o=tt(u,dn,g.o),g.i=tt(Y,un,g.i),g.n=tt(Z,gn,g.n),g.s=tt(Q,fn,g.s),g.h=tt(vt,hn,g.h),g.r=tt(wt,mn,g.r),g.d=tt(Ht,vn,g.d),g.l=tt(Ft,pn,g.l),g.u=tt(Rt,bn,g.u),g.c=tt(Pt,yn,g.c),g.w=tt(Tt,kn,g.w),g.m=tt(It,xn,g.m),g.f=tt(Et,wn,g.f),g.y=tt(Wt,Sn,g.y),g.g=tt($t,_n,g.g),g.p=tt(At,Tn,g.p),g.b=tt(Yt,Cn,g.b),g.T=tt(Lt,Mn,g.T),g.A=tt(Bt,Dn,g.A),g.O=tt(zt,Hn,g.O),g.I=tt(Xt,Rn,g.I),g.S=tt(Vt,Pn,g.S),g.W=tt(qt,In,g.W),g.C=tt(ye,Fn,g.C),g.B=tt(te,En,g.B),g.v=tt(ee,$n,g.v),g.k=tt(ne,An,g.k),g.x=tt(Nt,Ln,g.x),g.j=tt(Ot,Bn,g.j),g.q=tt(Jt,Wn,g.q),g.z=tt(Kt,Yn,g.z),Me!==g.P&&(Kt.disabled=g.P=Me),g.H=tt(oe,zn,g.H),g.F=tt(se,Xn,g.F),g.M=tt(re,Vn,g.M),g.D=tt(Ce,qn,g.D),g},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0,T:void 0,A:void 0,O:void 0,I:void 0,S:void 0,W:void 0,C:void 0,B:void 0,v:void 0,k:void 0,x:void 0,j:void 0,q:void 0,z:void 0,P:void 0,H:void 0,F:void 0,M:void 0,D:void 0}),xt(()=>ee.value=h()),xt(()=>oe.value=D()),xt(()=>se.value=F()),xt(()=>re.value=j()),xt(()=>ae.value=T()),xt(()=>ie.value=a()),xt(()=>le.value=H()),V})()}pe(["click","input"]);const Be=document.getElementById("app");Be&&to(()=>ht(ps,{}),Be);
