import{z as Gt,d as Ft,l as jt,a as Nt,c as Y,b as E,n as Kt,v as Zt,m as P,t as K,i as B,w as Jt,G as Qt,j as k,I as te,C as ee,R as oe,D as ne,g as j,B as re,x as se,u as ht,e as xt,o as ie,A as ae}from"./calendar-K225rnsu.js";import{G as ce}from"./GanttContainer-UOquHELm.js";var bt=K("<div style=position:absolute;border-radius:3px;color:#fff;font-size:11px;padding-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box><div style=position:absolute;left:0;top:0;width:6px;height:100%;cursor:ew-resize></div><div style=position:absolute;right:0;top:0;width:6px;height:100%;cursor:ew-resize>"),le=K("<div style=position:absolute;opacity:0.5;border-radius:3px;color:#fff;font-size:11px;line-height:28px;padding-left:4px;overflow:hidden>"),de=K('<div style=height:100vh;display:flex;flex-direction:column;padding:10px;font-family:system-ui;background:#1a1a1a;color:#fff><div style=margin-bottom:10px;display:flex;gap:15px;align-items:center><h2 style=margin:0;font-size:16px>Experiments (<!> days Ã— <!> rows = <!> tasks)</h2><select style="padding:6px 10px;border-radius:4px;border:1px solid #444;background:#2d2d44;color:#fff;font-size:12px"><option value=baseline>baseline (single memo)</option><option value=noMemos>noMemos (direct access)</option><option value=splitMemo>splitMemo (static+dynamic)</option><option value=minimal>minimal (no handlers)</option></select><select style="padding:6px 10px;border-radius:4px;border:1px solid #444;background:#2d4444;color:#fff;font-size:12px"><option value=combined>combined (single memo)</option><option value=xySplit>xySplit (X/Y separate)</option><option value=smartCache>smartCache (skip unchanged)</option><option value=splitEquals>splitEquals (custom equality)</option><option value=untracked>untracked (no subscriptions)</option><option value=plainLookup>plainLookup (initialTasks)</option><option value=xBucket>xBucket (spatial index)</option><option value=xBucketStart>xBucketStart (no dedup)</option><option value=2D>2D (row+bucket)</option></select><span style=font-size:11px;color:#888>Visible: </span></div><div style="flex:1;border:1px solid #333;border-radius:8px;overflow:hidden;background:#1a1a1a;--g-header-bg-color:#1a1a1a;--g-header-text-color:#ccc;--g-header-text-color-secondary:#888;--g-grid-line-color:#333;--g-resource-bg:#1a1a1a;--g-text-color:#aaa;--g-row-color:#1a1a1a;--g-grid-bg-color:#1a1a1a">'),ue=K('<button style="padding:6px 12px;background:#ef4444;color:#fff;border:none;border-radius:4px;cursor:pointer">Stop (<!>)'),ge=K('<div style=display:flex;gap:6px><button style="padding:6px 10px;background:#8b5cf6;color:#fff;border:none;border-radius:4px;cursor:pointer">V-Scroll</button><button style="padding:6px 10px;background:#3b82f6;color:#fff;border:none;border-radius:4px;cursor:pointer">H-Scroll</button><button style="padding:6px 10px;background:#059669;color:#fff;border:none;border-radius:4px;cursor:pointer">Both'),pe=K("<div style=position:absolute;top:0;left:0;pointer-events:auto>");const L=28,F=4,fe=50,Mt=2,_t=200,Dt=6,N=144;function Rt(e){const[n,d]=e.split(" "),[s,p,T]=n.split("-").map(Number),[m,r]=(d||"00:00").split(":").map(Number);return new Date(Date.UTC(s,p-1,T,m,r))}const dt=Gt.tasks.map(e=>({...e,_start:Rt(e.start),_end:Rt(e.end)})),he=Math.min(...dt.map(e=>e._start.getTime())),xe=Math.max(...dt.map(e=>e._end.getTime())),gt=new Date(he),pt=new Date(xe),mt=new Date(Date.UTC(gt.getUTCFullYear(),gt.getUTCMonth(),gt.getUTCDate())),be=new Date(Date.UTC(pt.getUTCFullYear(),pt.getUTCMonth(),pt.getUTCDate()+1)),vt=[...new Set(dt.map(e=>e.resource))].sort(),Z={};vt.forEach((e,n)=>{Z[e]=n});const lt=vt.length,wt=Math.round((be-mt)/(24*60*60*1e3)),ct=wt*N,ft=lt*(L+F),Bt=[];for(let e=0;e<wt;e++){const n=new Date(mt.getTime()+e*24*60*60*1e3);Bt.push({x:e*N,width:N,upperText:e===0?Ft.format(n,"MMM YYYY"):n.getUTCDay()===1?`W${Math.ceil((e+1)/7)}`:"",lowerText:n.getUTCDate().toString(),isThickLine:n.getUTCDay()===1})}const me=vt.map((e,n)=>({id:e,name:e,type:"resource",displayIndex:n})),ve={displayResources:()=>me},we={barHeight:()=>L,padding:()=>F},V=(()=>{const e={},n=mt.getTime();return dt.forEach((d,s)=>{const p=Z[d.resource]??0,T=(d._start.getTime()-n)/(1e3*60*60),m=(d._end.getTime()-n)/(1e3*60*60),r=T*Dt,t=(m-T)*Dt;e[d.id]={...d,locked:s%7===0,progress:d.progress||0,$bar:{x:r,y:p*(L+F),width:Math.max(t,6),height:L}}}),e})(),G=(()=>{const e={};for(let n=0;n<lt;n++)e[n]=[];return Object.entries(V).forEach(([n,d])=>{const s=Z[d.resource]??0;e[s].push(n)}),e})(),_=N,$e=(()=>{const e={};return Object.entries(V).forEach(([n,d])=>{const s=d.$bar,p=Math.floor(s.x/_),T=Math.floor((s.x+s.width)/_);for(let m=p;m<=T;m++)(e[m]=e[m]||[]).push(n)}),e})(),ke=Object.fromEntries(Object.entries(V).map(([e,n])=>[e,Z[n.resource]??0])),Te=(()=>{const e={};return Object.entries(V).forEach(([n,d])=>{const s=d.$bar,p=Math.floor(s.x/_),T=Math.floor((s.x+s.width)/_),m=Z[d.resource]??0;(e[p]=e[p]||[]).push({id:n,endBucket:T,row:m})}),e})(),ye=Math.ceil(Math.max(...Object.values(V).map(e=>e.$bar.width))/_)+1,Se=(()=>{const e={};return Object.entries(V).forEach(([n,d])=>{const s=Z[d.resource]??0,p=d.$bar,T=Math.floor(p.x/_),m=Math.floor((p.x+p.width)/_);e[s]||(e[s]={});for(let r=T;r<=m;r++)(e[s][r]=e[s][r]||[]).push(n)}),e})();function Ht(e){const n=ht(),d=()=>typeof e.task=="function"?e.task():e.task,s=E(()=>{const r=d(),t=r==null?void 0:r.$bar,v=(r==null?void 0:r.progress)??0,u=(t==null?void 0:t.width)??40;return{colorBg:(r==null?void 0:r.color_bg)??"rgba(59,130,246,0.15)",colorFill:(r==null?void 0:r.color_fill)??"rgba(59,130,246,0.3)",locked:(r==null?void 0:r.locked)??!1,name:(r==null?void 0:r.name)??"",id:(r==null?void 0:r.id)??"",x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0,width:u,height:(t==null?void 0:t.height)??L,pw:u*v/100}}),p=()=>{const r=s(),t=r.pw;return`linear-gradient(to right, ${r.colorFill} 0px, ${r.colorFill} ${t}px, ${r.colorBg} ${t}px, ${r.colorBg} 100%)${r.locked?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:T,startDrag:m}=xt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var r=bt(),t=r.firstChild,v=t.nextSibling;return r.$$mousedown=u=>m(u,"dragging_bar",{taskId:s().id}),r.$$click=u=>{var l;return(l=n.onTaskClick)==null?void 0:l.call(n,s().id,u)},r.addEventListener("mouseleave",()=>{var u;return(u=n.onHoverEnd)==null?void 0:u.call(n)}),r.addEventListener("mouseenter",u=>{var l;return(l=n.onHover)==null?void 0:l.call(n,s().id,u.clientX,u.clientY)}),B(r,()=>s().name,t),t.$$mousedown=u=>{u.stopPropagation(),m(u,"dragging_left",{taskId:s().id})},v.$$mousedown=u=>{u.stopPropagation(),m(u,"dragging_right",{taskId:s().id})},j(u=>{var l=`translate(${s().x}px, ${s().y}px)`,y=`${s().width}px`,D=`${s().height}px`,q=T()?"grabbing":"grab",U=p(),H=`${s().height}px`;return l!==u.e&&k(r,"transform",u.e=l),y!==u.t&&k(r,"width",u.t=y),D!==u.a&&k(r,"height",u.a=D),q!==u.o&&k(r,"cursor",u.o=q),U!==u.i&&k(r,"background",u.i=U),H!==u.n&&k(r,"line-height",u.n=H),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}function Ee(e){const n=ht(),d=()=>typeof e.task=="function"?e.task():e.task,s=()=>{var a;return((a=d())==null?void 0:a.color_bg)??"rgba(59,130,246,0.15)"},p=()=>{var a;return((a=d())==null?void 0:a.color_fill)??"rgba(59,130,246,0.3)"},T=()=>{var a;return((a=d())==null?void 0:a.name)??""},m=()=>{var a;return((a=d())==null?void 0:a.id)??""},r=()=>{var a;return((a=d())==null?void 0:a.progress)??0},t=()=>{var a;return((a=d())==null?void 0:a.locked)??!1},v=()=>{var a,w;return((w=(a=d())==null?void 0:a.$bar)==null?void 0:w.x)??0},u=()=>{var a,w;return((w=(a=d())==null?void 0:a.$bar)==null?void 0:w.y)??0},l=()=>{var a,w;return((w=(a=d())==null?void 0:a.$bar)==null?void 0:w.width)??40},y=()=>{var a,w;return((w=(a=d())==null?void 0:a.$bar)==null?void 0:w.height)??L},D=()=>l()*r()/100,q=()=>{const a=s(),w=p(),M=D();return`linear-gradient(to right, ${w} 0px, ${w} ${M}px, ${a} ${M}px, ${a} 100%)${t()?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:U,startDrag:H}=xt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var a=bt(),w=a.firstChild,M=w.nextSibling;return a.$$mousedown=b=>H(b,"dragging_bar",{taskId:m()}),a.$$click=b=>{var O;return(O=n.onTaskClick)==null?void 0:O.call(n,m(),b)},a.addEventListener("mouseleave",()=>{var b;return(b=n.onHoverEnd)==null?void 0:b.call(n)}),a.addEventListener("mouseenter",b=>{var O;return(O=n.onHover)==null?void 0:O.call(n,m(),b.clientX,b.clientY)}),B(a,T,w),w.$$mousedown=b=>{b.stopPropagation(),H(b,"dragging_left",{taskId:m()})},M.$$mousedown=b=>{b.stopPropagation(),H(b,"dragging_right",{taskId:m()})},j(b=>{var O=`translate(${v()}px, ${u()}px)`,ot=`${l()}px`,nt=`${y()}px`,z=U()?"grabbing":"grab",X=q(),J=`${y()}px`;return O!==b.e&&k(a,"transform",b.e=O),ot!==b.t&&k(a,"width",b.t=ot),nt!==b.a&&k(a,"height",b.a=nt),z!==b.o&&k(a,"cursor",b.o=z),X!==b.i&&k(a,"background",b.i=X),J!==b.n&&k(a,"line-height",b.n=J),b},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a})()}function Ce(e){const n=ht(),d=()=>typeof e.task=="function"?e.task():e.task,s=E(()=>{const t=d();return{colorBg:(t==null?void 0:t.color_bg)??"rgba(59,130,246,0.15)",colorFill:(t==null?void 0:t.color_fill)??"rgba(59,130,246,0.3)",name:(t==null?void 0:t.name)??"",id:(t==null?void 0:t.id)??"",locked:(t==null?void 0:t.locked)??!1}}),p=E(()=>{const t=d(),v=t==null?void 0:t.$bar,u=(t==null?void 0:t.progress)??0,l=(v==null?void 0:v.width)??40;return{x:(v==null?void 0:v.x)??0,y:(v==null?void 0:v.y)??0,width:l,height:(v==null?void 0:v.height)??L,pw:l*u/100}}),T=()=>{const t=s(),v=p();return`linear-gradient(to right, ${t.colorFill} 0px, ${t.colorFill} ${v.pw}px, ${t.colorBg} ${v.pw}px, ${t.colorBg} 100%)${t.locked?", repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 6px)":""}`},{isDragging:m,startDrag:r}=xt({onDragStart:()=>{},onDragMove:()=>{},onDragEnd:()=>{}});return(()=>{var t=bt(),v=t.firstChild,u=v.nextSibling;return t.$$mousedown=l=>r(l,"dragging_bar",{taskId:s().id}),t.$$click=l=>{var y;return(y=n.onTaskClick)==null?void 0:y.call(n,s().id,l)},t.addEventListener("mouseleave",()=>{var l;return(l=n.onHoverEnd)==null?void 0:l.call(n)}),t.addEventListener("mouseenter",l=>{var y;return(y=n.onHover)==null?void 0:y.call(n,s().id,l.clientX,l.clientY)}),B(t,()=>s().name,v),v.$$mousedown=l=>{l.stopPropagation(),r(l,"dragging_left",{taskId:s().id})},u.$$mousedown=l=>{l.stopPropagation(),r(l,"dragging_right",{taskId:s().id})},j(l=>{var y=`translate(${p().x}px, ${p().y}px)`,D=`${p().width}px`,q=`${p().height}px`,U=m()?"grabbing":"grab",H=T(),a=`${p().height}px`;return y!==l.e&&k(t,"transform",l.e=y),D!==l.t&&k(t,"width",l.t=D),q!==l.a&&k(t,"height",l.a=q),U!==l.o&&k(t,"cursor",l.o=U),H!==l.i&&k(t,"background",l.i=H),a!==l.n&&k(t,"line-height",l.n=a),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),t})()}function Me(e){const n=()=>typeof e.task=="function"?e.task():e.task,d=()=>{var s;return(s=n())==null?void 0:s.$bar};return(()=>{var s=le();return B(s,()=>{var p;return((p=n())==null?void 0:p.name)??""}),j(p=>{var v,u,l,y,D;var T=`translate(${((v=d())==null?void 0:v.x)??0}px, ${((u=d())==null?void 0:u.y)??0}px)`,m=`${((l=d())==null?void 0:l.width)??40}px`,r=`${((y=d())==null?void 0:y.height)??L}px`,t=((D=n())==null?void 0:D.color)??"#3b82f6";return T!==p.e&&k(s,"transform",p.e=T),m!==p.t&&k(s,"width",p.t=m),r!==p.a&&k(s,"height",p.a=r),t!==p.o&&k(s,"background",p.o=t),p},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()}const _e={baseline:Ht,noMemos:Ee,splitMemo:Ce,minimal:Me};function De(){const[e]=Nt(V),n=Object.keys(e),d=new URLSearchParams(window.location.search),s=d.get("variant")||"baseline",p=d.get("test"),T=d.get("virt")||"combined",[m,r]=Y(s),[t,v]=Y(T),[u,l]=Y(1200),[y,D]=Y(800),[q,U]=Y(0),[H,a]=Y(0),w=E(()=>{const o=H(),i=Math.floor(o/(L+F)),c=Math.ceil((o+y())/(L+F))+Mt;return{start:Math.max(0,i-Mt),end:Math.min(c,lt)}}),M=E(()=>{const o=q();return{start:Math.max(0,o-_t),end:o+u()+_t}});let b=[];const O=E(()=>{if(t()!=="combined")return b;const o=w(),i=M(),c=[];for(let f=o.start;f<o.end;f++){const h=G[f]||[];for(const x of h){const g=e[x],$=g==null?void 0:g.$bar;if(!$)continue;$.x+$.width>=i.start&&$.x<=i.end&&c.push(g)}}return c}),ot=E(()=>{if(t()!=="xySplit")return[];const o=w(),i=[];for(let c=o.start;c<o.end;c++){const f=G[c]||[];for(const h of f)i.push(e[h])}return i}),nt=E(()=>{if(t()!=="xySplit")return[];const o=M(),i=ot(),c=[];for(const f of i){const h=f==null?void 0:f.$bar;if(!h)continue;h.x+h.width>=o.start&&h.x<=o.end&&c.push(f)}return c});let z=[],X=[],J=-1,$t=-1,kt=-1,Tt=-1;const It=E(()=>{if(t()!=="smartCache")return[];const o=w(),i=M(),c=o.start!==J||o.end!==$t,f=i.start!==kt||i.end!==Tt;if(c){z=[];for(let h=o.start;h<o.end;h++)for(const x of G[h]||[])z.push(e[x]);J=o.start,$t=o.end}if(c||f){X=[];for(const h of z){const x=h==null?void 0:h.$bar;x&&x.x+x.width>=i.start&&x.x<=i.end&&X.push(h)}kt=i.start,Tt=i.end}return X}),yt=(o,i)=>o.length===i.length&&o.every((c,f)=>c===i[f]),Lt=E(()=>{if(t()!=="splitEquals")return[];const o=w(),i=[];for(let c=o.start;c<o.end;c++)for(const f of G[c]||[])i.push(f);return i},{equals:yt}),Ot=E(()=>{if(t()!=="splitEquals")return[];const o=Lt(),i=M(),c=[];for(const f of o){const h=e[f],x=h==null?void 0:h.$bar;x&&x.x+x.width>=i.start&&x.x<=i.end&&c.push(f)}return c},{equals:yt}),At=E(()=>t()!=="splitEquals"?[]:Ot().map(i=>e[i])),qt=E(()=>{if(t()!=="untracked")return[];const o=w(),i=M();return Kt(()=>{const c=[];for(let f=o.start;f<o.end;f++){const h=G[f]||[];for(const x of h){const g=e[x],$=g==null?void 0:g.$bar;if(!$)continue;$.x+$.width>=i.start&&$.x<=i.end&&c.push(g)}}return c})}),Ut=E(()=>{if(t()!=="plainLookup")return[];const o=w(),i=M(),c=[];for(let f=o.start;f<o.end;f++){const h=G[f]||[];for(const x of h){const g=V[x].$bar;g.x+g.width>=i.start&&g.x<=i.end&&c.push(e[x])}}return c}),Wt=E(()=>{if(t()!=="xBucket")return[];const o=M(),i=w(),c=Math.floor(o.start/_),f=Math.floor(o.end/_),h={},x=[];for(let g=c;g<=f;g++)for(const $ of $e[g]||[]){if(h[$])continue;h[$]=1;const C=ke[$];C>=i.start&&C<i.end&&x.push(e[$])}return x}),Yt=E(()=>{if(t()!=="xBucketStart")return[];const o=M(),i=w(),c=Math.floor(o.start/_),f=Math.floor(o.end/_),h=Math.max(0,c-ye),x=[];for(let g=h;g<=f;g++)for(const{id:$,endBucket:C,row:S}of Te[g]||[])C>=c&&S>=i.start&&S<i.end&&x.push(e[$]);return x}),Pt=E(()=>{if(t()!=="2D")return[];const o=M(),i=w(),c=Math.floor(o.start/_),f=Math.floor(o.end/_),h=[];for(let x=i.start;x<i.end;x++){const g=Se[x];if(!g)continue;const $={};for(let C=c;C<=f;C++)for(const S of g[C]||[])$[S]||($[S]=1,h.push(e[S]))}return h}),St=()=>{const o=t();return o==="xySplit"?nt():o==="smartCache"?It():o==="splitEquals"?At():o==="untracked"?qt():o==="plainLookup"?Ut():o==="xBucket"?Wt():o==="xBucketStart"?Yt():o==="2D"?Pt():O()};let W,Q=null;const[Et,rt]=Y(!1),[Vt,st]=Y(null),it=o=>{if(Et()){Q&&(Q.abort=!0),rt(!1),st(null);return}rt(!0),st(o);const i={abort:!1};Q=i;let c=1,f=1;const h=1e4,x=performance.now(),g=W==null?void 0:W.querySelector(".gantt-scroll-area"),$=g?g.scrollHeight-g.clientHeight:0,C=g?g.scrollWidth-g.clientWidth:0;let S=g?g.scrollTop:0,A=g?g.scrollLeft:0;const tt=()=>{if(i.abort||performance.now()-x>h){rt(!1),st(null);return}g&&((o==="vertical"||o==="both")&&(S+=c*100,S>=$?(c=-1,S=$):S<=0&&(c=1,S=0),g.scrollTop=S),(o==="horizontal"||o==="both")&&(A+=f*150,A>=C?(f=-1,A=C):A<=0&&(f=1,A=0),g.scrollLeft=A)),requestAnimationFrame(tt)};requestAnimationFrame(tt)};Zt(()=>{const o=()=>{if(W){const c=W.querySelector(".gantt-scroll-area");c&&(l(c.clientWidth),D(c.clientHeight))}};setTimeout(o,100);const i=new ResizeObserver(o);W&&i.observe(W),ie(()=>i.disconnect()),p&&["vertical","horizontal","both"].includes(p)&&setTimeout(()=>it(p),500)});const zt=()=>_e[m()]||Ht;return P(se,{get children(){var o=de(),i=o.firstChild,c=i.firstChild,f=c.firstChild,h=f.nextSibling,x=h.nextSibling,g=x.nextSibling,$=g.nextSibling,C=$.nextSibling;C.nextSibling;var S=c.nextSibling,A=S.nextSibling,tt=A.nextSibling;tt.firstChild;var ut=i.nextSibling;B(c,wt,h),B(c,lt,g),B(c,()=>n.length,C),S.addEventListener("change",R=>r(R.target.value)),A.addEventListener("change",R=>v(R.target.value)),B(tt,()=>St().length,null),B(i,(()=>{var R=Jt(()=>!!Et());return()=>R()?(()=>{var I=ue(),at=I.firstChild,et=at.nextSibling;return et.nextSibling,I.$$click=()=>{Q&&(Q.abort=!0),rt(!1),st(null)},B(I,Vt,et),I})():(()=>{var I=ge(),at=I.firstChild,et=at.nextSibling,Xt=et.nextSibling;return at.$$click=()=>it("vertical"),et.$$click=()=>it("horizontal"),Xt.$$click=()=>it("both"),I})()})(),null);var Ct=W;return typeof Ct=="function"?re(Ct,ut):W=ut,B(ut,P(ce,{svgWidth:ct,svgHeight:ft,resourceColumnWidth:60,headerHeight:fe,onScroll:(R,I)=>{U(R),a(I)},get header(){return P(ne,{dateInfos:Bt,columnWidth:N,gridWidth:ct,upperHeaderHeight:25,lowerHeaderHeight:25})},get resourceColumn(){return P(oe,{resourceStore:ve,ganttConfig:we,width:60,get startRow(){return w().start},get endRow(){return w().end}})},get barsLayer(){return(()=>{var R=pe();return k(R,"width",`${ct}px`),k(R,"height",`${ft}px`),B(R,P(te,{get each(){return St()},children:I=>P(ee,{get component(){return zt()},task:I})})),R})()},get children(){return P(Qt,{width:ct,height:ft,barHeight:L,padding:F,taskCount:0,columnWidth:N,lines:"vertical",backgroundColor:"#1a1a1a",lineColor:"#333",thickLineColor:"#444"})}})),j(()=>S.value=m()),j(()=>A.value=t()),o}})}jt(["click","mousedown"]);ae(()=>P(De,{}),document.getElementById("app"));
