import{c as I,o as de,a as Vn,r as De,p as He,d as N,b as F,u as qn,e as Be,f as Mt,t as Dt,i as at,g as xt,h as ue,s as rt,j as z,k as Re,l as pe,m as mt,S as jn,F as We,n as _t,I as ge,q as fe,G as Un,v as he,D as Gn,R as Nn,w as On,x as Jn,y as Q,z as Kn,A as Qn}from"./calendar-Ds9A9IRk.js";import{d as Zn,b as to,r as Pe,c as eo,a as no,T as oo,e as so}from"./TaskDataModal-BhVVBTj7.js";import{G as ro}from"./GanttContainer-BRJ_KmMW.js";function ao(t){const[e,n]=I(!1);let o=0;const s=f=>{o=requestAnimationFrame(s),t(f)},r=()=>{e()||(n(!0),o=requestAnimationFrame(s))},h=()=>{n(!1),cancelAnimationFrame(o)};return de(h),[e,r,h]}function io(){const[t,e]=Vn({}),[n,o]=I(new Set),[s,r]=I(null);return{tasks:t,getTask:a=>t[a],getBarPosition:a=>{const l=t[a];return!l||!l.$bar?null:{x:l.$bar.x,y:l.$bar.y,width:l.$bar.width,height:l.$bar.height,index:l._index}},getAllTasks:()=>Object.values(t),taskCount:()=>Object.keys(t).length,updateTask:(a,l)=>{e(a,l)},updateBarPosition:(a,l)=>{t[a]&&e(He(M=>{M[a]&&(M[a].$bar={...M[a].$bar,...l})}))},updateTasks:a=>{const l={};a.forEach(M=>{l[M.id]=M}),e(De(l))},batchMovePositions:(a,l)=>{e(He(M=>{for(const[W,{originalX:Y}]of a)M[W]?.$bar&&(M[W].$bar.x=Y+l)}))},removeTask:a=>{e(a,void 0)},clear:()=>{e(De({}))},collapsedTasks:n,toggleTaskCollapse:a=>{o(l=>{const M=new Set(l);return M.has(a)?M.delete(a):M.add(a),M})},isTaskCollapsed:a=>n().has(a),expandTask:a=>{o(l=>{if(!l.has(a))return l;const M=new Set(l);return M.delete(a),M})},collapseTask:a=>{o(l=>{if(l.has(a))return l;const M=new Set(l);return M.add(a),M})},expandAllTasks:()=>{o(new Set)},collapseAllTasks:()=>{const a=[];for(const l of Object.values(t))(l.type==="summary"||l._children&&l._children.length>0)&&a.push(l.id);o(new Set(a))},draggingTaskId:s,setDraggingTaskId:r}}function lo(t={}){const[e,n]=I(t.ganttStart||new Date),[o,s]=I(t.ganttEnd||new Date),[r,h]=I(t.unit||"day"),[f,w]=I(t.step||1),[u,S]=I(t.columnWidth||t.column_width||45),[c,P]=I(t.barHeight||t.bar_height||30),[E,R]=I(t.headerHeight||75),[C,y]=I(t.padding||18),[i,v]=I(t.barCornerRadius||t.bar_corner_radius||3),[k,_]=I(t.readonly||!1),[U,a]=I(t.readonlyDates||!1),[l,M]=I(t.readonlyProgress||!1),[W,Y]=I(t.showExpectedProgress||!1),[K,lt]=I(t.autoMoveLabel||!1),[ut,p]=I(t.ignoredDates||[]),[O,b]=I(t.ignoredFunction||null),[x,H]=I([]),[$,V]=I(t.subtaskHeightRatio||.5),[G,J]=I(t.renderMode||"simple"),[nt,A]=I(new Set(t.expandedTasks||[]));return{ganttStart:e,ganttEnd:o,unit:r,step:f,columnWidth:u,barHeight:c,headerHeight:E,padding:C,barCornerRadius:i,readonly:k,readonlyDates:U,readonlyProgress:l,showExpectedProgress:W,autoMoveLabel:K,ignoredDates:ut,ignoredFunction:O,ignoredPositions:x,subtaskHeightRatio:$,renderMode:G,expandedTasks:nt,setGanttStart:n,setGanttEnd:s,setUnit:h,setStep:w,setColumnWidth:S,setBarHeight:P,setHeaderHeight:R,setPadding:y,setBarCornerRadius:v,setReadonly:_,setReadonlyDates:a,setReadonlyProgress:M,setShowExpectedProgress:Y,setAutoMoveLabel:lt,setIgnoredDates:p,setIgnoredFunction:b,setIgnoredPositions:H,setSubtaskHeightRatio:V,setRenderMode:J,setExpandedTasks:A,isTaskExpanded:m=>nt().has(m),toggleTaskExpansion:m=>{A(tt=>{const et=new Set(tt);return et.has(m)?et.delete(m):et.add(m),et})},expandTask:m=>{A(tt=>{if(tt.has(m))return tt;const et=new Set(tt);return et.add(m),et})},collapseTask:m=>{A(tt=>{if(!tt.has(m))return tt;const et=new Set(tt);return et.delete(m),et})},expandAllTasks:m=>{A(new Set(m))},collapseAllTasks:()=>{A(new Set)},updateOptions:m=>{m.ganttStart!==void 0&&n(m.ganttStart),m.ganttEnd!==void 0&&s(m.ganttEnd),m.unit!==void 0&&h(m.unit),m.step!==void 0&&w(m.step),m.columnWidth!==void 0&&S(m.columnWidth),m.barHeight!==void 0&&P(m.barHeight),m.headerHeight!==void 0&&R(m.headerHeight),m.padding!==void 0&&y(m.padding),m.barCornerRadius!==void 0&&v(m.barCornerRadius),m.readonly!==void 0&&_(m.readonly),m.readonlyDates!==void 0&&a(m.readonlyDates),m.readonlyProgress!==void 0&&M(m.readonlyProgress),m.showExpectedProgress!==void 0&&Y(m.showExpectedProgress),m.autoMoveLabel!==void 0&&lt(m.autoMoveLabel),m.ignoredDates!==void 0&&p(m.ignoredDates),m.ignoredFunction!==void 0&&b(m.ignoredFunction),m.ignoredPositions!==void 0&&H(m.ignoredPositions),m.subtaskHeightRatio!==void 0&&V(m.subtaskHeightRatio),m.renderMode!==void 0&&J(m.renderMode),m.expandedTasks!==void 0&&A(new Set(m.expandedTasks))},getConfig:()=>({ganttStart:e(),ganttEnd:o(),unit:r(),step:f(),columnWidth:u(),barHeight:c(),headerHeight:E(),padding:C(),barCornerRadius:i(),readonly:k(),readonlyDates:U(),readonlyProgress:l(),showExpectedProgress:W(),autoMoveLabel:K(),ignoredDates:ut(),ignoredFunction:O(),ignoredPositions:x(),subtaskHeightRatio:$(),renderMode:G(),expandedTasks:nt()})}}function ce(t){const e=t.getFullYear();return e-e%10+""}function co(t,e,n){let o=N.add(t,6,"day"),s=o.getMonth()!==t.getMonth()?"D MMM":"D",r=!e||t.getMonth()!==e.getMonth()?"D MMM":"D";return`${N.format(t,r,n)} - ${N.format(o,s,n)}`}const Qt=[{name:"Minute",padding:"1h",step:"1min",column_width:20,date_format:"YYYY-MM-DD HH:mm",lower_text:"mm",upper_text:(t,e,n)=>!e||t.getHours()!==e.getHours()?N.format(t,"D MMM HH:00",n):"",upper_text_frequency:60},{name:"Quarter Hour",padding:"6h",step:"15min",column_width:30,date_format:"YYYY-MM-DD HH:mm",lower_text:"mm",upper_text:(t,e,n)=>!e||t.getHours()!==e.getHours()?N.format(t,"D MMM HH:00",n):"",upper_text_frequency:4},{name:"Hour",padding:"7d",step:"1h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,n)=>!e||t.getDate()!==e.getDate()?N.format(t,"D MMMM",n):"",upper_text_frequency:24},{name:"Quarter Day",padding:"7d",step:"6h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,n)=>!e||t.getDate()!==e.getDate()?N.format(t,"D MMM",n):"",upper_text_frequency:4},{name:"Half Day",padding:"14d",step:"12h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(t,e,n)=>!e||t.getDate()!==e.getDate()?t.getMonth()!==t.getMonth()?N.format(t,"D MMM",n):N.format(t,"D",n):"",upper_text_frequency:2},{name:"Day",padding:"7d",date_format:"YYYY-MM-DD",step:"1d",lower_text:(t,e,n)=>!e||t.getDate()!==e.getDate()?N.format(t,"D",n):"",upper_text:(t,e,n)=>!e||t.getMonth()!==e.getMonth()?N.format(t,"MMMM",n):"",thick_line:t=>t.getDay()===1},{name:"Week",padding:"1m",step:"7d",date_format:"YYYY-MM-DD",column_width:140,lower_text:co,upper_text:(t,e,n)=>!e||t.getMonth()!==e.getMonth()?N.format(t,"MMMM",n):"",thick_line:t=>t.getDate()>=1&&t.getDate()<=7,upper_text_frequency:4},{name:"Month",padding:"2m",step:"1m",column_width:120,date_format:"YYYY-MM",lower_text:"MMMM",upper_text:(t,e,n)=>!e||t.getFullYear()!==e.getFullYear()?N.format(t,"YYYY",n):"",thick_line:t=>t.getMonth()%3===0,snap_at:"7d"},{name:"Year",padding:"2y",step:"1y",column_width:120,date_format:"YYYY",upper_text:(t,e,n)=>!e||ce(t)!==ce(e)?ce(t):"",lower_text:"YYYY",snap_at:"30d"}];function uo(t={}){const[e,n]=I(t.ganttStart||new Date),[o,s]=I(t.ganttEnd||new Date),[r,h]=I([]),f=Qt.find(p=>p.name==="Day")||Qt[3],w=t.viewMode||t.view_mode,u=w&&Qt.find(p=>p.name===w)||f,[S,c]=I(u),[P]=I(t.viewModes||Qt),[E,R]=I(t.language||"en"),C=F(()=>r().length),y=F(()=>{const p=S();return N.parse_duration(p.step)}),i=F(()=>y().scale),v=F(()=>y().duration),[k]=I(t.columnWidth||t.column_width||null),_=F(()=>k()||S().column_width||45),U=F(()=>C()*_()),a=(p,O=!1)=>{if(!p||p.length===0){const A=N.today(),X=S(),{duration:st,scale:ft}=N.parse_duration(X.padding||"7d"),vt=N.add(A,-st,ft),bt=N.add(A,st,ft);n(N.start_of(vt,i())),s(bt),l();return}let b=null,x=null;for(const A of p){const X=A._start||N.parse(A.start),st=A._end||N.parse(A.end);(!b||X<b)&&(b=X),(!x||st>x)&&(x=st)}const H=S(),{duration:$,scale:V}=N.parse_duration(H.padding||"7d");let G=N.add(b,-$,V),J=N.add(x,$,V);O&&(G=N.add(G,-30,i()),J=N.add(J,30,i())),G=N.start_of(G,i());const nt=i();nt!=="hour"&&nt!=="minute"&&G.setHours(0,0,0,0),n(G),s(J),l()},l=()=>{const p=e(),O=o(),b=v(),x=i(),H=[];let $=new Date(p);for(;$<O;)H.push(new Date($)),$=N.add($,b,x);h(H)},M=(p,O=10)=>{const b=v(),x=i();if(p==="left"){const H=N.add(e(),-O*b,x);n(H)}else{const H=N.add(o(),O*b,x);s(H)}l()},W=p=>{if(typeof p=="string"){const O=P().find(b=>b.name===p);O&&(c(O),l())}else p&&p.name&&(c(p),l())},Y=(p,O,b=null)=>{const x=S(),H=E(),$=_(),V=O*$;let G="";typeof x.lower_text=="function"?G=x.lower_text(p,b,H):typeof x.lower_text=="string"&&(G=N.format(p,x.lower_text,H));let J="";typeof x.upper_text=="function"?J=x.upper_text(p,b,H):typeof x.upper_text=="string"&&(J=N.format(p,x.upper_text,H));const nt=x.thick_line?x.thick_line(p):!1;return{date:p,x:V,width:$,lowerText:G,upperText:J,isThickLine:nt}},K=F(()=>{const p=r(),O=[];let b=null;for(let x=0;x<p.length;x++){const H=Y(p[x],x,b);O.push(H),b=p[x]}return O});return{ganttStart:e,ganttEnd:o,dates:r,viewMode:S,viewModes:P,language:E,setGanttStart:n,setGanttEnd:s,setViewMode:W,setLanguage:R,dateCount:C,unit:i,step:v,columnWidth:_,gridWidth:U,getAllDateInfos:K,setupDates:a,generateDates:l,extendTimeline:M,changeViewMode:W,getDateInfo:Y,dateToX:p=>{const O=e(),b=v(),x=i(),H=_();return N.diff(p,O,x)/b*H},xToDate:p=>{const O=e(),b=v(),x=i(),H=_(),$=p/H*b;return N.add(O,$,x)}}}function $e(t){return!t||t.length===0?[]:t.map(e=>typeof e=="object"&&e!==null?{...e,id:e.id||e.name||String(e),type:e.type||"resource",group:e.group||null}:{id:String(e),type:"resource",group:null})}function go(t,e){const n=[];for(const o of t){if(o.type==="group"){n.push({...o,displayIndex:n.length,isCollapsed:e.has(o.id)});continue}o.group&&e.has(o.group)||n.push({...o,displayIndex:n.length})}return n}function fo(t){if(!t||t.length===0)return[];const e=new Set,n=[];for(const o of t){const s=o.resource||"Unassigned";e.has(s)||(e.add(s),n.push({id:s,type:"resource",group:null}))}return n}function ho(t=[]){const[e,n]=I($e(t)),[o,s]=I(new Set),r=F(()=>go(e(),o())),h=F(()=>{const y=new Map,i=r();for(let v=0;v<i.length;v++)y.set(i[v].id,v);return y}),f=F(()=>r().length),w=y=>{s(i=>{const v=new Set(i);return v.has(y)?v.delete(y):v.add(y),v})},u=y=>{s(i=>{const v=new Set(i);return v.delete(y),v})},S=y=>{s(i=>{const v=new Set(i);return v.add(y),v})},c=y=>o().has(y),P=y=>{n($e(y))},E=F(()=>e().filter(y=>y.type==="group"));return{resources:e,collapsedGroups:o,displayResources:r,resourceIndexMap:h,displayCount:f,getGroups:E,updateResources:P,toggleGroup:w,expandGroup:u,collapseGroup:S,isGroupCollapsed:c,expandAll:()=>{s(new Set)},collapseAll:()=>{const y=E();s(new Set(y.map(i=>i.id)))}}}function mo(t,e,n,o,s){return N.diff(t,e,n)/o*s}function vo(t,e,n){const o=e+n;return t*o+n/2}function po(t,e,n,o,s){return N.diff(e,t,n)/o*s}function Ie(t,e,n,o=[],s=45){const r=t+e,h=new Set(o.map(E=>Math.floor(E/s))),w=o.reduce((E,R)=>E+(R>=t&&R<r?1:0),0)*s;let u=(e-w)*n/100;const S=t+u,c=o.reduce((E,R)=>E+(R>=t&&R<S?1:0),0);u+=c*s;let P=t+u;for(;P<r;){const E=Math.floor(P/s);if(h.has(E))u+=s,P=t+u;else break}return Math.min(u,e)}function bo(t,e,n,o){const s=N.today(),r=N.diff(e,t,"hour")/o,h=N.diff(s,t,"hour")/o,f=Math.min(h,r);return r>0?f*100/r:0}function ko(t,e,n){return e.some(o=>t>=o&&t<o+n)}function me(t,e,n=[]){let o=Math.round(t/e)*e;for(;ko(o,n,e);)o+=e;return o}function Ye(t,e,n,o=7){return n.length*o+10<e?{x:t+e/2,position:"inside"}:{x:t+e+5,position:"outside"}}function yo(t,e,n=20){if(!t._children||t._children.length===0)return null;const o=e.get?u=>e.get(u):u=>e[u],s=[],r=u=>{for(const S of u){const c=o(S);c?.$bar&&(s.push(c.$bar),c._children&&c._children.length>0&&r(c._children))}};if(r(t._children),s.length===0)return null;const h=Math.min(...s.map(u=>u.x)),f=Math.max(...s.map(u=>u.x+u.width)),w=Math.max(f-h,n);return{x:h,width:w}}function xo(t){let e=0;for(const n of t.values())n._depth>e&&(e=n._depth);for(let n=e;n>=0;n--)for(const o of t.values())if(o._depth===n&&o.type==="summary"){const s=yo(o,t);s&&o.$bar&&(o.$bar.x=s.x,o.$bar.width=s.width)}}function wo(t,e){return`task-${t.name||""}-${e}-${Date.now()}`.replace(/\s+/g,"-")}function So(t){return t?Array.isArray(t)?t.filter(e=>e&&typeof e=="object").map(e=>({id:e.id,type:e.type||"FS",lag:e.lag||0,max:e.max})):(console.warn("parseDependencies: dependencies must be an array, got:",typeof t,t),[]):[]}function Co(t,e){const n={...t};if(n.id||(n.id=wo(t,e)),n._start=N.parse(t.start),t.end)n._end=N.parse(t.end);else if(t.duration){const{duration:s,scale:r}=N.parse_duration(t.duration);n._end=N.add(n._start,s,r)}else n._end=new Date(n._start);return N.diff(n._end,n._start,"year")>10?(console.error(`Task "${n.name}" has duration > 10 years`),null):(n._end<n._start&&(console.warn(`Task "${n.name}" has end before start, swapping`),[n._start,n._end]=[n._end,n._start]),n.dependencies=So(t.dependencies),n._index=e,typeof n.progress!="number"&&(n.progress=0),n.progress=Math.max(0,Math.min(100,n.progress)),n.constraints={locked:!1,...t.constraints},t.parentId!==void 0&&(n.parentId=t.parentId),t.type!==void 0&&(n.type=t.type),n._children=[],n._depth=0,n)}function To(t,e,n=null){const o=[],s=[];for(let u=0;u<t.length;u++){const S=Co(t[u],u);S&&o.push(S)}const r=new Set,h=[];for(const u of o){const S=u.resource||"Unassigned";r.has(S)||(r.add(S),h.push(S))}let f;n?f=n:(f=new Map,h.forEach((u,S)=>f.set(u,S)));for(const u of o){const S=u.resource||"Unassigned",c=f.get(S),P=c!==void 0?c:-1,E=P<0,R=mo(u._start,e.ganttStart,e.unit,e.step,e.columnWidth),C=E?-1e3:vo(P,e.barHeight,e.padding),y=po(u._start,u._end,e.unit,e.step,e.columnWidth);u.$bar={x:R,y:C,width:y,height:e.barHeight},u._resourceIndex=P,u._isHidden=E;for(const i of u.dependencies)o.find(k=>k.id===i.id)&&s.push({from:i.id,to:u.id,type:i.type||"FS",lag:i.lag||0,elastic:!0})}const w=Zn(s);return w.hasCycle&&console.warn(`Circular dependency detected: ${w.cycle.join(" â†’ ")}`,`
This may cause unexpected behavior during task dragging.`),{tasks:o,relationships:s,resources:h}}function Mo(t){let e=null,n=null;for(const o of t){const s=o._start,r=o._end;(!e||s<e)&&(e=s),(!n||r>n)&&(n=r)}return{minDate:e||new Date,maxDate:n||new Date}}function _o(t){return t?t.entries?Array.from(t.entries()):Object.entries(t):[]}function ze(t,e){return t?t.get?t.get(e):t[e]:null}function Do(t,e,n,o){const{barHeight:s=30,padding:r=18,subtaskHeightRatio:h=.5}=e,f=s+r,w=new Map;let u=0;const S=new Map;for(const[c,P]of _o(o))P.resource&&(S.has(P.resource)||S.set(P.resource,[]),S.get(P.resource).push(P));for(const c of t){let P=[];const E=S.get(c.id)||[];for(const a of E)a.parentId||a.type!=="project"&&n?.has(a.id)&&a._children?.length>0&&P.push(a);if(P.length>0){let a=0;for(const l of P)a+=Ee(l,e,o);E.filter(l=>!l.parentId&&l.type!=="project"&&!n?.has(l.id)).length}const R=new Map,C=u+r/2,y=[...E].filter(a=>!a.parentId).sort((a,l)=>a.type==="project"&&l.type!=="project"?-1:l.type==="project"&&a.type!=="project"?1:(a._start||0)-(l._start||0)),i=[],v=(a,l)=>{const M=a._start??a.$bar?.x??0,W=a._end??a.$bar?.x+a.$bar?.width??M+1;for(const Y of l.occupiedRanges)if(!(W<=Y.start||M>=Y.end))return!0;return!1},k=(a,l)=>{const M=a._start??a.$bar?.x??0,W=a._end??a.$bar?.x+a.$bar?.width??M+1;for(const K of i)if(!v(a,K))return K.occupiedRanges.push({start:M,end:W}),K.height=Math.max(K.height,l),K.y;const Y=i.length===0?C:i[i.length-1].y+i[i.length-1].height;return i.push({y:Y,height:l,occupiedRanges:[{start:M,end:W}]}),Y};for(const a of y){const l=n?.has(a.id)&&a._children?.length>0;let M,W;if(l){M=Ee(a,e,o);const Y=a.subtaskLayout||"sequential",K=Y==="sequential"?s:M;W=k(a,Y==="sequential"?f:M),R.set(a.id,{y:W,height:K,x:a.$bar?.x,width:a.$bar?.width,isExpanded:l});const ut=s*h,p=r*.4;if(a._children){const O=Y==="mixed"||Y==="parallel"?Xe(a._children,o):null,b=(s-ut)/2;a._children.forEach((x,H)=>{ze(o,x);let $;if(Y==="sequential")$=W+b;else{const V=O?.get(x)??H;$=W+b+V*(ut+p)}R.set(x,{y:$,height:ut,isSubtask:!0})})}}else a.type==="project"?(M=s*.6,W=k(a,M),R.set(a.id,{y:W,height:M,isExpanded:!1})):(M=f,W=k(a,M),R.set(a.id,{y:W,height:s,isExpanded:!1}))}let _=C;for(const a of i)_=Math.max(_,a.y+a.height);const U=Math.max(f,_-u);w.set(c.id,{y:u,height:U,contentY:u+r/2,contentHeight:U-r,type:c.type,expandedTasks:P.map(a=>a.id),taskPositions:R}),u+=U}return w.set("__total__",{height:u}),w}function Ee(t,e,n){const{barHeight:o=30,padding:s=18,subtaskHeightRatio:r=.5}=e,h=o*r,f=s*.4,w=t._children||[];if(w.length===0)return o+s;const u=t.subtaskLayout||"sequential";if(u==="sequential")return o+s;if(u==="parallel"){const S=(o-h)/2,c=w.length;return S*2+c*h+(c-1)*f}return u==="mixed"?Ho(t,e,n):o+s}function Xe(t,e){const n=new Map;if(!t?.length||!e)return n;const o=t.map(r=>ze(e,r)).filter(r=>r!=null).sort((r,h)=>r.order!==void 0&&h.order!==void 0?r.order-h.order:(r._start||0)-(h._start||0)),s=[];for(const r of o){const h=r._start??r.$bar?.x??0,f=r._end??r.$bar?.x+r.$bar?.width??h+1;let w=-1;for(let u=0;u<s.length;u++)if(!s[u].some(c=>!(f<=c.start||h>=c.end))){w=u,s[u].push({start:h,end:f});break}w===-1&&(w=s.length,s.push([{start:h,end:f}])),n.set(r.id,w)}return n}function Ho(t,e,n){const{barHeight:o=30,padding:s=18,subtaskHeightRatio:r=.5}=e,h=o*r,f=s*.4,w=t._children||[];if(w.length===0)return o+s;const u=Xe(w,n),c=Math.max(0,...u.values())+1;return(o-h)/2*2+c*h+(c-1)*f}function Fe(t,e){if(t.length===0)return-1;if(e<0)return 0;let n=0,o=t.length-1;for(;n<=o;){const s=Math.floor((n+o)/2),r=t[s];if(e>=r.y&&e<r.y+r.height)return s;e<r.y?o=s-1:n=s+1}return Math.min(n,t.length-1)}function Ro(t){const e=[];for(const[n,o]of t)n!=="__total__"&&e.push({id:n,...o});return e.sort((n,o)=>n.y-o.y),e}function Po(t,e){const{barHeight:n=30,padding:o=18}=e,s=n+o,r=new Map;for(let h=0;h<t.length;h++){const f=t[h],w=h*s;r.set(f.id,{y:w,height:s,contentY:w+o/2,contentHeight:n,type:f.type})}return r.set("__total__",{height:t.length*s}),r}const Zt=(t,e)=>t?.start===e?.start&&t?.end===e?.end;function $o(t){const{scrollX:e,scrollY:n,viewportWidth:o,viewportHeight:s,columnWidth:r,rowHeight:h,totalRows:f,sortedRowLayouts:w,overscanCols:u=5,overscanRows:S=20,overscanX:c=2500}=t,P=F(()=>{const i=r(),v=e(),k=o();return i<=0||k<=0?{start:0,end:100}:{start:Math.max(0,Math.floor(v/i)-u),end:Math.ceil((v+k)/i)+u}},void 0,{equals:Zt}),E=F(()=>{const i=n(),v=s(),k=f();if(v<=0)return{start:0,end:Math.min(k,30)};const _=w?.();if(_&&_.length>0){const a=Math.max(0,Fe(_,i)-S),l=Math.min(k,Fe(_,i+v)+1+S);return{start:a,end:l}}const U=h();return U<=0?{start:0,end:Math.min(k,30)}:{start:Math.max(0,Math.floor(i/U)-S),end:Math.min(k,Math.ceil((i+v)/U)+S)}},void 0,{equals:Zt}),R=100,C=F(()=>{const i=e(),v=o();return{start:Math.max(0,Math.floor((i-c)/R)*R),end:Math.ceil((i+v+c)/R)*R}},void 0,{equals:Zt}),y=F(()=>{const i=n(),v=s(),k=h?.()||48,_=S*k;return{start:Math.max(0,i-_),end:i+v+_}},void 0,{equals:Zt});return{colRange:P,rowRange:E,xRange:C,yRange:y}}function Io(t){const e=new Map;for(const s of t)s._children=[],s._depth=0,e.set(s.id,s);for(const s of t)if(s.parentId){const r=e.get(s.parentId);r&&(r._children.push(s.id),r.type||(r.type="summary"))}const n=t.filter(s=>!s.parentId),o=n.map(s=>({task:s,depth:0}));for(;o.length>0;){const{task:s,depth:r}=o.shift();s._depth=r;for(const h of s._children){const f=e.get(h);f&&o.push({task:f,depth:r+1})}}for(const s of t)s.parentId&&s._depth===0&&!n.includes(s)&&(console.warn(`Circular or orphaned parent reference detected for task ${s.id}`),s._depth=0);return e}function Eo(t,e){const n=new Set,o=[t],s=e.get?r=>e.get(r):r=>e[r];for(;o.length>0;){const r=o.shift(),h=s(r);for(const f of h?._children||[])n.has(f)||(n.add(f),o.push(f))}return n}function Fo(t,e,n){const o=e.get?r=>e.get(r):r=>e[r];let s=o(t);for(;s?.parentId;){if(n.has(s.parentId))return!0;s=o(s.parentId)}return!1}var Ao=Dt('<div style=position:absolute><div class=bar style=position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box></div><div class=bar-expected-progress style=position:absolute;top:0;left:0;height:100%></div><div class=bar-progress style=position:absolute;top:0;left:0;height:100%;opacity:0.3></div><div style=position:absolute;top:50%;white-space:nowrap;pointer-events:none;font-size:12px></div><div style=position:absolute;top:2px;right:4px;font-size:10px;pointer-events:none>ðŸ”’</div><div class="handle handle-left"style="position:absolute;left:-2px;top:25%;width:4px;height:50%;border-radius:1px;background-color:var(--g-handle-color, #ddd);cursor:ew-resize;opacity:0"></div><div class="handle handle-right"style="position:absolute;right:-2px;top:25%;width:4px;height:50%;border-radius:1px;background-color:var(--g-handle-color, #ddd);cursor:ew-resize;opacity:0"></div><div class="handle handle-progress"style="position:absolute;top:50%;transform:translateY(-50%);width:10px;height:10px;border-radius:50%;background-color:var(--g-progress-handle-color, #fff);cursor:ew-resize;opacity:0;box-sizing:border-box">');function Lo(t){const e=qn(),n=()=>{const T=t.task;return typeof T=="function"?T():T},o=()=>n()?.$bar??{x:t.x??0,y:t.y??0,width:t.width??100,height:t.height??30},s=F(()=>t.ganttConfig?.barCornerRadius?.()??t.cornerRadius??3),r=F(()=>t.ganttConfig?.readonly?.()??t.readonly??!1),h=F(()=>t.ganttConfig?.readonlyDates?.()??t.readonlyDates??!1),f=F(()=>t.ganttConfig?.readonlyProgress?.()??t.readonlyProgress??!1),w=F(()=>t.ganttConfig?.showExpectedProgress?.()??t.showExpectedProgress??!1),u=F(()=>t.ganttConfig?.columnWidth?.()??t.columnWidth??45),S=F(()=>t.ganttConfig?.ignoredPositions?.()??t.ignoredPositions??[]),c=F(()=>{const T=n();return T?{id:T.id??"",name:T.name??"",color:T.color??"#b8c2cc",colorProgress:T.color_progress??"#a3a3ff",progress:T.progress??0,locked:T.constraints?.locked??!1,invalid:T.invalid??!1,customClass:T.custom_class??"",hasChildren:(T._children?.length??0)>0,start:T._start??T.start??null,end:T._end??T.end??null}:{id:"",name:"",color:"#b8c2cc",colorProgress:"#a3a3ff",progress:0,locked:!1,invalid:!1,customClass:"",hasChildren:!1,start:null,end:null}}),P=F(()=>o()),E=()=>P()?.x??0,R=()=>(typeof t.taskPosition=="function"?t.taskPosition():t.taskPosition)?.y??P()?.y??0,C=()=>P()?.width??100,y=()=>P()?.height??30,i=()=>u();let v=!1;const{dragState:k,isDragging:_,startDrag:U}=Be({onDragStart:(T,q)=>{if(v=!1,T.originalX=E(),T.originalY=R(),T.originalWidth=C(),T.originalProgress=c().progress,t.taskStore?.setDraggingTaskId?.(c().id),q==="dragging_bar"){const m=new Set;if(t.onCollectDependents){const tt=t.onCollectDependents(c().id);for(const et of tt)m.add(et)}if(t.onCollectDescendants){const tt=t.onCollectDescendants(c().id);for(const et of tt)m.add(et)}T.dependentOriginals=new Map;for(const tt of m){const et=t.taskStore?.getBarPosition(tt);et&&T.dependentOriginals.set(tt,{originalX:et.x})}}},onDragMove:(T,q,m)=>{if(!t.taskStore||!c().id)return;v=!0;const tt=u(),et=S();if(m==="dragging_bar"){let dt=me(q.originalX+T.deltaX,tt,et),gt=dt-q.originalX;if(q.dependentOriginals?.size>0&&t.taskStore.batchMovePositions)t.onClampBatchDelta&&gt<0&&(gt=t.onClampBatchDelta(q.dependentOriginals,gt)),t.taskStore.batchMovePositions(q.dependentOriginals,gt);else{if(t.onConstrainPosition){const it=t.onConstrainPosition(c().id,dt,R());if(it===null)return;dt=it.x??dt}t.taskStore.updateBarPosition(c().id,{x:dt})}}else if(m==="dragging_left"){const dt=T.deltaX,gt=Math.round(dt/tt)*tt;let it=q.originalX+gt,L=q.originalWidth-gt;if(L<i()&&(L=i(),it=q.originalX+q.originalWidth-i()),it=me(it,tt,et),t.onConstrainPosition){const D=t.onConstrainPosition(c().id,it,R());if(D===null)return;D.x>it&&(L=L-(D.x-it),it=D.x)}t.taskStore.updateBarPosition(c().id,{x:it,width:L})}else if(m==="dragging_right"){const dt=T.deltaX,gt=Math.round(dt/tt)*tt;let it=q.originalWidth+gt;it=Math.max(i(),it),t.taskStore.updateBarPosition(c().id,{width:it})}else if(m==="dragging_progress"){const dt=E(),gt=C(),it=S(),L=u();let D=Re(q.startSvgX+T.deltaX,dt,dt+gt);const Rt=it.reduce((B,Z)=>B+(Z>=dt&&Z<dt+gt?1:0),0),j=gt-Rt*L,ht=D-dt,pt=it.reduce((B,Z)=>B+(Z>=dt&&Z<D?1:0),0),ct=ht-pt*L,d=j>0?Re(Math.round(ct/j*100),0,100):0;if(t.taskStore){const B=t.taskStore.getTask(c().id);B&&t.taskStore.updateTask(c().id,{...B,progress:d})}}},onDragEnd:(T,q,m)=>{t.taskStore?.setDraggingTaskId?.(null);const tt=t.onDateChange??e.onDateChange,et=t.onResizeEnd??e.onResizeEnd,dt=t.onProgressChange??e.onProgressChange;if(m==="dragging_bar"||m==="dragging_left"||m==="dragging_right"){const gt=t.taskStore?.getBarPosition(c().id);tt?.(c().id,{x:gt?.x??E(),width:gt?.width??C()}),(m==="dragging_left"||m==="dragging_right")&&et?.(c().id)}else m==="dragging_progress"&&dt?.(c().id,c().progress)}}),a=T=>{if(r()||h()||X())return;const q=T.target;q.classList&&q.classList.contains("handle")||(v=!1,U(T,"dragging_bar",{taskId:c().id}))},l=T=>{const q=t.onHover??e.onHover;q&&!_()&&q(c().id,T.clientX,T.clientY)},M=()=>{const T=t.onHoverEnd??e.onHoverEnd;T&&T()},W=T=>{const q=t.onTaskClick??e.onTaskClick;!v&&q&&(T.stopPropagation(),q(c().id,T))},Y=T=>{r()||h()||X()||(T.stopPropagation(),U(T,"dragging_left",{taskId:c().id}))},K=T=>{r()||h()||X()||(T.stopPropagation(),U(T,"dragging_right",{taskId:c().id}))},lt=T=>{r()||f()||X()||(T.stopPropagation(),U(T,"dragging_progress",{taskId:c().id}))},ut=F(()=>Ie(E(),C(),c().progress,S(),u())),p=F(()=>{if(!w())return 0;const T=c().start,q=c().end;if(!T||!q)return 0;const m=bo(T,q,t.ganttConfig?.unit?.()??"day",t.ganttConfig?.step?.()??1);return Ie(E(),C(),m,S(),u())}),O=F(()=>Ye(E(),C(),c().name)),b=()=>c().color,x=()=>c().colorProgress,H=()=>"var(--g-expected-progress-color, rgba(0,0,0,0.2))",$=()=>c().hasChildren,V=()=>c().invalid,G=()=>c().customClass,J=()=>!r(),nt=()=>J()&&!h(),A=()=>J()&&!f(),X=()=>c().locked,st=()=>_()?`dragging ${k()}`:"",ft=()=>X()?"#7f8c8d":_()?"#2c3e50":b(),vt=()=>X()||_()?1:$()?0:.1;Mt(()=>{const T=c().id,q=ft(),m=vt();T==="task-0"&&console.log("[Bar task-0]",{bg:q,op:m,locked:X(),dragging:_(),hasSubtasks:$()})});const bt=()=>t.visible??!0,St=()=>`translate(${E()}px, ${R()}px)`;return(()=>{var T=Ao(),q=T.firstChild,m=q.nextSibling,tt=m.nextSibling,et=tt.nextSibling,dt=et.nextSibling,gt=dt.nextSibling,it=gt.nextSibling,L=it.nextSibling;return T.$$click=W,T.addEventListener("mouseleave",M),T.addEventListener("mouseenter",l),T.$$mousedown=a,at(et,()=>c().name),gt.$$mousedown=Y,it.$$mousedown=K,L.$$mousedown=lt,xt(D=>{var Rt=`bar-wrapper ${G()} ${V()?"invalid":""} ${X()?"locked":""} ${st()}`,j=c().id,ht=St(),pt=`${C()}px`,ct=`${y()}px`,d=X()?"not-allowed":r()?"default":"move",B=bt()?"visible":"hidden",Z=`${s()}px`,ot=X()?"#7f8c8d":_()?"#2c3e50":b(),kt=X()||_()?1:$()?0:.1,Ct=`${X()?"2px":"1.5px"} solid ${X()?"#c0392b":b()}`,Tt=X()?"dashed":"solid",Pt=_()?"none":"background-color 0.1s ease",Ht=`${p()}px`,$t=`${s()}px`,yt=H(),Bt=w()&&p()>0?"block":"none",It=`${ut()}px`,Wt=`${s()}px`,Et=x(),Ut=`bar-label ${O().position}`,Ft=O().position==="inside"?"50%":`${C()+5}px`,Yt=O().position==="inside"?"translate(-50%, -50%)":"translateY(-50%)",At=O().position==="inside"?"#fff":"#333",Gt=X()?"block":"none",Lt=J()&&!X()&&nt()?"block":"none",zt=J()&&!X()&&nt()?"block":"none",Xt=`${ut()-5}px`,Vt=`2px solid ${x()}`,qt=J()&&!X()&&A()&&ut()>0?"block":"none";return Rt!==D.e&&ue(T,D.e=Rt),j!==D.t&&rt(T,"data-id",D.t=j),ht!==D.a&&z(T,"transform",D.a=ht),pt!==D.o&&z(T,"width",D.o=pt),ct!==D.i&&z(T,"height",D.i=ct),d!==D.n&&z(T,"cursor",D.n=d),B!==D.s&&z(T,"visibility",D.s=B),Z!==D.h&&z(q,"border-radius",D.h=Z),ot!==D.r&&z(q,"background-color",D.r=ot),kt!==D.d&&z(q,"opacity",D.d=kt),Ct!==D.l&&z(q,"border",D.l=Ct),Tt!==D.u&&z(q,"border-style",D.u=Tt),Pt!==D.c&&z(q,"transition",D.c=Pt),Ht!==D.w&&z(m,"width",D.w=Ht),$t!==D.m&&z(m,"border-radius",D.m=$t),yt!==D.f&&z(m,"background-color",D.f=yt),Bt!==D.y&&z(m,"display",D.y=Bt),It!==D.g&&z(tt,"width",D.g=It),Wt!==D.p&&z(tt,"border-radius",D.p=Wt),Et!==D.b&&z(tt,"background-color",D.b=Et),Ut!==D.T&&ue(et,D.T=Ut),Ft!==D.A&&z(et,"left",D.A=Ft),Yt!==D.O&&z(et,"transform",D.O=Yt),At!==D.I&&z(et,"color",D.I=At),Gt!==D.S&&z(dt,"display",D.S=Gt),Lt!==D.W&&z(gt,"display",D.W=Lt),zt!==D.C&&z(it,"display",D.C=zt),Xt!==D.B&&z(L,"left",D.B=Xt),Vt!==D.v&&z(L,"border",D.v=Vt),qt!==D.k&&z(L,"display",D.k=qt),D},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0,T:void 0,A:void 0,O:void 0,I:void 0,S:void 0,W:void 0,C:void 0,B:void 0,v:void 0,k:void 0}),T})()}pe(["mousedown","click"]);var Bo=Dt("<div data-type=summary style=position:absolute;will-change:transform;pointer-events:auto><div class=bar style=position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box></div><div class=bar-progress style=position:absolute;top:0;left:0;height:100%;pointer-events:none></div><div class=bar-label style=position:absolute;top:50%;font-size:12px;font-weight:500;pointer-events:none;user-select:none;white-space:nowrap></div><div style=position:absolute;top:50%;transform:translateY(-50%);font-size:10px;color:#888;pointer-events:none;white-space:nowrap>(<!>)");function Wo(t){const e=()=>{const l=t.taskId;return typeof l=="function"?l():l},n=()=>{const l=e();if(t.taskStore&&l){const M=t.taskStore.tasks[l];if(M?.$bar)return M.$bar}return{x:0,y:0,width:100,height:30}},o=()=>{const l=e();return t.taskStore&&l?t.taskStore.tasks[l]??{}:{}},s=F(()=>n()),r=()=>s()?.x??0,h=()=>(typeof t.taskPosition=="function"?t.taskPosition():t.taskPosition)?.y??s()?.y??0,f=()=>s()?.width??100,w=()=>s()?.height??30,u=F(()=>t.ganttConfig?.columnWidth?.()??45),S=F(()=>t.ganttConfig?.readonly?.()??!1),c=F(()=>t.ganttConfig?.barCornerRadius?.()??3),P=()=>o()?.color??"var(--g-bar-color, #b8c2cc)",E=()=>o()?.color_progress??"var(--g-bar-progress-color, #a3a3ff)",R=()=>o()?.progress??0,C=()=>f()*R()/100,y=F(()=>{const l=o()?.name??"";return Ye(r(),f(),l,7)}),{dragState:i,isDragging:v,startDrag:k}=Be({onDragStart:(l,M)=>{if(l.originalX=r(),l.originalY=h(),M==="dragging_bar"&&t.onCollectDescendants){const W=t.onCollectDescendants(e());W.add(e()),l.batchOriginals=new Map;for(const Y of W){const K=t.taskStore?.getBarPosition(Y);K&&l.batchOriginals.set(Y,{originalX:K.x})}}},onDragMove:(l,M,W)=>{if(!t.taskStore||!e()||W!=="dragging_bar")return;const Y=u();let lt=me(M.originalX+l.deltaX,Y,[])-M.originalX;M.batchOriginals?.size>0&&t.taskStore.batchMovePositions&&(t.onClampBatchDelta&&lt<0&&(lt=t.onClampBatchDelta(M.batchOriginals,lt)),t.taskStore.batchMovePositions(M.batchOriginals,lt))},onDragEnd:(l,M)=>{M==="dragging_bar"&&t.onDragEnd?.(e())}}),_=()=>{const l=i();return l==="idle"?"":`dragging ${l}`},U=l=>{S()||(l.preventDefault(),l.stopPropagation(),k(l,"dragging_bar"))},a=()=>`translate(${r()}px, ${h()}px)`;return(()=>{var l=Bo(),M=l.firstChild,W=M.nextSibling,Y=W.nextSibling,K=Y.nextSibling,lt=K.firstChild,ut=lt.nextSibling;return ut.nextSibling,l.$$mousedown=U,at(Y,()=>o()?.name??""),at(K,()=>o()?._children?.length??0,ut),xt(p=>{var O=`summary-bar-wrapper bar-wrapper ${_()}`,b=e(),x=a(),H=`${f()}px`,$=`${w()}px`,V=S()?"default":"grab",G=`${c()}px`,J=v()?"#2c3e50":P(),nt=v()?"none":"background-color 0.1s ease",A=`${C()}px`,X=`${c()}px`,st=E(),ft=R()>0?"block":"none",vt=y().position==="inside"?"50%":`${f()+8}px`,bt=y().position==="inside"?"translate(-50%, -50%)":"translateY(-50%)",St=y().position==="inside"?"#fff":"#333",T=`${f()+8+(o()?.name?.length??0)*7}px`,q=o()?._children?.length>0?"block":"none";return O!==p.e&&ue(l,p.e=O),b!==p.t&&rt(l,"data-id",p.t=b),x!==p.a&&z(l,"transform",p.a=x),H!==p.o&&z(l,"width",p.o=H),$!==p.i&&z(l,"height",p.i=$),V!==p.n&&z(l,"cursor",p.n=V),G!==p.s&&z(M,"border-radius",p.s=G),J!==p.h&&z(M,"background-color",p.h=J),nt!==p.r&&z(M,"transition",p.r=nt),A!==p.d&&z(W,"width",p.d=A),X!==p.l&&z(W,"border-radius",p.l=X),st!==p.u&&z(W,"background-color",p.u=st),ft!==p.c&&z(W,"display",p.c=ft),vt!==p.w&&z(Y,"left",p.w=vt),bt!==p.m&&z(Y,"transform",p.m=bt),St!==p.f&&z(Y,"color",p.f=St),T!==p.y&&z(K,"left",p.y=T),q!==p.g&&z(K,"display",p.g=q),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0}),l})()}pe(["mousedown"]);var Yo=Dt("<svg><rect class=subtask-bar-progress fill-opacity=0.3 style=pointer-events:none></svg>",!1,!0,!1),zo=Dt("<svg><g class=subtask-bar><rect class=subtask-bar-bg fill-opacity=0.1 stroke-width=1.5></rect><text class=subtask-label font-size=10 fill=#333 text-anchor=middle dominant-baseline=middle style=pointer-events:none;user-select:none></svg>",!1,!0,!1);function Xo(t){const e=()=>t.task,n=()=>e()?.$bar||{x:0,width:100},o=()=>n().x,s=()=>n().width,r=()=>t.y??0,h=()=>t.config||{},f=()=>h().barHeight??30,w=()=>h().subtaskHeightRatio??.5,u=()=>(h().cornerRadius??3)*.7,S=()=>f()*w(),c=()=>e()?.color??h().parentColor??"var(--g-bar-color, #b8c2cc)",P=()=>e()?.color_progress??c(),E=()=>e()?.progress??0,R=()=>{const y=s(),i=E();return Math.max(0,y*i/100)},C=()=>o()+s()/2;return(()=>{var y=zo(),i=y.firstChild,v=i.nextSibling;return at(y,mt(jn,{get when(){return E()>0},get children(){var k=Yo();return xt(_=>{var U=o(),a=r(),l=R(),M=S(),W=u(),Y=u(),K=P();return U!==_.e&&rt(k,"x",_.e=U),a!==_.t&&rt(k,"y",_.t=a),l!==_.a&&rt(k,"width",_.a=l),M!==_.o&&rt(k,"height",_.o=M),W!==_.i&&rt(k,"rx",_.i=W),Y!==_.n&&rt(k,"ry",_.n=Y),K!==_.s&&rt(k,"fill",_.s=K),_},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),k}}),v),at(v,()=>e()?.name??""),xt(k=>{var _=e()?.id,U=t.index,a=o(),l=r(),M=s(),W=S(),Y=u(),K=u(),lt=c(),ut=c(),p=C(),O=r()+S()/2;return _!==k.e&&rt(y,"data-id",k.e=_),U!==k.t&&rt(y,"data-index",k.t=U),a!==k.a&&rt(i,"x",k.a=a),l!==k.o&&rt(i,"y",k.o=l),M!==k.i&&rt(i,"width",k.i=M),W!==k.n&&rt(i,"height",k.n=W),Y!==k.s&&rt(i,"rx",k.s=Y),K!==k.h&&rt(i,"ry",k.h=K),lt!==k.r&&rt(i,"fill",k.r=lt),ut!==k.d&&rt(i,"stroke",k.d=ut),p!==k.l&&rt(v,"x",k.l=p),O!==k.u&&rt(v,"y",k.u=O),k},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0}),y})()}var Vo=Dt("<svg><g class=expanded-task-container><rect class=parent-container fill=none stroke-width=2 stroke-opacity=0.6 stroke-dasharray=6,3></rect><g class=subtasks></svg>",!1,!0,!1);function qo(t){const e=()=>t.taskStore?.tasks[t.taskId],n=()=>{const R=e();if(!R?._children?.length)return[];const C=t.taskStore?.tasks;return C?R._children.map(y=>C[y]).filter(y=>y!=null):[]},o=()=>e()?.subtaskLayout||"sequential",s=()=>t.ganttConfig?.barHeight?.()??30,r=()=>t.ganttConfig?.padding?.()??18,h=()=>t.ganttConfig?.subtaskHeightRatio?.()??.5,f=()=>t.ganttConfig?.barCornerRadius?.()??3,w=()=>e()?.$bar||{x:0,y:0,width:100,height:30},u=()=>{const R=t.rowLayout,C=R?.taskPositions?.get(t.taskId);return C?.y!==void 0?C.y:R?R.y:w().y-r()/2},S=()=>{const C=t.rowLayout?.taskPositions?.get(t.taskId);if(C?.height!==void 0)return C.height;if(o()==="sequential")return s();const y=s()*h(),i=r()*.4,v=n().length;return(s()-y)/2*2+v*y+(v-1)*i},c=()=>e()?.color??"var(--g-bar-color, #b8c2cc)",P=()=>({barHeight:s(),padding:r(),subtaskHeightRatio:h(),cornerRadius:f(),parentColor:c()}),E=(R,C)=>{const i=t.rowLayout?.taskPositions?.get(C?.id);if(i?.y!==void 0)return i.y;const v=s()*h(),k=r()*.4,_=(s()-v)/2;return o()==="sequential"?u()+_:u()+_+R*(v+k)};return(()=>{var R=Vo(),C=R.firstChild,y=C.nextSibling;return at(y,mt(We,{get each(){return n()},children:(i,v)=>mt(Xo,{task:i,get index(){return v()},get y(){return E(v(),i)},get layout(){return o()},get config(){return P()},get ganttConfig(){return t.ganttConfig}})})),xt(i=>{var v=t.taskId,k=o(),_=w().x,U=u(),a=w().width,l=S(),M=c(),W=f(),Y=f();return v!==i.e&&rt(R,"data-id",i.e=v),k!==i.t&&rt(R,"data-layout",i.t=k),_!==i.a&&rt(C,"x",i.a=_),U!==i.o&&rt(C,"y",i.o=U),a!==i.i&&rt(C,"width",i.i=a),l!==i.n&&rt(C,"height",i.n=l),M!==i.s&&rt(C,"stroke",i.s=M),W!==i.h&&rt(C,"rx",i.h=W),Y!==i.r&&rt(C,"ry",i.r=Y),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),R})()}var jo=Dt('<div class=task-layer style="contain:layout style;position:relative;width:100%;height:100%"><div class=summary-layer style="contain:layout style"></div><div class=expanded-layer style="contain:layout style"></div><div class=task-bars-layer style="contain:layout style">'),Uo=Dt("<div>"),Go=Dt("<div style=pointer-events:auto>");const Ae=5;function No(t){const e=()=>t.relationships||[],n=F(()=>to(e())),o=(b,x,H)=>{if(!t.taskStore)return{x,y:H};const $=t.ganttConfig?.columnWidth?.()??45,G=t.taskStore.getBarPosition?.(b)?.width??100,J={getBarPosition:t.taskStore.getBarPosition?.bind(t.taskStore),getTask:t.taskStore.getTask?.bind(t.taskStore),relationships:e(),relationshipIndex:n(),pixelsPerHour:$},nt=Pe(b,x,G,J);if(nt.blocked)return null;if(nt.cascadeUpdates&&nt.cascadeUpdates.length>0)for(const[A,X]of nt.cascadeUpdates)t.taskStore.updateBarPosition(A,X);return{x:nt.constrainedX,y:H}},s=(b,x)=>{t.onDateChange?.(b,x)},r=(b,x)=>{t.onProgressChange?.(b,x)},h=b=>{if(t.taskStore){const x=t.ganttConfig?.columnWidth?.()??45,H=t.taskStore.getBarPosition?.(b);if(H){const $={getBarPosition:t.taskStore.getBarPosition?.bind(t.taskStore),getTask:t.taskStore.getTask?.bind(t.taskStore),relationships:e(),relationshipIndex:n(),pixelsPerHour:x},V=Pe(b,H.x,H.width,$);if(V.cascadeUpdates)for(const[G,J]of V.cascadeUpdates)t.taskStore.updateBarPosition(G,J)}}t.onResizeEnd?.(b)},f=(b,x,H)=>{t.onHover?.(b,x,H)},w=()=>{t.onHoverEnd?.()},u=(b,x)=>{t.onTaskClick?.(b,x)},S=b=>{const x=t.taskStore?.getTask?.bind(t.taskStore);return no(b,e(),x)},c=(b,x)=>{const H=t.taskStore?.getTask?.bind(t.taskStore),$=t.ganttConfig?.columnWidth?.()??45;return eo(b,x,e(),H,{pixelsPerTimeUnit:$})},P=b=>{if(!t.taskStore)return new Set;const x=t.taskStore.tasks;return Eo(b,x)},E=b=>{t.taskStore?.toggleTaskCollapse(b)},R=()=>t.resourceStore?.displayResources()||[],C=()=>t.startRow??0,y=()=>t.endRow??R().length,i=()=>t.startX??0,v=()=>t.endX??1/0;let k=null,_=-1;const U=()=>{const b=t.taskStore?.tasks;if(!b)return new Map;const x=_t(()=>Object.keys(b));if(x.length===_&&k)return k;_=x.length;const H=new Map;return _t(()=>{for(const $ of x){const V=b[$];if(!V||V._isHidden)continue;const G=V.resource||"Unassigned";H.has(G)||H.set(G,[]),H.get(G).push(V)}}),k=H,H},a=F(()=>{const b=[],x=R(),H=U(),$=C(),V=y(),G=i(),J=v();for(let nt=$;nt<V&&nt<x.length;nt++){const A=x[nt];if(A.type==="group")continue;const X=H.get(A.id);X&&_t(()=>{if(J===1/0)for(let st=0;st<X.length;st++)b.push(X[st].id);else for(let st=0;st<X.length;st++){const ft=X[st],vt=ft.$bar;(!vt||vt.x+vt.width>=G-200&&vt.x<=J+200)&&b.push(ft.id)}})}return b}),l=b=>t.ganttConfig?.isTaskExpanded?.(b)??!1,M=()=>t.ganttConfig?.renderMode?.()==="simple",W=F(()=>{const b=M(),x=a();return _t(()=>{const H=[],$=[],V=[],G=t.taskStore?.tasks??{},J=new Map,nt=A=>(J.has(A)||J.set(A,l(A)),J.get(A));for(const A of x){const X=G[A];if(!X)continue;const st=X.parentId,ft=X.type,vt=X._children;if(b){if(st)continue;ft==="summary"||ft==="project"?$.push(A):H.push(A);continue}const bt=vt&&vt.length>0,St=nt(A);bt&&St?V.push(A):ft==="summary"||ft==="project"?$.push(A):(!st||!nt(st))&&H.push(A)}return{regularIds:H,summaryIds:$,expandedIds:V}})});let Y=0,K=0;const lt=F(()=>{const b=W().regularIds;Y=Math.max(Y,b.length);const x=Y+Ae,H=new Array(x);for(let $=0;$<b.length;$++)H[$]=b[$];return H}),ut=F(()=>{const b=lt(),x=t.taskStore?.tasks??{};return _t(()=>b.map(H=>H?x[H]:void 0))}),p=F(()=>{const b=W().summaryIds;K=Math.max(K,b.length);const x=K+Ae,H=new Array(x);for(let $=0;$<b.length;$++)H[$]=b[$];return H}),O=b=>{const x=t.rowLayouts;if(!x)return null;const H=t.taskStore?.getTask?.(b);if(!H)return null;const $=x.get(H.resource);if(!$)return null;if(M())return{...$,y:$.contentY,height:$.contentHeight,isExpanded:!1};const V=$.taskPositions?.get(b);return V?{...$,y:V.y,height:V.height,isExpanded:V.isExpanded}:$};return(()=>{var b=jo(),x=b.firstChild,H=x.nextSibling,$=H.nextSibling;return at(x,mt(ge,{get each(){return p()},children:V=>(()=>{var G=Uo();return at(G,mt(Wo,{taskId:V,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},onCollectDescendants:P,onClampBatchDelta:c,onToggleCollapse:E,onDragEnd:h})),xt(J=>z(G,"display",V()?"block":"none")),G})()})),at(H,mt(We,{get each(){return W().expandedIds},children:V=>mt(qo,{taskId:V,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},get rowLayout(){return O(V)}})})),at($,mt(ge,{get each(){return ut()},children:V=>(()=>{var G=Go();return at(G,mt(Lo,{task:V,get taskStore(){return t.taskStore},get ganttConfig(){return t.ganttConfig},onConstrainPosition:o,onCollectDependents:S,onCollectDescendants:P,onClampBatchDelta:c,onDateChange:s,onProgressChange:r,onResizeEnd:h,onHover:f,onHoverEnd:w,onTaskClick:u})),xt(J=>z(G,"display",V()?"block":"none")),G})()})),b})()}var Oo=Dt("<div style=position:absolute><div style=position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.15;border-radius:3px></div><div style=position:absolute;top:0;left:0;height:100%;background-color:#a3a3ff;opacity:0.3;border-radius:3px></div><div style=position:absolute;top:50%;left:8px;transform:translateY(-50%);color:#fff;font-size:12px;white-space:nowrap></div><div style=position:absolute;bottom:2px;right:4px;font-size:9px;color:#888>");function Jo(t){const e=()=>typeof t.task=="function"?t.task():t.task,n=F(()=>{const o=e(),s=o?.progress??0,r=o?.$bar?.width??100;return{color:o?.color??"#3b82f6",progress:s,name:o?.name??"",pw:r*s/100,id:o?.id??"",x:o?.$bar?.x??0,y:o?.$bar?.y??0,width:r,height:o?.$bar?.height??30}});return(()=>{var o=Oo(),s=o.firstChild,r=s.nextSibling,h=r.nextSibling,f=h.nextSibling;return at(h,()=>n().name),at(f,()=>n().id),xt(w=>{var u=`translate(${n().x}px, ${n().y}px)`,S=`${n().width}px`,c=`${n().height}px`,P=n().color,E=`${n().pw}px`;return u!==w.e&&z(o,"transform",w.e=u),S!==w.t&&z(o,"width",w.t=S),c!==w.a&&z(o,"height",w.a=c),P!==w.o&&z(s,"background-color",w.o=P),E!==w.i&&z(r,"width",w.i=E),w},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),o})()}var Ko=Dt('<div class=task-layer-minimal style="contain:layout style;position:relative;width:100%;height:100%">');function Qo(t){const e=()=>t.resourceStore?.displayResources()||[],n=()=>t.startRow??0,o=()=>t.endRow??50,s=()=>t.startX??0,r=()=>t.endX??1/0;let h=null,f=-1;const w=()=>{const S=t.taskStore?.tasks;if(!S)return new Map;const c=_t(()=>Object.keys(S));if(c.length===f&&h)return h;f=c.length;const P=new Map;return _t(()=>{for(const E of c){const R=S[E];if(!R||R._isHidden)continue;const C=R.resource||"Unassigned";P.has(C)||P.set(C,[]),P.get(C).push(R)}}),h=P,P},u=F(()=>{const S=[],c=e(),P=w(),E=n(),R=o(),C=s(),y=r();for(let i=E;i<R&&i<c.length;i++){const v=c[i];if(v.type==="group")continue;const k=P.get(v.id);k&&_t(()=>{if(y===1/0)for(let _=0;_<k.length;_++)S.push(k[_]);else for(let _=0;_<k.length;_++){const U=k[_],a=U.$bar;(!a||a.x+a.width>=C-200&&a.x<=y+200)&&S.push(U)}})}return S});return(()=>{var S=Ko();return at(S,mt(ge,{get each(){return u()},children:c=>mt(Jo,{task:c})})),S})()}function Zo(t){const e=io(),n=lo(t.options||{}),o=uo(t.options||{}),s=ho(t.resources||[]);typeof window<"u"&&(window.__ganttTaskStore=e,window.__ganttConfig=n,window.__ganttDateStore=o);const[r,h]=I(null),[f,w]=I(0),[u,S]=I(0),[c,P]=I(0),[E,R]=I(0),[C,y]=I(!1);let i=null;const[v,k]=I([]),[_,U]=I([]),[a,l]=I(null),[M,W]=I({x:0,y:0}),[Y,K]=I(!1),[lt,ut]=I(null),[p,O]=I(!1),b=F(()=>{const d=a();return d?e.getTask(d):null}),x=F(()=>{const d=a();return d?e.getBarPosition(d):null}),H=F(()=>{const d=lt();return d?e.getTask(d):null}),$=F(()=>{const d=lt();return d?e.getBarPosition(d):null}),V=F(()=>{const d=lt();return d?v().filter(B=>B.from===d||B.to===d):[]}),G=(d,B=!0)=>{if(!d||d.length===0){e.clear(),k([]),o.setupDates([]);return}Mo(d.map(yt=>({_start:yt._start||new Date(yt.start),_end:yt._end||new Date(yt.end||yt.start)}))),o.setupDates(d),n.setGanttStart(o.ganttStart()),n.setGanttEnd(o.ganttEnd()),n.setUnit(o.unit()),n.setStep(o.step()),n.setColumnWidth(o.columnWidth());const Z={ganttStart:o.ganttStart(),ganttEnd:o.ganttEnd(),unit:o.unit(),step:o.step(),columnWidth:o.columnWidth(),headerHeight:n.headerHeight(),barHeight:n.barHeight(),padding:n.padding()};let ot=null;const kt=s.resources().length>0;if(kt&&B)ot=s.resourceIndexMap();else if(!kt){const yt=fo(d);s.updateResources(yt),ot=s.resourceIndexMap()}const{tasks:Ct,relationships:Tt,resources:Pt}=To(d,Z,ot),Ht=Io(Ct);xo(Ht);const $t=e.collapsedTasks();for(const yt of Ht.values())Fo(yt.id,Ht,$t)&&(yt._isHidden=!0);e.updateTasks(Array.from(Ht.values())),k(Tt),U(Pt)};fe(()=>{G(t.tasks)}),Mt(()=>{const d=t.tasks;s.collapsedGroups(),e.collapsedTasks(),d&&d.length>0&&_t(()=>G(d))}),Mt(()=>{const d=t.options;d&&n.updateOptions(d)});const[J,nt]=I(t.options?.view_mode);Mt(()=>{const d=t.options?.view_mode,B=J();d&&d!==B&&(nt(d),o.changeViewMode(d),t.tasks&&t.tasks.length>0&&_t(()=>G(t.tasks)))});const A=F(()=>{const d=e.tasks;return d?Object.keys(d).length:0}),X=F(()=>{const d=s.displayCount();return d>0?d:_().length}),st=F(()=>o.gridWidth()),ft=F(()=>o.getAllDateInfos()),vt=F(()=>n.barHeight()+n.padding()),bt=F(()=>{const d=s.displayResources(),B=n.renderMode();if(!d||d.length===0)return new Map;const Z=d.map((Tt,Pt)=>({id:Tt.id,type:Tt.type||"resource",displayIndex:Pt,taskId:Tt.taskId})),ot={barHeight:n.barHeight(),padding:n.padding(),subtaskHeightRatio:n.subtaskHeightRatio()};if(B==="simple")return Po(Z,ot);const kt=n.expandedTasks(),Ct=e.tasks;return Do(Z,ot,kt,Ct)}),St=F(()=>Ro(bt()));Mt(()=>{const d=bt();!d||d.size===0||_t(()=>{for(const[B,Z]of d)if(B!=="__total__"&&Z.taskPositions)for(const[ot,kt]of Z.taskPositions){const Ct=e.tasks[ot];Ct&&Ct.$bar&&Ct.$bar.y!==kt.y&&e.updateBarPosition(ot,{y:kt.y})}})});const T=F(()=>{const B=bt().get("__total__");return B?B.height:(X()||A())*vt()}),q=F(()=>{const d=T();if(d>0)return d;const B=n.barHeight(),Z=n.padding();return(X()||A())*(B+Z)}),m=$o({scrollX:f,scrollY:u,viewportWidth:c,viewportHeight:E,columnWidth:()=>o.columnWidth(),rowHeight:vt,totalRows:()=>X()||A(),sortedRowLayouts:St,overscanCols:t.overscanCols??5,overscanRows:t.overscanRows??5,overscanX:t.overscanX??600}),tt=(d,B)=>{t.onDateChange?.(d,B)},et=(d,B)=>{t.onProgressChange?.(d,B)},dt=d=>{t.onResizeEnd?.(d)},gt=(d,B)=>{ut(d),O(!0),t.onTaskClick?.(d,B)},it=(d,B,Z)=>{l(d),W({x:B,y:Z}),K(!0)},L=()=>{K(!1),l(null)},D=()=>{O(!1),ut(null)},Rt=d=>{h(d),P(d.getContainerWidth()),R(d.getContainerHeight()),d.scrollLeftSignal&&d.scrollTopSignal?Mt(()=>{const ot=d.scrollLeftSignal(),kt=d.scrollTopSignal();Jn(()=>{w(ot),S(kt)})}):(d.scrollLeftSignal&&Mt(()=>w(d.scrollLeftSignal())),d.scrollTopSignal&&Mt(()=>S(d.scrollTopSignal())));let B=u(),Z=f();if(Mt(()=>{const ot=f(),kt=u();(ot!==Z||kt!==B)&&(Z=ot,B=kt,y(!0),clearTimeout(i),i=setTimeout(()=>{y(!1)},150))}),d.containerWidthSignal&&Mt(()=>P(d.containerWidthSignal())),d.containerHeightSignal&&Mt(()=>R(d.containerHeightSignal())),t.options?.scroll_to==="today"){const ot=o.dateToX(new Date);d.scrollTo(ot-d.getContainerWidth()/4,!1)}};let j=!1;Mt(()=>{const d=e.tasks,B=r(),Z=Object.keys(d);if(!j&&B&&t.options?.scroll_to==="start"&&d&&Z.length>0){const ot=d[Z[0]];ot?.$bar?.x&&(B.scrollTo(Math.max(0,ot.$bar.x-50),!1),j=!0)}});const ht=()=>t.options?.upper_header_height||45,pt=()=>t.options?.lower_header_height||30,ct=()=>t.options?.resource_column_width||120;return F(()=>({stroke:t.options?.arrow_color||"#666",curveRadius:t.options?.arrow_curve||5,headShape:t.options?.arrow_head_shape||"chevron",headSize:t.options?.arrow_head_size||5,...t.arrowConfig})),mt(On,{onDateChange:tt,onProgressChange:et,onResizeEnd:dt,onTaskClick:gt,onHover:it,onHoverEnd:L,get children(){return[mt(ro,{ganttConfig:n,get svgWidth(){return st()},get svgHeight(){return q()},get headerHeight(){return n.headerHeight()},get resourceColumnWidth(){return ct()},resourceHeaderLabel:"Resource",onContainerReady:Rt,get resourceColumn(){return mt(Nn,{resourceStore:s,ganttConfig:n,get width(){return ct()},get startRow(){return m.rowRange().start},get endRow(){return m.rowRange().end},get rowLayouts(){return bt()}})},get header(){return mt(Gn,{get dateInfos(){return ft()},get columnWidth(){return o.columnWidth()},get gridWidth(){return st()},get upperHeaderHeight(){return ht()},get lowerHeaderHeight(){return pt()},get startCol(){return m.colRange().start},get endCol(){return m.colRange().end}})},get barsLayer(){return he(()=>t.taskLayerMode==="minimal")()?mt(Qo,{taskStore:e,ganttConfig:n,resourceStore:s,get startRow(){return m.rowRange().start},get endRow(){return m.rowRange().end},get startX(){return m.xRange().start},get endX(){return m.xRange().end}}):mt(No,{taskStore:e,ganttConfig:n,get relationships(){return v()},resourceStore:s,onDateChange:tt,onProgressChange:et,onResizeEnd:dt,onTaskClick:gt,onHover:it,onHoverEnd:L,get startRow(){return m.rowRange().start},get endRow(){return m.rowRange().end},get startX(){return m.xRange().start},get endX(){return m.xRange().end},get rowLayouts(){return bt()}})},get children(){return mt(Un,{get width(){return st()},get height(){return q()},get barHeight(){return n.barHeight()},get padding(){return n.padding()},get taskCount(){return X()||A()},get columnWidth(){return o.columnWidth()},get dateInfos(){return ft()},get lines(){return t.options?.lines||"both"},get startRow(){return m.rowRange().start},get endRow(){return m.rowRange().end},resourceStore:s,get rowLayouts(){return bt()}})}}),mt(oo,{visible:Y,position:M,task:b,barPosition:x}),mt(so,{visible:p,task:H,barPosition:$,relationships:V,onClose:D})]}})}function ts(){let t=[],e=!1,n=null,o=null,s=0,r=!1;const h=typeof PerformanceObserver<"u"&&PerformanceObserver.supportedEntryTypes?.includes("long-animation-frame");function f(){n=new PerformanceObserver(C=>{for(const y of C.getEntries())t.push({timestamp:y.startTime,duration:y.duration,blockingDuration:y.blockingDuration||0,scripts:y.scripts?.map(i=>i.sourceURL||i.name)||[],source:"laf",renderStart:y.renderStart,styleAndLayoutStart:y.styleAndLayoutStart,firstUIEventTimestamp:y.firstUIEventTimestamp})}),n.observe({type:"long-animation-frame",buffered:!0}),r=!0}function w(){s=performance.now();function C(){if(!e)return;const y=performance.now(),i=y-s;i>4&&t.push({timestamp:s,duration:i,blockingDuration:i>16.67?i-16.67:0,scripts:[],source:"raf"}),s=y,o=requestAnimationFrame(C)}o=requestAnimationFrame(C),r=!1}function u(C={}){e||(t=[],e=!0,h&&!C.preferRAF?f():w())}function S(){e=!1,n&&(n.disconnect(),n=null),o&&(cancelAnimationFrame(o),o=null)}function c(){return[...t]}function P(){t=[]}function E(){if(t.length===0)return{frameCount:0,totalDuration:0,avgFrameTime:0,avgFPS:0,minFrameTime:0,maxFrameTime:0,worstFrame:null,droppedFrames:0,percentile95:0,percentile99:0,blockingTime:0,source:r?"laf":"raf"};const C=t.map(a=>a.duration).sort((a,l)=>a-l),y=C.reduce((a,l)=>a+l,0),i=t.reduce((a,l)=>a+l.blockingDuration,0),v=t.reduce((a,l)=>l.duration>a.duration?l:a,t[0]),k=t.filter(a=>a.duration>16.67).length,_=Math.floor(C.length*.95),U=Math.floor(C.length*.99);return{frameCount:t.length,totalDuration:y,avgFrameTime:y/t.length,avgFPS:1e3/(y/t.length),minFrameTime:C[0],maxFrameTime:C[C.length-1],worstFrame:{timestamp:v.timestamp,duration:v.duration,blockingDuration:v.blockingDuration,scripts:v.scripts},droppedFrames:k,droppedFramePercent:k/t.length*100,percentile95:C[_]||C[C.length-1],percentile99:C[U]||C[C.length-1],blockingTime:i,source:r?"laf":"raf"}}function R(C=100){if(t.length===0)return[];const y=[];let i=t[0].timestamp,v=[];for(const k of t){if(k.timestamp-i>=C){if(v.length>0){const U=v.reduce((a,l)=>a+l.duration,0)/v.length;y.push({time:i,fps:1e3/U,frameCount:v.length})}i=k.timestamp,v=[]}v.push(k)}if(v.length>0){const _=v.reduce((U,a)=>U+a.duration,0)/v.length;y.push({time:i,fps:1e3/_,frameCount:v.length})}return y}return{startTracking:u,stopTracking:S,getFrames:c,clear:P,analyze:E,getFPSTimeline:R,get isTracking(){return e},get hasLAF(){return h}}}const Ve=new Map;let be=[],ve=!1;function es(){ve=!0,be=[];function t(){ve&&(performance.now(),requestAnimationFrame(t))}requestAnimationFrame(t)}function ns(){ve=!1}function os(){Ve.clear(),be=[]}function ss(){return Array.from(Ve.values()).map(t=>({...t,minTime:t.minTime===1/0?0:t.minTime}))}function rs(){const t=new Map;for(const n of be)t.has(n.frameId)||t.set(n.frameId,[]),t.get(n.frameId).push(n);const e=[];for(const[n,o]of t)if(o.length>1){const s=new Set(o.map(h=>h.name)),r=o.reduce((h,f)=>h+f.duration,0);e.push({frameId:n,memoCount:s.size,invocationCount:o.length,totalTime:r,memos:Array.from(s),invocations:o.sort((h,f)=>h.timestamp-f.timestamp)})}return e.sort((n,o)=>o.totalTime-n.totalTime)}function as(){const t=ss(),e=rs(),n=[],o=.1,s=1,r=100,h=5;for(const f of t){const w={name:f.name,status:"KEEP_MEMO",reason:"",metrics:{callCount:f.callCount,avgTime:f.avgTime.toFixed(3),totalTime:f.totalTime.toFixed(3)}};if(f.avgTime<o&&f.callCount<r)w.status="CONSIDER_PLAIN_FUNCTION",w.reason=`Avg time ${f.avgTime.toFixed(3)}ms is under ${o}ms threshold. Memo overhead may exceed computation cost.`;else if(f.avgTime>s&&f.callCount>r)w.status="OPTIMIZE_COMPUTATION",w.reason=`Called ${f.callCount} times with avg ${f.avgTime.toFixed(3)}ms. Total ${f.totalTime.toFixed(1)}ms spent in this memo.`;else{const u=e.filter(S=>S.memos.includes(f.name)).length;u>h&&(w.status="CHECK_REACTIVE_CASCADE",w.reason=`Involved in ${u} cascade events. May be triggering unnecessary reactive updates.`)}n.push(w)}return n.sort((f,w)=>{const u=parseFloat(f.metrics.totalTime);return parseFloat(w.metrics.totalTime)-u}),{summary:{memoCount:t.length,totalInvocations:t.reduce((f,w)=>f+w.callCount,0),totalTime:t.reduce((f,w)=>f+w.totalTime,0),cascadeEvents:e.length},recommendations:n,cascades:e.slice(0,10)}}function is(t){const{frameAnalysis:e={},memoAnalysis:n={},config:o={},timeline:s=[]}=t;return{metadata:{version:"1.0.0",timestamp:new Date().toISOString(),browser:us(),userAgent:navigator?.userAgent||"unknown"},configuration:{taskCount:o.taskCount??0,arrowCount:o.arrowCount??0,viewMode:o.viewMode??"Day",viewportWidth:o.viewportWidth??window?.innerWidth??0,viewportHeight:o.viewportHeight??window?.innerHeight??0,arrowRenderer:o.arrowRenderer??"individual",testDuration:o.testDuration??0,testType:o.testType??"manual"},frameMetrics:{frameCount:e.frameCount??0,totalDuration:wt(e.totalDuration),avgFrameTime:wt(e.avgFrameTime),avgFPS:wt(e.avgFPS),minFrameTime:wt(e.minFrameTime),maxFrameTime:wt(e.maxFrameTime),percentile95:wt(e.percentile95),percentile99:wt(e.percentile99),droppedFrames:e.droppedFrames??0,droppedFramePercent:wt(e.droppedFramePercent),blockingTime:wt(e.blockingTime),source:e.source??"unknown",worstFrame:e.worstFrame?{timestamp:wt(e.worstFrame.timestamp),duration:wt(e.worstFrame.duration),blockingDuration:wt(e.worstFrame.blockingDuration),scripts:e.worstFrame.scripts||[]}:null},memoAnalysis:{summary:n.summary??{},recommendations:(n.recommendations||[]).slice(0,20),cascades:(n.cascades||[]).slice(0,10)},memory:gs(),timeline:s.map(r=>({time:wt(r.time),fps:wt(r.fps),frameCount:r.frameCount}))}}function ls(t,e={}){const{pretty:n=!0}=e;return JSON.stringify(t,null,n?2:0)}function cs(t,e){const n=ls(t),o=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(o),r=new Date().toISOString().replace(/[:.]/g,"-"),h=e||`gantt-benchmark-${r}.json`,f=document.createElement("a");f.href=s,f.download=h,f.click(),URL.revokeObjectURL(s)}function ds(t){const e=[];if(e.push("=== Gantt Chart Performance Benchmark ==="),e.push(`Timestamp: ${t.metadata.timestamp}`),e.push(`Browser: ${t.metadata.browser}`),e.push(""),e.push("Configuration:"),e.push(`  Tasks: ${t.configuration.taskCount}`),e.push(`  Arrows: ${t.configuration.arrowCount}`),e.push(`  Arrow Renderer: ${t.configuration.arrowRenderer}`),e.push(`  Viewport: ${t.configuration.viewportWidth}x${t.configuration.viewportHeight}`),e.push(""),e.push("Frame Metrics:"),e.push(`  Average FPS: ${t.frameMetrics.avgFPS}`),e.push(`  Average Frame: ${t.frameMetrics.avgFrameTime}ms`),e.push(`  Worst Frame: ${t.frameMetrics.maxFrameTime}ms`),e.push(`  95th Percentile: ${t.frameMetrics.percentile95}ms`),e.push(`  Dropped Frames: ${t.frameMetrics.droppedFrames} (${t.frameMetrics.droppedFramePercent}%)`),e.push(`  Measurement Source: ${t.frameMetrics.source}`),e.push(""),t.memoAnalysis?.summary?.memoCount&&(e.push("Memo Analysis:"),e.push(`  Tracked Memos: ${t.memoAnalysis.summary.memoCount}`),e.push(`  Total Invocations: ${t.memoAnalysis.summary.totalInvocations}`),e.push(`  Total Time: ${wt(t.memoAnalysis.summary.totalTime)}ms`),e.push(`  Cascade Events: ${t.memoAnalysis.summary.cascadeEvents}`),t.memoAnalysis.recommendations?.length>0)){e.push(""),e.push("Top Recommendations:");for(const n of t.memoAnalysis.recommendations.slice(0,5))e.push(`  [${n.status}] ${n.name}`),n.reason&&e.push(`    ${n.reason}`)}return t.memory?.jsHeapSizeLimit&&(e.push(""),e.push("Memory:"),e.push(`  Used Heap: ${Le(t.memory.usedJSHeapSize)}`),e.push(`  Total Heap: ${Le(t.memory.totalJSHeapSize)}`)),e.join(`
`)}function wt(t,e=2){return typeof t!="number"||isNaN(t)?0:Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function us(){if(typeof navigator>"u")return"unknown";const t=navigator.userAgent;return t.includes("Chrome")?`Chrome ${t.match(/Chrome\/(\d+)/)?.[1]||""}`:t.includes("Firefox")?`Firefox ${t.match(/Firefox\/(\d+)/)?.[1]||""}`:t.includes("Safari")&&!t.includes("Chrome")?`Safari ${t.match(/Version\/(\d+)/)?.[1]||""}`:"unknown"}function gs(){return typeof performance>"u"||!performance.memory?null:{jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}}function Le(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,o)).toFixed(2))+" "+n[o]}var fs=Dt('<div><div><h1 style=margin:0;font-size:20px>Performance Test</h1><div><div><span>Tasks:</span><span></span></div><div><span>Arrows:</span><span></span></div><div><span>Render:</span><span></span></div><div><span>FPS:</span><span></span></div><div><span>Worst:</span><span>ms</span></div><div><span>Avg:</span><span>ms</span></div><div><span>Scroll/s:</span><span></span></div><div><span>Heap:</span><span></span></div></div><div><label style=font-size:13px>View:<select style=width:100px;margin-left:5px><option value=Hour>Hour</option><option value=Day>Day</option><option value=Week>Week</option><option value=Month>Month</option></select></label><button>Reload</button><button></button><button></button><span style="color:#9ca3af;margin:0 5px">|</span><button></button><button>Export JSON</button><label style=font-size:13px>Arrows:<select style=width:100px;margin-left:5px><option value=individual>Individual</option><option value=batched>Batched</option></select></label><label style=font-size:13px>Mode:<select style=width:100px;margin-left:5px><option value=simple>Simple</option><option value=detailed>Detailed</option></select></label><label style=font-size:13px>TaskLayer:<select style=width:100px;margin-left:5px><option value=full>Full</option><option value=minimal>Minimal (V7j)</option></select></label></div><div style=display:flex;gap:15px;align-items:center;font-size:12px;color:#6b7280><span style=font-weight:bold>Buffers:</span><label style=display:flex;align-items:center;gap:4px>Rows:<input type=range min=1 max=30 style=width:60px><span style=min-width:20px></span></label><label style=display:flex;align-items:center;gap:4px>X:<input type=range min=200 max=3000 step=100 style=width:60px><span style=min-width:45px>px</span></label><label style=display:flex;align-items:center;gap:4px>Cols:<input type=range min=1 max=30 style=width:60px><span style=min-width:20px></span></label></div></div><div>');function hs(){const[t,e]=I([]),[n,o]=I(null),[s,r]=I({tasks:0,arrows:0}),[h,f]=I("Hour"),[w,u]=I(0),[S,c]=I(0),[P,E]=I(0),[R,C]=I(!1),[y,i]=I(!1),[v,k]=I(0),[_,U]=I(5),[a,l]=I(600),[M,W]=I(5),[Y,K]=I(null),[lt,ut]=I(!1),[p,O]=I(null),[b,x]=I("batched"),[H,$]=I("simple"),[V,G]=I("full");let J=null,nt=performance.now(),A=[],X=0,st=performance.now(),ft=0,vt=performance.now();const[,bt]=ao(j=>{ft++;const ht=j-nt;nt=j,A.push(ht),A.length>60&&A.shift();const pt=j-vt;if(pt>=1e3){if(u(Math.round(ft*1e3/pt)),ft=0,vt=j,A.length>0){const d=Math.max(...A),B=A.reduce((Z,ot)=>Z+ot,0)/A.length;c(d.toFixed(1)),E(B.toFixed(1))}const ct=j-st;ct>=1e3&&(k(Math.round(X*1e3/ct)),X=0,st=j),performance.memory&&K((performance.memory.usedJSHeapSize/1048576).toFixed(1))}});let St=null;const T=()=>{if(R()){St&&(St.abort=!0),C(!1);return}const j=document.querySelector(".gantt-scroll-area");if(!j)return;C(!0),A=[],c(0);const ht={abort:!1};St=ht;const pt=3e4,ct=performance.now();let d=1,B=j.scrollLeft;const Z=()=>{if(ht.abort||performance.now()-ct>pt){C(!1),console.log("H-Scroll test complete:",{worst:S(),avg:P()});return}const ot=d*200;B+=ot,B>j.scrollWidth-j.clientWidth-500?d=-1:B<500&&(d=1),j.scrollLeft=B,requestAnimationFrame(Z)};requestAnimationFrame(Z)};let q=null;const m=()=>{if(y()){q&&(q.abort=!0),i(!1);return}const j=document.querySelector(".gantt-scroll-area");if(!j)return;i(!0),A=[],c(0);const ht={abort:!1};q=ht;const pt=3e4,ct=performance.now();let d=1,B=j.scrollTop;const Z=()=>{if(ht.abort||performance.now()-ct>pt){i(!1),console.log("V-Scroll test complete:",{worst:S(),avg:P()});return}const ot=d*100;B+=ot,B>j.scrollHeight-j.clientHeight-200?d=-1:B<200&&(d=1),j.scrollTop=B,requestAnimationFrame(Z)};requestAnimationFrame(Z)},tt=()=>{if(lt()){et();return}J=ts(),os(),es(),J.startTracking(),ut(!0),A=[],console.log("Benchmark started - scroll or interact, then click Stop")},et=()=>{if(!lt())return;J?.stopTracking(),ns(),ut(!1);const j=J?.analyze()||{},ht=as(),pt=J?.getFPSTimeline(100)||[],ct=is({frameAnalysis:j,memoAnalysis:ht,timeline:pt,config:{taskCount:s().tasks,arrowCount:s().arrows,viewMode:h(),arrowRenderer:b(),viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,testType:"manual"}});O(ct),console.log("Benchmark complete:",ds(ct))},dt=()=>{const j=p();j?cs(j):console.warn("No benchmark results to export. Run a benchmark first.")};fe(()=>{const j=document.querySelector(".gantt-scroll-area");if(j){const ct=()=>X++;j.addEventListener("scroll",ct,{passive:!0}),de(()=>j.removeEventListener("scroll",ct))}let ht=0;const pt=setInterval(()=>{if(R()||y()){const ct=performance.now();ct-ht>2e3&&(ht=ct,console.log("[PERF]",{fps:w(),avgFrame:P()+"ms",worstFrame:S()+"ms",scrollEvents:v()+"/sec",heap:Y()+"MB"}))}},500);de(()=>clearInterval(pt))});const gt=F(()=>({view_mode:h(),renderMode:H(),bar_height:20,padding:8,column_width:h()==="Hour"?25:30,upper_header_height:35,lower_header_height:25,headerHeight:60,lines:"both",scroll_to:"start"})),it=()=>{const j=performance.now();e(Kn.tasks),requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{o((performance.now()-j).toFixed(1)),r({tasks:document.querySelectorAll(".bar-wrapper").length,arrows:document.querySelectorAll(".arrow-layer > g").length})},0)})})};fe(()=>{it(),bt()});const L={container:{"max-width":"100%",height:"100vh",margin:0,padding:"10px",display:"flex","flex-direction":"column","box-sizing":"border-box",overflow:"hidden","font-family":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},header:{"margin-bottom":"10px",display:"flex","align-items":"center",gap:"20px","flex-wrap":"wrap"},stats:{display:"flex",gap:"15px",padding:"10px 15px","background-color":"#1f2937",color:"#fff","border-radius":"6px","font-size":"13px","font-family":"monospace"},statItem:{display:"flex",gap:"5px"},statLabel:{color:"#9ca3af"},statValue:{color:"#10b981","font-weight":"bold"},controls:{display:"flex",gap:"10px","align-items":"center"},select:{padding:"6px 10px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"13px",cursor:"pointer"},button:{padding:"6px 12px","background-color":"#3b82f6",color:"#fff",border:"none","border-radius":"4px",cursor:"pointer","font-size":"13px"},ganttWrapper:{border:"1px solid #e0e0e0","border-radius":"8px",overflow:"hidden","background-color":"#fff",flex:1,"min-height":0}},D=()=>w()>=55?"#10b981":w()>=30?"#f59e0b":"#ef4444",Rt=j=>j<=16.67?"#10b981":j<=33?"#f59e0b":"#ef4444";return(()=>{var j=fs(),ht=j.firstChild,pt=ht.firstChild,ct=pt.nextSibling,d=ct.firstChild,B=d.firstChild,Z=B.nextSibling,ot=d.nextSibling,kt=ot.firstChild,Ct=kt.nextSibling,Tt=ot.nextSibling,Pt=Tt.firstChild,Ht=Pt.nextSibling,$t=Tt.nextSibling,yt=$t.firstChild,Bt=yt.nextSibling,It=$t.nextSibling,Wt=It.firstChild,Et=Wt.nextSibling,Ut=Et.firstChild,Ft=It.nextSibling,Yt=Ft.firstChild,At=Yt.nextSibling,Gt=At.firstChild,Lt=Ft.nextSibling,zt=Lt.firstChild,Xt=zt.nextSibling,Vt=Lt.nextSibling,qt=Vt.firstChild,ke=qt.nextSibling,te=ct.nextSibling,ye=te.firstChild,qe=ye.firstChild,ee=qe.nextSibling,ne=ye.nextSibling,Nt=ne.nextSibling,Ot=Nt.nextSibling,je=Ot.nextSibling,Jt=je.nextSibling,Kt=Jt.nextSibling,xe=Kt.nextSibling,Ue=xe.firstChild,oe=Ue.nextSibling,we=xe.nextSibling,Ge=we.firstChild,se=Ge.nextSibling,Ne=we.nextSibling,Oe=Ne.firstChild,re=Oe.nextSibling,Je=te.nextSibling,Ke=Je.firstChild,Se=Ke.nextSibling,Qe=Se.firstChild,ae=Qe.nextSibling,Ze=ae.nextSibling,Ce=Se.nextSibling,tn=Ce.firstChild,ie=tn.nextSibling,Te=ie.nextSibling,en=Te.firstChild,nn=Ce.nextSibling,on=nn.firstChild,le=on.nextSibling,sn=le.nextSibling,Me=ht.nextSibling;return at(Z,()=>s().tasks),at(Ct,()=>s().arrows),at(Ht,(()=>{var g=he(()=>!!n());return()=>g()?`${n()}ms`:"..."})()),at(Bt,w),at(Et,S,Ut),at(At,P,Gt),at(Xt,v),at(ke,(()=>{var g=he(()=>!!Y());return()=>g()?`${Y()}MB`:"N/A"})()),ee.addEventListener("change",g=>f(g.target.value)),ne.$$click=it,Nt.$$click=T,at(Nt,()=>R()?"Stop":"H-Scroll"),Ot.$$click=m,at(Ot,()=>y()?"Stop":"V-Scroll"),Jt.$$click=tt,at(Jt,()=>lt()?"Stop Bench":"Benchmark"),Kt.$$click=dt,oe.addEventListener("change",g=>x(g.target.value)),se.addEventListener("change",g=>$(g.target.value)),re.addEventListener("change",g=>G(g.target.value)),ae.$$input=g=>U(+g.target.value),at(Ze,_),ie.$$input=g=>l(+g.target.value),at(Te,a,en),le.$$input=g=>W(+g.target.value),at(sn,M),at(Me,mt(Zo,{get tasks(){return t()},get options(){return gt()},get overscanRows(){return _()},get overscanX(){return a()},get overscanCols(){return M()},get arrowRenderer(){return b()},get taskLayerMode(){return V()},onDateChange:(g,jt)=>console.log("Date changed:",g,jt),onProgressChange:(g,jt)=>console.log("Progress changed:",g,jt),onTaskClick:g=>console.log("Task clicked:",g)})),xt(g=>{var jt=L.container,rn=L.header,an=L.stats,ln=L.statItem,cn=L.statLabel,dn=L.statValue,un=L.statItem,gn=L.statLabel,fn=L.statValue,hn=L.statItem,mn=L.statLabel,vn=L.statValue,pn=L.statItem,bn=L.statLabel,kn={...L.statValue,color:D()},yn=L.statItem,xn=L.statLabel,wn={...L.statValue,color:Rt(S())},Sn=L.statItem,Cn=L.statLabel,Tn={...L.statValue,color:Rt(P())},Mn=L.statItem,_n=L.statLabel,Dn=L.statValue,Hn=L.statItem,Rn=L.statLabel,Pn=L.statValue,$n=L.controls,In={...L.select},En=L.button,Fn={...L.button,"background-color":R()?"#ef4444":"#8b5cf6"},An={...L.button,"background-color":y()?"#ef4444":"#8b5cf6"},Ln={...L.button,"background-color":lt()?"#ef4444":"#059669"},Bn={...L.button,"background-color":p()?"#0891b2":"#6b7280"},_e=!p(),Wn={...L.select},Yn={...L.select},zn={...L.select},Xn=L.ganttWrapper;return g.e=Q(j,jt,g.e),g.t=Q(ht,rn,g.t),g.a=Q(ct,an,g.a),g.o=Q(d,ln,g.o),g.i=Q(B,cn,g.i),g.n=Q(Z,dn,g.n),g.s=Q(ot,un,g.s),g.h=Q(kt,gn,g.h),g.r=Q(Ct,fn,g.r),g.d=Q(Tt,hn,g.d),g.l=Q(Pt,mn,g.l),g.u=Q(Ht,vn,g.u),g.c=Q($t,pn,g.c),g.w=Q(yt,bn,g.w),g.m=Q(Bt,kn,g.m),g.f=Q(It,yn,g.f),g.y=Q(Wt,xn,g.y),g.g=Q(Et,wn,g.g),g.p=Q(Ft,Sn,g.p),g.b=Q(Yt,Cn,g.b),g.T=Q(At,Tn,g.T),g.A=Q(Lt,Mn,g.A),g.O=Q(zt,_n,g.O),g.I=Q(Xt,Dn,g.I),g.S=Q(Vt,Hn,g.S),g.W=Q(qt,Rn,g.W),g.C=Q(ke,Pn,g.C),g.B=Q(te,$n,g.B),g.v=Q(ee,In,g.v),g.k=Q(ne,En,g.k),g.x=Q(Nt,Fn,g.x),g.j=Q(Ot,An,g.j),g.q=Q(Jt,Ln,g.q),g.z=Q(Kt,Bn,g.z),_e!==g.P&&(Kt.disabled=g.P=_e),g.H=Q(oe,Wn,g.H),g.F=Q(se,Yn,g.F),g.M=Q(re,zn,g.M),g.D=Q(Me,Xn,g.D),g},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0,T:void 0,A:void 0,O:void 0,I:void 0,S:void 0,W:void 0,C:void 0,B:void 0,v:void 0,k:void 0,x:void 0,j:void 0,q:void 0,z:void 0,P:void 0,H:void 0,F:void 0,M:void 0,D:void 0}),xt(()=>ee.value=h()),xt(()=>oe.value=b()),xt(()=>se.value=H()),xt(()=>re.value=V()),xt(()=>ae.value=_()),xt(()=>ie.value=a()),xt(()=>le.value=M()),j})()}pe(["click","input"]);Qn(()=>mt(hs,{}),document.getElementById("app"));
