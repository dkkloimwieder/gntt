import{b as X,m as G,t as j,i as R,g as J,y as Q,S as B,c as V,j as N,l as W}from"./calendar-Ds9A9IRk.js";function _(t,n,e){if(!t)return null;const o=typeof t=="string"?new Date(t):t;return isNaN(o.getTime())?null:(o.getTime()-n.getTime())/(1e3*60*60)*e}function A(t){return t===!0||t==="start"||t==="end"}function mt(t){return t===!0||t==="start"||t==="duration"}function xt(t){return t===!0||t==="end"||t==="duration"}function O(t,n,e){return t?.minStart?_(t.minStart,n,e)??0:0}function q(t,n,e){return t?.maxStart?_(t.maxStart,n,e)??1/0:1/0}function Z(t,n,e){return t?.maxEnd?_(t.maxEnd,n,e)??1/0:1/0}function yt(t,n,e=null){const o=e??n;return t?.minDuration?Math.max(o,t.minDuration*n):o}const C=.5,tt=100,y={FS:"FS",SS:"SS",FF:"FF",SF:"SF"};function bt(t){const n=new Map,e=new Map;for(const o of t)n.has(o.to)||n.set(o.to,[]),n.get(o.to).push(o),e.has(o.from)||e.set(o.from,[]),e.get(o.from).push(o);return{bySuccessor:n,byPredecessor:e}}function E(t,n){const e=(t.lag??0)*n,o=(t.min??0)*n,s=t.max,i=s==null?1/0:s*n;return{lag:e,min:o,max:i,minGap:e+o,maxGap:e+i,isElastic:i===1/0,isFixed:i===o}}function Y(t,n){switch(t){case y.FS:case y.FF:return n.x+n.width;case y.SS:case y.SF:return n.x;default:return n.x+n.width}}function H(t,n){switch(t){case y.FS:case y.SS:return n.x;case y.FF:case y.SF:return n.x+n.width;default:return n.x}}function K(t){return t===y.FF||t===y.SF}function P(t){return t===y.FS||t===y.FF}function I(t,n,e,o){const i=Y(t,n)+o;return K(t)?i-e:i}function nt(t,n,e,o){const i=Y(t,n)+o;return K(t)?i-e:i}function et(t,n,e){return P(t)?H(t,n)-e:1/0}function ot(t,n,e){return P(t)?1/0:H(t,n)-e}function st(t,n,e,o,s=0){let i=0;const c=Array.isArray(n)?n.filter(r=>r.to===t):n.bySuccessor?.get(t)||[];for(const r of c){const g=e(r.from);if(!g)continue;const p=r.type||y.FS,{minGap:m}=E(r,o),x=I(p,g,s,m);i=Math.max(i,x)}return i}function it(t,n,e,o,s=0){let i=1/0;const c=Array.isArray(n)?n.filter(r=>r.to===t):n.bySuccessor?.get(t)||[];for(const r of c){const g=e(r.from);if(!g)continue;const{maxGap:p,isElastic:m}=E(r,o);if(m)continue;const x=r.type||y.FS,d=nt(x,g,s,p);i=Math.min(i,d)}return i}function rt(t,n,e,o,s,i=null){let c;if(Array.isArray(n)){const l=new Map;for(const h of n)l.has(h.from)||l.set(h.from,[]),l.get(h.from).push(h);c=h=>l.get(h)||[]}else c=l=>n.byPredecessor?.get(l)||[];if(c(t).length===0)return 1/0;const g=i?i.x+i.width:null,p=new Map,m=new Set,x=[t],d=[];for(;x.length>0;){const l=x.shift();if(m.has(l))continue;m.add(l),d.push(l);const h=c(l);for(const u of h)m.has(u.to)||x.push(u.to)}for(let l=d.length-1;l>=0;l--){const h=d[l];let u=1/0;const a=c(h);for(const f of a){const b=f.to,w=o?.(b),$=e(b);if(!$)continue;const{minGap:k}=E(f,s),M=f.type||y.FS;if(!P(M))continue;if(A(w?.constraints?.locked)){const S=et(M,$,k);u=Math.min(u,S)}else{const T=(p.get(b)??1/0)-$.width-k;u=Math.min(u,T)}}if(p.set(h,u),h===t&&g!==null&&u<=g+C)return u}return p.get(t)??1/0}function ct(t,n,e,o,s){let i=1/0;const c=Array.isArray(n)?n.filter(r=>r.from===t):n.byPredecessor?.get(t)||[];for(const r of c){if(!o?.(r.to)?.constraints?.locked)continue;const m=e(r.to);if(!m)continue;const x=r.type||y.FS,{minGap:d}=E(r,s),l=ot(x,m,d);l!==1/0&&(i=Math.min(i,l))}return i}function at(t,n,e){const{getBarPosition:o,getTask:s,relationships:i,relationshipIndex:c,pixelsPerHour:r,ganttStartDate:g}=e,p=new Map;p.set(t,{x:n});let m;if(c?.byPredecessor)m=a=>c.byPredecessor.get(a)||[];else{const a=new Map;for(const f of i)a.has(f.from)||a.set(f.from,[]),a.get(f.from).push(f);m=f=>a.get(f)||[]}let x;if(c?.bySuccessor)x=a=>c.bySuccessor.get(a)||[];else{const a=new Map;for(const f of i)a.has(f.to)||a.set(f.to,[]),a.get(f.to).push(f);x=f=>a.get(f)||[]}const d=new Set,l=[t];for(;l.length>0;){const a=l.shift();for(const f of m(a))d.has(f.to)||(d.add(f.to),l.push(f.to))}let h=!0,u=0;for(;h&&u<tt;){h=!1,u++;for(const a of d){const f=s?.(a);if(A(f?.constraints?.locked))continue;let b=o(a);if(!b)continue;p.has(a)&&(b={...b,...p.get(a)});let w=0;for(const M of x(a)){let F=o(M.from);if(!F)continue;p.has(M.from)&&(F={...F,...p.get(M.from)});const S=M.type||y.FS,{minGap:v}=E(M,r),T=I(S,F,b.width,v);w=Math.max(w,T)}const $=O(f?.constraints,g,r),k=q(f?.constraints,g,r);w=Math.max($,Math.min(w,k)),w>b.x+C&&(p.set(a,{x:w}),h=!0)}}return p.delete(t),p}function St(t,n,e,o){const{getBarPosition:s,getTask:i,relationships:c,relationshipIndex:r,pixelsPerHour:g,ganttStartDate:p}=o,m=r||c,x=i?.(t),d=s(t);if(!d)return{constrainedX:n,constrainedWidth:e,blocked:!1,blockReason:null,cascadeUpdates:new Map};if(A(x?.constraints?.locked))return{constrainedX:d.x,constrainedWidth:d.width,blocked:!0,blockReason:"locked",cascadeUpdates:new Map};if(Math.abs(n-d.x)<C&&Math.abs(e-d.width)<C)return{constrainedX:d.x,constrainedWidth:d.width,blocked:!1,blockReason:null,cascadeUpdates:new Map};const l=n>d.x+C;let h=0,u=1/0;const a=O(x?.constraints,p,g),f=q(x?.constraints,p,g),b=Z(x?.constraints,p,g);h=Math.max(h,a),f!==1/0&&(u=Math.min(u,f)),b!==1/0&&(u=Math.min(u,b-e));const w=st(t,m,s,g,e),$=it(t,m,s,g,e);if(h=Math.max(h,w),$!==1/0&&(u=Math.min(u,$)),l){const S=rt(t,m,s,i,g,d);S!==1/0&&(u=Math.min(u,S-e));const v=ct(t,m,s,i,g);v!==1/0&&(u=Math.min(u,v))}let k=Math.max(h,Math.min(n,u));const M=h>u+C;M&&(k=d.x);let F=new Map;return!M&&Math.abs(k-d.x)>C&&(F=at(t,k,o)),{constrainedX:k,constrainedWidth:e,blocked:M,blockReason:M?"conflicting_constraints":null,cascadeUpdates:F}}function wt(t){const n=new Map;for(const s of t)n.has(s.from)||n.set(s.from,[]),n.get(s.from).push(s.to),n.has(s.to)||n.set(s.to,[]);const e=new Map;function o(s,i){e.set(s,1);for(const c of n.get(s)||[]){if(e.get(c)===1){const r=i.indexOf(c);return{hasCycle:!0,cycle:[...i.slice(r),c]}}if(e.get(c)===0||!e.has(c)){const r=o(c,[...i,c]);if(r.hasCycle)return r}}return e.set(s,2),{hasCycle:!1,cycle:[]}}for(const s of n.keys())if(!e.has(s)||e.get(s)===0){const i=o(s,[s]);if(i.hasCycle)return i}return{hasCycle:!1,cycle:[]}}function Mt(t,n,e=null,o=new Set){const s=[t];for(;s.length>0;){const i=s.shift();if(!o.has(i)&&!(e&&e(i)?.constraints?.locked)){o.add(i);for(const c of n)c.from===i&&!o.has(c.to)&&s.push(c.to)}}return o}function kt(t,n,e,o,s={}){if(n>=0)return n;const{pixelsPerTimeUnit:i=1}=s;let c=n;const r=new Set(t.keys());for(const[g,{originalX:p}]of t){const m=o(g);if(m?.$bar)for(const x of e){if(x.to!==g)continue;const d=x.from;if(r.has(d))continue;const l=o(d);if(!l?.$bar)continue;const h=x.type||y.FS,a=(x.lag??0)*i,f=l.$bar,b=m.$bar.width??0,w=I(h,f,b,a);if(p+n<w){const k=w-p;k<=0?c=Math.max(c,k):c=Math.max(c,0)}}}return c}function ft(t,n){if(!t)return"";const e=[`Task: "${t.name||"Unnamed"}"`,`ID: ${t.id}`,`Progress: ${t.progress??0}%`];return n&&(e.push(`Position: (${Math.round(n.x)}, ${Math.round(n.y)})`),e.push(`Size: ${Math.round(n.width)} x ${Math.round(n.height)}`)),t.constraints?.locked&&e.push("Status: Locked"),t.invalid&&e.push("Status: Invalid"),e.join(`
`)}function lt(t,n,e=[]){if(!t)return null;const o={...t};return delete o.$bar,{sections:{rawTask:JSON.stringify(o,null,2),position:n?JSON.stringify({x:Math.round(n.x),y:Math.round(n.y),width:Math.round(n.width),height:Math.round(n.height),index:n.index},null,2):"N/A",relationships:dt(t.id,e)},raw:JSON.stringify({task:o,position:n},null,2)}}const ut={FS:"Finish-to-Start",SS:"Start-to-Start",FF:"Finish-to-Finish",SF:"Start-to-Finish"};function L(t,n,e){const o=ut[t.type]||t.type,s=t.lag??0,i=s?`, lag: ${s} day${s!==1?"s":""}`:"";return`  ${t.type} ${e} ${n} (${o}${i})`}function dt(t,n){if(!n||n.length===0)return"No relationships defined";const e=n.filter(i=>i.to===t),o=n.filter(i=>i.from===t);let s="";return e.length===0?s+=`Incoming: (none)
`:(s+=`Incoming:
`,e.forEach(i=>{s+=L(i,i.from,"<-")+`
`})),o.length===0?s+="Outgoing: (none)":(s+=`Outgoing:
`,o.forEach((i,c)=>{s+=L(i,i.to,"->"),c<o.length-1&&(s+=`
`)})),s}function U(t){return t?t.replace(/"([^"]+)":/g,'<span style="color: #9b59b6;">"$1"</span>:').replace(/: "([^"]+)"/g,': <span style="color: #27ae60;">"$1"</span>').replace(/: (-?\d+\.?\d*)/g,': <span style="color: #e74c3c;">$1</span>').replace(/: (true|false)/g,': <span style="color: #3498db;">$1</span>').replace(/: (null)/g,': <span style="color: #95a5a6;">$1</span>'):""}var ht=j('<div><div style=font-family:monospace;white-space:pre-line;line-height:1.5></div><div style="margin-top:10px;padding-top:8px;border-top:1px solid #eee;font-size:10px;color:#999;text-align:center;font-family:sans-serif">Click for full data');function $t(t){const n=X(()=>{const o=t.task?.(),s=t.barPosition?.();return o?ft(o,s):""}),e=X(()=>{const o=t.position?.()||{x:0,y:0};return{position:"fixed",left:`${o.x+15}px`,top:`${o.y-10}px`,background:"#fff","box-shadow":"0 4px 12px rgba(0,0,0,0.15)","border-radius":"6px",padding:"12px","min-width":"180px","max-width":"280px","z-index":1100,"font-size":"12px","border-left":"3px solid #3498db","pointer-events":"none"}});return G(B,{get when(){return t.visible?.()},get children(){var o=ht(),s=o.firstChild;return s.nextSibling,R(s,n),J(i=>Q(o,e(),i)),o}})}var gt=j('<div tabindex=-1 style=position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:2000><div style="background:#fff;border-radius:8px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 10px 40px rgba(0,0,0,0.3)"><div style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #eee;flex-shrink:0"><h3 style=margin:0;font-size:16px;font-weight:600>Task Data: </h3><button title="Close (Esc)"style="border:none;background:none;font-size:24px;cursor:pointer;padding:4px 8px;color:#666;line-height:1">&times;</button></div><div style=padding:20px;overflow:auto;flex:1><div style=margin-bottom:20px><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:8px><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px>Raw Task Object</span><button style="padding:4px 10px;border:none;border-radius:3px;cursor:pointer;font-size:11px;transition:background 0.2s"></button></div><pre style=background:#f8f9fa;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-break:break-all;overflow:auto;max-height:200px;margin:0;line-height:1.5></pre></div><div style=margin-bottom:20px><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px;display:block;margin-bottom:8px>Computed Position ($bar)</span><pre style=background:#f8f9fa;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;margin:0;line-height:1.5></pre></div><div><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px;display:block;margin-bottom:8px>Relationships</span><pre style=background:#fff8e1;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;white-space:pre-wrap;margin:0;line-height:1.5;color:#5d4037>');function Ft(t){const[n,e]=V(""),o=X(()=>{const r=t.task?.();return r?lt(r,t.barPosition?.(),t.relationships?.()||[]):null}),s=async()=>{const r=o();if(r?.raw)try{await navigator.clipboard.writeText(r.raw),e("Copied!"),setTimeout(()=>e(""),2e3)}catch{e("Failed to copy"),setTimeout(()=>e(""),2e3)}},i=r=>{r.target===r.currentTarget&&t.onClose?.()},c=r=>{r.key==="Escape"&&t.onClose?.()};return G(B,{get when(){return t.visible?.()},get children(){var r=gt(),g=r.firstChild,p=g.firstChild,m=p.firstChild;m.firstChild;var x=m.nextSibling,d=p.nextSibling,l=d.firstChild,h=l.firstChild,u=h.firstChild,a=u.nextSibling,f=h.nextSibling,b=l.nextSibling,w=b.firstChild,$=w.nextSibling,k=b.nextSibling,M=k.firstChild,F=M.nextSibling;return r.$$keydown=c,r.$$click=i,R(m,()=>t.task?.()?.name||"Unknown",null),x.$$click=()=>t.onClose?.(),a.$$click=s,R(a,()=>n()||"Copy JSON"),R(F,()=>o()?.sections?.relationships),J(S=>{var v=n()==="Copied!"?"#d4edda":"#e3f2fd",T=n()==="Copied!"?"#155724":"#1976d2",z=U(o()?.sections?.rawTask||""),D=U(o()?.sections?.position||"");return v!==S.e&&N(a,"background",S.e=v),T!==S.t&&N(a,"color",S.t=T),z!==S.a&&(f.innerHTML=S.a=z),D!==S.o&&($.innerHTML=S.o=D),S},{e:void 0,t:void 0,a:void 0,o:void 0}),r}})}W(["click","keydown"]);export{$t as T,Mt as a,bt as b,kt as c,wt as d,Ft as e,xt as f,yt as g,at as h,mt as i,St as r};
