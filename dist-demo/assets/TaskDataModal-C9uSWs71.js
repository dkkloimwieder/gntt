import{b as P,m as O,t as Y,i as A,g as q,y as tt,S as B,c as et,j as U,l as nt}from"./calendar-DFJjUJ4H.js";function z(t,e,i){if(!t)return null;const n=typeof t=="string"?new Date(t):t;return isNaN(n.getTime())?null:(n.getTime()-e.getTime())/(1e3*60*60)*i}function k(t){return t===!0||t==="start"||t==="end"}function Mt(t){return t===!0||t==="start"||t==="duration"}function wt(t){return t===!0||t==="end"||t==="duration"}function H(t,e,i){return t!=null&&t.minStart?z(t.minStart,e,i)??0:0}function K(t,e,i){return t!=null&&t.maxStart?z(t.maxStart,e,i)??1/0:1/0}function it(t,e,i){return t!=null&&t.maxEnd?z(t.maxEnd,e,i)??1/0:1/0}function pt(t,e,i=null){const n=i??e;return t!=null&&t.minDuration?Math.max(n,t.minDuration*e):n}const R=.5,ot=100,S={FS:"FS",SS:"SS",FF:"FF",SF:"SF"};function $t(t){const e=new Map,i=new Map;for(const n of t)e.has(n.to)||e.set(n.to,[]),e.get(n.to).push(n),i.has(n.from)||i.set(n.from,[]),i.get(n.from).push(n);return{bySuccessor:e,byPredecessor:i}}function _(t,e){const i=(t.lag??0)*e,n=(t.min??0)*e,o=t.max,r=o==null?1/0:o*e;return{lag:i,min:n,max:r,minGap:i+n,maxGap:i+r,isElastic:r===1/0,isFixed:r===n}}function Q(t,e){switch(t){case S.FS:case S.FF:return e.x+e.width;case S.SS:case S.SF:return e.x;default:return e.x+e.width}}function V(t,e){switch(t){case S.FS:case S.SS:return e.x;case S.FF:case S.SF:return e.x+e.width;default:return e.x}}function Z(t){return t===S.FF||t===S.SF}function D(t){return t===S.FS||t===S.FF}function W(t,e,i,n){const r=Q(t,e)+n;return Z(t)?r-i:r}function rt(t,e,i,n){const r=Q(t,e)+n;return Z(t)?r-i:r}function st(t,e,i){return D(t)?V(t,e)-i:1/0}function ct(t,e,i){return D(t)?1/0:V(t,e)-i}function at(t,e,i,n,o=0){var s;let r=0;const a=Array.isArray(e)?e.filter(c=>c.to===t):((s=e.bySuccessor)==null?void 0:s.get(t))||[];for(const c of a){const u=i(c.from);if(!u)continue;const m=c.type||S.FS,{minGap:x}=_(c,n),g=W(m,u,o,x);r=Math.max(r,g)}return r}function ft(t,e,i,n,o=0){var s;let r=1/0;const a=Array.isArray(e)?e.filter(c=>c.to===t):((s=e.bySuccessor)==null?void 0:s.get(t))||[];for(const c of a){const u=i(c.from);if(!u)continue;const{maxGap:m,isElastic:x}=_(c,n);if(x)continue;const g=c.type||S.FS,w=rt(g,u,o,m);r=Math.min(r,w)}return r}function lt(t,e,i,n,o,r=null){var w;let a;if(Array.isArray(e)){const d=new Map;for(const l of e)d.has(l.from)||d.set(l.from,[]),d.get(l.from).push(l);a=l=>d.get(l)||[]}else a=d=>{var l;return((l=e.byPredecessor)==null?void 0:l.get(d))||[]};if(a(t).length===0)return 1/0;const c=r?r.x+r.width:null,u=new Map,m=new Set,x=[t],g=[];for(;x.length>0;){const d=x.shift();if(m.has(d))continue;m.add(d),g.push(d);const l=a(d);for(const b of l)m.has(b.to)||x.push(b.to)}for(let d=g.length-1;d>=0;d--){const l=g[d];let b=1/0;const h=a(l);for(const f of h){const $=f.to,p=n==null?void 0:n($),v=i($);if(!v)continue;const{minGap:C}=_(f,o),F=f.type||S.FS;if(!D(F))continue;if(k((w=p==null?void 0:p.constraints)==null?void 0:w.locked)){const M=st(F,v,C);b=Math.min(b,M)}else{const X=(u.get($)??1/0)-v.width-C;b=Math.min(b,X)}}if(u.set(l,b),l===t&&c!==null&&b<=c+R)return b}return u.get(t)??1/0}function ut(t,e,i,n,o){var s,c;let r=1/0;const a=Array.isArray(e)?e.filter(u=>u.from===t):((s=e.byPredecessor)==null?void 0:s.get(t))||[];for(const u of a){const m=n==null?void 0:n(u.to);if(!((c=m==null?void 0:m.constraints)==null?void 0:c.locked))continue;const g=i(u.to);if(!g)continue;const w=u.type||S.FS,{minGap:d}=_(u,o),l=ct(w,g,d);l!==1/0&&(r=Math.min(r,l))}return r}function dt(t,e,i){var b;const{getBarPosition:n,getTask:o,relationships:r,relationshipIndex:a,pixelsPerHour:s,ganttStartDate:c}=i,u=new Map;u.set(t,{x:e});let m;if(a!=null&&a.byPredecessor)m=h=>a.byPredecessor.get(h)||[];else{const h=new Map;for(const f of r)h.has(f.from)||h.set(f.from,[]),h.get(f.from).push(f);m=f=>h.get(f)||[]}let x;if(a!=null&&a.bySuccessor)x=h=>a.bySuccessor.get(h)||[];else{const h=new Map;for(const f of r)h.has(f.to)||h.set(f.to,[]),h.get(f.to).push(f);x=f=>h.get(f)||[]}const g=new Set,w=[t];for(;w.length>0;){const h=w.shift();for(const f of m(h))g.has(f.to)||(g.add(f.to),w.push(f.to))}let d=!0,l=0;for(;d&&l<ot;){d=!1,l++;for(const h of g){const f=o==null?void 0:o(h);if(k((b=f==null?void 0:f.constraints)==null?void 0:b.locked))continue;let $=n(h);if(!$)continue;u.has(h)&&($={...$,...u.get(h)});let p=0;for(const F of x(h)){let y=n(F.from);if(!y)continue;u.has(F.from)&&(y={...y,...u.get(F.from)});const M=F.type||S.FS,{minGap:E}=_(F,s),X=W(M,y,$.width,E);p=Math.max(p,X)}const v=H(f==null?void 0:f.constraints,c,s),C=K(f==null?void 0:f.constraints,c,s);p=Math.max(v,Math.min(p,C)),p>$.x+R&&(u.set(h,{x:p}),d=!0)}}return u.delete(t),u}function Ft(t,e,i,n){var y;const{getBarPosition:o,getTask:r,relationships:a,relationshipIndex:s,pixelsPerHour:c,ganttStartDate:u}=n,m=s||a,x=r==null?void 0:r(t),g=o(t);if(!g)return{constrainedX:e,constrainedWidth:i,blocked:!1,blockReason:null,cascadeUpdates:new Map};if(k((y=x==null?void 0:x.constraints)==null?void 0:y.locked))return{constrainedX:g.x,constrainedWidth:g.width,blocked:!0,blockReason:"locked",cascadeUpdates:new Map};if(Math.abs(e-g.x)<R&&Math.abs(i-g.width)<R)return{constrainedX:g.x,constrainedWidth:g.width,blocked:!1,blockReason:null,cascadeUpdates:new Map};const w=e>g.x+R;let d=0,l=1/0;const b=H(x==null?void 0:x.constraints,u,c),h=K(x==null?void 0:x.constraints,u,c),f=it(x==null?void 0:x.constraints,u,c);d=Math.max(d,b),h!==1/0&&(l=Math.min(l,h)),f!==1/0&&(l=Math.min(l,f-i));const $=at(t,m,o,c,i),p=ft(t,m,o,c,i);if(d=Math.max(d,$),p!==1/0&&(l=Math.min(l,p)),w){const M=lt(t,m,o,r,c,g);M!==1/0&&(l=Math.min(l,M-i));const E=ut(t,m,o,r,c);E!==1/0&&(l=Math.min(l,E))}let v=Math.max(d,Math.min(e,l));const C=d>l+R;C&&(v=g.x);let F=new Map;return!C&&Math.abs(v-g.x)>R&&(F=dt(t,v,n)),{constrainedX:v,constrainedWidth:i,blocked:C,blockReason:C?"conflicting_constraints":null,cascadeUpdates:F}}function vt(t){const e=new Map;for(const o of t)e.has(o.from)||e.set(o.from,[]),e.get(o.from).push(o.to),e.has(o.to)||e.set(o.to,[]);const i=new Map;function n(o,r){i.set(o,1);for(const a of e.get(o)||[]){if(i.get(a)===1){const s=r.indexOf(a);return{hasCycle:!0,cycle:[...r.slice(s),a]}}if(i.get(a)===0||!i.has(a)){const s=n(a,[...r,a]);if(s.hasCycle)return s}}return i.set(o,2),{hasCycle:!1,cycle:[]}}for(const o of e.keys())if(!i.has(o)||i.get(o)===0){const r=n(o,[o]);if(r.hasCycle)return r}return{hasCycle:!1,cycle:[]}}function ht(t,e){var n;if(!t)return"";const i=[`Task: "${t.name||"Unnamed"}"`,`ID: ${t.id}`,`Progress: ${t.progress??0}%`];return e&&(i.push(`Position: (${Math.round(e.x)}, ${Math.round(e.y)})`),i.push(`Size: ${Math.round(e.width)} x ${Math.round(e.height)}`)),(n=t.constraints)!=null&&n.locked&&i.push("Status: Locked"),t.invalid&&i.push("Status: Invalid"),i.join(`
`)}function gt(t,e,i=[]){if(!t)return null;const n={...t};return delete n.$bar,{sections:{rawTask:JSON.stringify(n,null,2),position:e?JSON.stringify({x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height),index:e.index},null,2):"N/A",relationships:xt(t.id,i)},raw:JSON.stringify({task:n,position:e},null,2)}}const mt={FS:"Finish-to-Start",SS:"Start-to-Start",FF:"Finish-to-Finish",SF:"Start-to-Finish"};function j(t,e,i){const n=mt[t.type]||t.type,o=t.lag??0,r=o?`, lag: ${o} day${o!==1?"s":""}`:"";return`  ${t.type} ${i} ${e} (${n}${r})`}function xt(t,e){if(!e||e.length===0)return"No relationships defined";const i=e.filter(r=>r.to===t),n=e.filter(r=>r.from===t);let o="";return i.length===0?o+=`Incoming: (none)
`:(o+=`Incoming:
`,i.forEach(r=>{o+=j(r,r.from,"<-")+`
`})),n.length===0?o+="Outgoing: (none)":(o+=`Outgoing:
`,n.forEach((r,a)=>{o+=j(r,r.to,"->"),a<n.length-1&&(o+=`
`)})),o}function J(t){return t?t.replace(/"([^"]+)":/g,'<span style="color: #9b59b6;">"$1"</span>:').replace(/: "([^"]+)"/g,': <span style="color: #27ae60;">"$1"</span>').replace(/: (-?\d+\.?\d*)/g,': <span style="color: #e74c3c;">$1</span>').replace(/: (true|false)/g,': <span style="color: #3498db;">$1</span>').replace(/: (null)/g,': <span style="color: #95a5a6;">$1</span>'):""}var yt=Y('<div><div style=font-family:monospace;white-space:pre-line;line-height:1.5></div><div style="margin-top:10px;padding-top:8px;border-top:1px solid #eee;font-size:10px;color:#999;text-align:center;font-family:sans-serif">Click for full data');function Ct(t){const e=P(()=>{var r,a;const n=(r=t.task)==null?void 0:r.call(t),o=(a=t.barPosition)==null?void 0:a.call(t);return n?ht(n,o):""}),i=P(()=>{var o;const n=((o=t.position)==null?void 0:o.call(t))||{x:0,y:0};return{position:"fixed",left:`${n.x+15}px`,top:`${n.y-10}px`,background:"#fff","box-shadow":"0 4px 12px rgba(0,0,0,0.15)","border-radius":"6px",padding:"12px","min-width":"180px","max-width":"280px","z-index":1100,"font-size":"12px","border-left":"3px solid #3498db","pointer-events":"none"}});return O(B,{get when(){var n;return(n=t.visible)==null?void 0:n.call(t)},get children(){var n=yt(),o=n.firstChild;return o.nextSibling,A(o,e),q(r=>tt(n,i(),r)),n}})}var bt=Y('<div tabindex=-1 style=position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:2000><div style="background:#fff;border-radius:8px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 10px 40px rgba(0,0,0,0.3)"><div style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #eee;flex-shrink:0"><h3 style=margin:0;font-size:16px;font-weight:600>Task Data: </h3><button title="Close (Esc)"style="border:none;background:none;font-size:24px;cursor:pointer;padding:4px 8px;color:#666;line-height:1">&times;</button></div><div style=padding:20px;overflow:auto;flex:1><div style=margin-bottom:20px><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:8px><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px>Raw Task Object</span><button style="padding:4px 10px;border:none;border-radius:3px;cursor:pointer;font-size:11px;transition:background 0.2s"></button></div><pre style=background:#f8f9fa;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-break:break-all;overflow:auto;max-height:200px;margin:0;line-height:1.5></pre></div><div style=margin-bottom:20px><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px;display:block;margin-bottom:8px>Computed Position ($bar)</span><pre style=background:#f8f9fa;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;margin:0;line-height:1.5></pre></div><div><span style=font-size:11px;font-weight:600;text-transform:uppercase;color:#999;letter-spacing:0.5px;display:block;margin-bottom:8px>Relationships</span><pre style=background:#fff8e1;border-radius:4px;padding:12px;font-family:monospace;font-size:12px;white-space:pre-wrap;margin:0;line-height:1.5;color:#5d4037>');function Et(t){const[e,i]=et(""),n=P(()=>{var c,u,m;const s=(c=t.task)==null?void 0:c.call(t);return s?gt(s,(u=t.barPosition)==null?void 0:u.call(t),((m=t.relationships)==null?void 0:m.call(t))||[]):null}),o=async()=>{const s=n();if(s!=null&&s.raw)try{await navigator.clipboard.writeText(s.raw),i("Copied!"),setTimeout(()=>i(""),2e3)}catch{i("Failed to copy"),setTimeout(()=>i(""),2e3)}},r=s=>{var c;s.target===s.currentTarget&&((c=t.onClose)==null||c.call(t))},a=s=>{var c;s.key==="Escape"&&((c=t.onClose)==null||c.call(t))};return O(B,{get when(){var s;return(s=t.visible)==null?void 0:s.call(t)},get children(){var s=bt(),c=s.firstChild,u=c.firstChild,m=u.firstChild;m.firstChild;var x=m.nextSibling,g=u.nextSibling,w=g.firstChild,d=w.firstChild,l=d.firstChild,b=l.nextSibling,h=d.nextSibling,f=w.nextSibling,$=f.firstChild,p=$.nextSibling,v=f.nextSibling,C=v.firstChild,F=C.nextSibling;return s.$$keydown=a,s.$$click=r,A(m,()=>{var y,M;return((M=(y=t.task)==null?void 0:y.call(t))==null?void 0:M.name)||"Unknown"},null),x.$$click=()=>{var y;return(y=t.onClose)==null?void 0:y.call(t)},b.$$click=o,A(b,()=>e()||"Copy JSON"),A(F,()=>{var y,M;return(M=(y=n())==null?void 0:y.sections)==null?void 0:M.relationships}),q(y=>{var L,I,T,G;var M=e()==="Copied!"?"#d4edda":"#e3f2fd",E=e()==="Copied!"?"#155724":"#1976d2",X=J(((I=(L=n())==null?void 0:L.sections)==null?void 0:I.rawTask)||""),N=J(((G=(T=n())==null?void 0:T.sections)==null?void 0:G.position)||"");return M!==y.e&&U(b,"background",y.e=M),E!==y.t&&U(b,"color",y.t=E),X!==y.a&&(h.innerHTML=y.a=X),N!==y.o&&(p.innerHTML=y.o=N),y},{e:void 0,t:void 0,a:void 0,o:void 0}),s}})}nt(["click","keydown"]);export{Ct as T,Et as a,$t as b,wt as c,vt as d,dt as e,k as f,pt as g,Mt as i,Ft as r};
